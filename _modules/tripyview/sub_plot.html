<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tripyview.sub_plot &#8212; tripyview 0.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/agogo.css?v=8513425a" />
    <script src="../../_static/documentation_options.js?v=e259d695"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../../index.html">tripyview 0.3.0 documentation</a></div>
        <div class="rel" role="navigation" aria-label="Related">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tripyview.sub_plot</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w">                    </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span><span class="w">                     </span><span class="k">as</span><span class="w"> </span><span class="nn">clock</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w">                   </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w">              </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.feature</span><span class="w">          </span><span class="k">as</span><span class="w"> </span><span class="nn">cfeature</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">cartopy.mpl.ticker</span><span class="w">       </span><span class="kn">import</span> <span class="p">(</span><span class="n">LongitudeFormatter</span><span class="p">,</span> <span class="n">LatitudeFormatter</span><span class="p">)</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">cartopy.mpl.gridliner</span><span class="w">    </span><span class="kn">import</span> <span class="n">Gridliner</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w">  </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="c1">#import matplotlib.pylab         as plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w">        </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">matplotlib.tri</span><span class="w">           </span><span class="kn">import</span> <span class="n">Triangulation</span><span class="p">,</span><span class="n">TriAnalyzer</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w">        </span><span class="k">as</span><span class="w"> </span><span class="nn">mticker</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.path</span><span class="w">          </span><span class="k">as</span><span class="w"> </span><span class="nn">mpath</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w">        </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">matplotlib.colors</span><span class="w">        </span><span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">matplotlib.ticker</span><span class="w">        </span><span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">ScalarFormatter</span><span class="p">,</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">LogFormatter</span><span class="p">,</span> <span class="n">SymmetricalLogLocator</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">scipy.signal</span><span class="w">             </span><span class="kn">import</span> <span class="n">convolve2d</span>
<span class="kn">from</span><span class="w">   </span><span class="nn">scipy.interpolate</span><span class="w">        </span><span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span><span class="w">                     </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sub_mesh</span><span class="w">     </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sub_data</span><span class="w">     </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sub_colormap</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.sub_utility</span><span class="w">  </span><span class="kn">import</span> <span class="o">*</span>



<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of horizontal slices</span>
<div class="viewcode-block" id="plot_hslice">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_hslice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_hslice</span><span class="p">(</span><span class="n">mesh</span>                   <span class="p">,</span> 
                <span class="n">data</span>                   <span class="p">,</span> 
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cinfo</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># colormap info and defintion</span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;pc&#39;</span>      <span class="p">,</span>
                <span class="n">do_ie2n</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># interpolate element data to vertices</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                
                <span class="c1">#--- data -----------</span>
                <span class="n">do_plt</span>     <span class="o">=</span> <span class="s1">&#39;tpc&#39;</span>     <span class="p">,</span> <span class="c1"># tpc:tripcolor, tcf:tricontourf</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">plt_contb</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot background contour lines: True/False </span>
                <span class="n">pltcb_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># background contour line option</span>
                <span class="n">plt_contf</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot foreground contour lines: True/False </span>
                <span class="n">pltcf_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># foreground contour line option</span>
                <span class="n">plt_contr</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot reference contour lines: True/False </span>
                <span class="n">pltcr_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># reference contour line option</span>
                <span class="n">plt_contl</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># do contourline labels </span>
                <span class="n">pltcl_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># contour line label options</span>
                
                <span class="c1">#--- mesh -----------</span>
                <span class="n">do_mesh</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">mesh_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                
                <span class="c1">#--- streamlines ----</span>
                <span class="n">do_streaml</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">streaml_dat</span><span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">streaml_opt</span><span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">do_streaml_leg</span> <span class="o">=</span> <span class="kc">True</span>  <span class="p">,</span>
                <span class="n">streaml_leg_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span> <span class="p">,</span> 
                
                <span class="c1">#--- quiver ---------</span>
                <span class="n">do_quiver</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">quiver_dat</span> <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">quiver_opt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">do_quiver_leg</span> <span class="o">=</span> <span class="kc">True</span>   <span class="p">,</span>
                <span class="n">quiver_leg_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>  <span class="p">,</span> 
                
                <span class="c1">#--- bottom mask ----</span>
                <span class="n">do_bot</span>     <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">bot_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                
                <span class="c1">#--- landsea mask ---</span>
                <span class="n">do_lsm</span>     <span class="o">=</span> <span class="s1">&#39;fesom&#39;</span>   <span class="p">,</span> 
                <span class="n">lsm_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">lsm_res</span>    <span class="o">=</span> <span class="s1">&#39;low&#39;</span>     <span class="p">,</span>
                
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">do_boundbox</span><span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                
                <span class="c1">#--- colorbar -------</span>
                <span class="n">cb_label</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_lunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ltime</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ldep</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cb_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar option</span>
                <span class="n">cbl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar label option, fontsize ,...</span>
                <span class="n">cbtl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar ticklabel option, fontsize ,...</span>
                
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">axl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span><span class="c1"># dictionary that defines axes and colorbar arangement</span>
                
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>    <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span>    <span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">,</span> <span class="s1">&#39;hcb&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot FESOM2 horizontal data slice:</span>

<span class="sd">    __________________________________________________</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :mesh:      fesom2 mesh object, with all mesh information</span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None) regional limitation of plot. For ortho...</span>
<span class="sd">                    box=[lonc, latc], nears...box=[lonc, latc, zoom], for all others box = </span>
<span class="sd">                    [lonmin, lonmax, latmin, latmax]</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;pc&#39;) which projection should be used, </span>
<span class="sd">                    - pc     ... PlateCarree         (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - merc   ... Mercator            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - rob    ... Robinson            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - eqearth... EqualEarth          (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - mol    ... Mollweide           (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - nps    ... NorthPolarStereo    (box=[-180, 180, &gt;0, latmax])</span>
<span class="sd">                    - sps    ... SouthPolarStereo    (box=[-180, 180, latmin, &lt;0])</span>
<span class="sd">                    - ortho  ... Orthographic        (box=[loncenter, latcenter]) </span>
<span class="sd">                    - nears  ... NearsidePerspective (box=[loncenter, latcenter, zoom]) </span>
<span class="sd">                    - channel... PlateCaree</span>

<span class="sd">        :do_ie2n:   bool, (default: False) do interpolation of data on elements towards nodes</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>

<span class="sd">        ___plot data parameters_____________________________</span>

<span class="sd">        :do_plt:    str, (default: tpc)</span>
<span class="sd">                    - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                    - tcf ... make contourf color plot (tricontourf)</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                    or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb: bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt: dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contf: bool, (default: False) overlay thicker contour lines of the main colorbar steps (foreground)</span>

<span class="sd">        :pltcf_opt: dict, (default: dict()) foreground contour line option</span>

<span class="sd">        :plt_contr: bool, (default: False) overlay thick contour lines of reference color steps (reference)</span>

<span class="sd">        :pltcr_opt: dict, (default: dict()) reference contour line option</span>

<span class="sd">        :plt_contl: bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt: dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">        ___plot mesh________________________________________</span>

<span class="sd">        :do_mesh:   bool, (default: True), overlay FESOM grid over dataplot</span>

<span class="sd">        :mesh_opt:  dict, (default: dict()) additional options that are given to the mesh plotting via kwarg</span>

<span class="sd">        ___plot streamlines_________________________________</span>

<span class="sd">        :do_streaml:   bool, (default: False), overlay streamline plot based on regular gridded u,v data</span>

<span class="sd">        :streaml_dat:  list, (default: None), list with u,v regular gridded velocity data</span>

<span class="sd">        :streaml_opt:  dict, (default: dict()), additional options that can be given to the streamline plot</span>
<span class="sd">        </span>
<span class="sd">        :do_streaml_leg: bool, (default: False) overlay legend for streamline plot, keep in mind that the position for </span>
<span class="sd">                               legend is somewhat pre setted by hand </span>

<span class="sd">        :streaml_leg_opt: dict, (default=dict()) additional option for the position of the streamline legend </span>
<span class="sd">        </span>
<span class="sd">            ::</span>
<span class="sd">            </span>
<span class="sd">                streaml_leg_opt = dict({&#39;x&#39;:75, # lon position of legend in deg</span>
<span class="sd">                                        &#39;y&#39;:60, # lat position of legend in deg </span>
<span class="sd">                                        &#39;dy&#39;:5, # vertical distance of legend labels in deg</span>
<span class="sd">                                        &#39;dw&#39;:10, # width of lines in deg</span>
<span class="sd">                                        &#39;arr_s&#39;: [0.05, 0.1, 0.2, 0.3, 0.4]  })</span>
<span class="sd">        </span>
<span class="sd">        ___plot quivers-----_________________________________</span>

<span class="sd">        :do_quiver:   bool, (default: False), overlay quivers based on regular gridded u,v data</span>

<span class="sd">        :quiver_dat:  list, (default: None), list with u,v regular gridded velocity data</span>

<span class="sd">        :quiver_opt:  dict, (default: dict()), additional options that can be given to the quiver plot</span>
<span class="sd">        </span>
<span class="sd">        :do_quiver_leg: bool, (default: False) overlay legend for quiver plot, keep in mind that the position for </span>
<span class="sd">                               legend is somewhat pre setted by hand </span>

<span class="sd">        :quiver_leg_opt: dict, (default=dict()) additional option for the position of the quiver legend</span>
<span class="sd">        </span>
<span class="sd">        ___plot bottom mask_________________________________</span>

<span class="sd">        :do_bot:    bool, (default: True), overlay topographic bottom mask</span>

<span class="sd">        :bot_opt:   dict, (default: dict()) additional options that are given to the bottom mask plotting via kwarg</span>

<span class="sd">        ___plot lsmask______________________________________</span>

<span class="sd">        :do_lsm:    str, (default: &#39;fesom&#39;), overlay FESOM grid inverted land sea mask</span>
<span class="sd">                    option are here:</span>
<span class="sd">                </span>
<span class="sd">                    - fesom      ... grey fesom landsea mask</span>
<span class="sd">                    - stock      ... uses cartopy stock image</span>
<span class="sd">                    - bluemarble ... uses bluemarble image in folder tripyview/background/</span>
<span class="sd">                    - etopo      ... uses etopo image in folder tripyview/background/</span>

<span class="sd">        :lsm_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the landsea mask plotting via kwarg</span>

<span class="sd">        :lsm_res:   str, (default=&#39;low&#39;) resolution of bluemarble texture file either &#39;low&#39; or &#39;high&#39;</span>

<span class="sd">        ___plot cartopy gridlines____________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>
<span class="sd">        </span>
<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>

<span class="sd">        :do_boundbox: bool, (default: True) plot cartopy black bounding box. If you </span>
<span class="sd">                    make plots as a texture to use in blender, unity or pyvista the bounding box </span>
<span class="sd">                    has to be removed with do_boundbox=False</span>

<span class="sd">        ___colorbar_________________________________________</span>

<span class="sd">        :cb_label:  str, (default: None) if string its used as colorbar label, otherwise </span>
<span class="sd">                    information from data (&#39;long_name, short_name) are used</span>

<span class="sd">        :cb_lunit:  str, (default: None) if string its used as colorbar unit label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ltime:  str, (default: None) if string its used as colorbar time label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ldep:   str, (default: None) if string its used as colorbar depth label, </span>
<span class="sd">                    otherwise info from data are used                </span>

<span class="sd">        :cb_opt:    dict, (default: dict()) direct option for colorbar via kwarg</span>

<span class="sd">        :cbl_opt:   dict, (default: dict()) direct option for colorbar labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine </span>
<span class="sd">                    do_axes_arrange</span>

<span class="sd">        :axl_opt:   dict, (default: dict()) set option for axes labels (fontsize, ...)</span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings        , </span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - hcb  ... list of colorbar handles (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>

<span class="sd">        :hax: returns list with axes handle </span>

<span class="sd">        :hcb: returns colorbar handle</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create box</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">box</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">box</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">proj</span><span class="o">!=</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">box</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">do_streaml</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streaml_dat</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">streaml_dat</span> <span class="o">=</span> <span class="p">[</span><span class="n">streaml_dat</span><span class="p">]</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">cb_label</span><span class="o">=</span><span class="p">[</span><span class="n">cb_label</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">box</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span><span class="n">proj</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">ndat</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">ndat</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create mesh triangulation, when input data are unstructured, if not fall</span>
    <span class="c1">#     back to regular plotting</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;nod2&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span> <span class="ow">or</span> <span class="s1">&#39;elem&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">do_triangulation</span><span class="p">(</span><span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; set up color info</span>
    <span class="c1"># --&gt; setup normalization log10, symetric log10, None</span>
    <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="p">):</span>
        <span class="n">idsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="o">==</span><span class="n">ii</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">)</span> <span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span><span class="p">,</span> <span class="n">hstrm</span><span class="p">,</span> <span class="n">hquiv</span><span class="p">,</span> <span class="n">hall</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">ndat</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>    
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">ii_valid</span><span class="o">=</span><span class="n">ii</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># switch between unstrucutred and regular plotting</span>
            <span class="c1"># plot unstructured data</span>
            <span class="k">if</span> <span class="n">tri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># prepare unstructured data for plotting, augment periodic </span>
                <span class="c1"># boundaries, interpolate from elements to nodes, kick out nan </span>
                <span class="c1"># values from plotting that are bottom topo  </span>
                <span class="n">vname</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">data_plot</span><span class="p">,</span> <span class="n">tri</span> <span class="o">=</span> <span class="n">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">do_ie2n</span><span class="p">)</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># add color for ocean bottom</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">bot_opt</span><span class="o">=</span><span class="n">bot_opt</span><span class="p">)</span>
                <span class="n">hbot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># add tripcolor or tricontourf plot </span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_data</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> 
                                <span class="n">cinfo_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                                <span class="n">plt_opt</span>  <span class="o">=</span> <span class="n">plt_opt</span><span class="p">,</span>
                                <span class="n">plt_contb</span><span class="o">=</span><span class="n">plt_contb</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">pltcb_opt</span><span class="p">,</span>
                                <span class="n">plt_contf</span><span class="o">=</span><span class="n">plt_contf</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="n">pltcf_opt</span><span class="p">,</span>
                                <span class="n">plt_contr</span><span class="o">=</span><span class="n">plt_contr</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="n">pltcr_opt</span><span class="p">,</span>
                                <span class="n">plt_contl</span><span class="o">=</span><span class="n">plt_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">pltcl_opt</span><span class="p">)</span>
                <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                
                <span class="c1">#___________________________________________________________________</span>
                <span class="c1"># add grid mesh on top</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_mesh</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">mesh_opt</span><span class="o">=</span><span class="n">mesh_opt</span><span class="p">)</span>
                <span class="n">hmsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1"># plot regular gridded data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># prepare regular gridded data for plotting</span>
                <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span>   <span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tpc&#39;</span><span class="p">,</span><span class="s1">&#39;pc&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;lon_bnd&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;lat_bnd&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="p">:</span> 
                    <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lon_bnd&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lat_bnd&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span>    <span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span>    <span class="p">]</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># add tripcolor or tricontourf plot </span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_datareg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> 
                                <span class="n">cinfo_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span>
                                <span class="n">which_transf</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> 
                                <span class="n">plt_opt</span>  <span class="o">=</span> <span class="n">plt_opt</span><span class="p">,</span>
                                <span class="n">plt_contb</span><span class="o">=</span><span class="n">plt_contb</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">pltcb_opt</span><span class="p">,</span>
                                <span class="n">plt_contf</span><span class="o">=</span><span class="n">plt_contf</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="n">pltcf_opt</span><span class="p">,</span>
                                <span class="n">plt_contr</span><span class="o">=</span><span class="n">plt_contr</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="n">pltcr_opt</span><span class="p">,</span>
                                <span class="n">plt_contl</span><span class="o">=</span><span class="n">plt_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">pltcl_opt</span><span class="p">)</span>
                <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add streamline data if available </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_streaml_reg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">do_streaml</span><span class="p">,</span> 
                                <span class="n">box</span>             <span class="o">=</span> <span class="n">box</span><span class="p">,</span> 
                                <span class="n">streaml_dat</span>     <span class="o">=</span> <span class="n">streaml_dat</span><span class="p">,</span> 
                                <span class="n">streaml_opt</span>     <span class="o">=</span> <span class="n">streaml_opt</span><span class="p">,</span>
                                <span class="n">do_streaml_leg</span>  <span class="o">=</span> <span class="n">do_streaml_leg</span><span class="p">,</span> 
                                <span class="n">streaml_leg_opt</span> <span class="o">=</span> <span class="n">streaml_leg_opt</span><span class="p">)</span>
            <span class="n">hstrm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>            
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add streamline data if available </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_quiver_reg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">do_quiver</span><span class="p">,</span> 
                                   <span class="n">box</span>            <span class="o">=</span> <span class="n">box</span><span class="p">,</span> 
                                   <span class="n">quiver_dat</span>     <span class="o">=</span> <span class="n">quiver_dat</span><span class="p">,</span> 
                                   <span class="n">quiver_opt</span>     <span class="o">=</span> <span class="n">quiver_opt</span><span class="p">,</span>
                                   <span class="n">do_quiver_leg</span>  <span class="o">=</span> <span class="n">do_quiver_leg</span><span class="p">,</span> 
                                   <span class="n">quiver_leg_opt</span> <span class="o">=</span> <span class="n">quiver_leg_opt</span><span class="p">)</span>
            <span class="n">hquiv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>            
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add mesh land-sea mask</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_lsmask</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_lsm</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">lsm_opt</span><span class="o">=</span><span class="n">lsm_opt</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">lsm_res</span><span class="p">)</span>
            <span class="n">hlsm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>  
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">ndat</span><span class="p">,</span> <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="n">axl_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># is title  string:</span>
                <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="c1"># if title string is &#39;descript&#39; than use descript attribute from </span>
                    <span class="c1"># data to set plot title </span>
                    <span class="k">if</span> <span class="n">ax_title</span><span class="o">==</span><span class="s1">&#39;descript&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;descript&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">):</span>
                        <span class="n">axl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;verticalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;top&#39;</span><span class="p">})</span>
                        <span class="n">axl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">axl_opt</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span> <span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">axl_optdefault</span> <span class="p">)</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">axl_opt</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span> <span class="o">**</span><span class="n">axl_optdefault</span> <span class="p">)</span>
                <span class="c1"># is title list of string        </span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> 
                    <span class="n">axl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">axl_opt</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="o">**</span><span class="n">axl_optdefault</span> <span class="p">)</span>
                
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># add colorbar </span>
        <span class="k">if</span> <span class="n">hcb_ii</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">],</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                                <span class="n">cb_label</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                                <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">],</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> 
                                <span class="n">cb_label</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                                <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
        
        <span class="c1">#___________________________________________________________________</span>
        <span class="c1"># add all handles together </span>
        <span class="n">hall</span> <span class="o">=</span> <span class="n">hp</span> <span class="o">+</span> <span class="n">hbot</span> <span class="o">+</span> <span class="n">hmsh</span> <span class="o">+</span> <span class="n">hlsm</span> <span class="o">+</span> <span class="n">hgrd</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># hfig.canvas.draw() </span>
        
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of horizontal meshes</span>
<div class="viewcode-block" id="plot_hmesh">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_hmesh">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_hmesh</span><span class="p">(</span> <span class="n">mesh</span>                   <span class="p">,</span> 
                <span class="n">data</span>       <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># None, resolution, depth</span>
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cinfo</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># colormap info and defintion</span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;pc&#39;</span>      <span class="p">,</span>
                <span class="n">do_ie2n</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="c1">#--- data -----------</span>
                <span class="n">do_plt</span>     <span class="o">=</span> <span class="s1">&#39;tpc&#39;</span>     <span class="p">,</span> <span class="c1"># tpc:tripcolor, tcf:tricontourf</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">plt_contb</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot background contour lines: True/False </span>
                <span class="n">pltcb_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># background contour line option</span>
                <span class="n">plt_contf</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot foreground contour lines: True/False </span>
                <span class="n">pltcf_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># foreground contour line option</span>
                <span class="n">plt_contr</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot reference contour lines: True/False </span>
                <span class="n">pltcr_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># reference contour line option</span>
                <span class="n">plt_contl</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># do contourline labels </span>
                <span class="n">pltcl_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># contour line label options</span>
                <span class="c1">#--- mesh -----------</span>
                <span class="n">do_mesh</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">mesh_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="c1">#--- landsea mask ---</span>
                <span class="n">do_lsm</span>     <span class="o">=</span> <span class="s1">&#39;fesom&#39;</span>   <span class="p">,</span> 
                <span class="n">lsm_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">lsm_res</span>    <span class="o">=</span> <span class="s1">&#39;low&#39;</span>     <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span>
                <span class="n">do_boundbox</span><span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- colorbar -------</span>
                <span class="n">cb_label</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_lunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ltime</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ldep</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cb_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar option</span>
                <span class="n">cbl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar label option, fontsize ,...</span>
                <span class="n">cbtl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar ticklabel option, fontsize ,...</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># dictionary that defines axes and colorbar arangement</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>    <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">,</span> <span class="s1">&#39;hcb&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot horizontal mesh and mesh paramters on vertices and elements</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :mesh:      fesom2 mesh object, with all mesh information</span>

<span class="sd">        :data:      str, (default: None) string can be:</span>

<span class="sd">                    - &#39;resolution&#39;, &#39;resol&#39;, &#39;n_resol&#39;, &#39;nresol&#39;</span>
<span class="sd">                    - &#39;narea&#39;, &#39;n_area&#39;, &#39;clusterarea&#39;, &#39;scalararea&#39;</span>
<span class="sd">                    - &#39;eresol&#39;, &#39;e_resol&#39;, &#39;triresolution&#39;, &#39;triresol&#39;</span>
<span class="sd">                    - &#39;earea&#39;, &#39;e_area&#39;, &#39;triarea&#39;</span>
<span class="sd">                    - &#39;ndepth&#39;, &#39;ntopo&#39;, &#39;n_depth&#39;, &#39;n_topo&#39;, &#39;topography&#39;, &#39;zcoord&#39;</span>
<span class="sd">                    - &#39;edepth&#39;, &#39;etopo&#39;, &#39;e_depth&#39;, &#39;e_topo&#39; </span>

<span class="sd">        :box:       None, list (default: None) regional limitation of plot. For ortho...</span>
<span class="sd">                    box=[lonc, latc], nears...box=[lonc, latc, zoom], for all others box = </span>
<span class="sd">                    [lonmin, lonmax, latmin, latmax]</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;pc&#39;) which projection should be used, </span>
<span class="sd">                    - pc     ... PlateCarree         (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - merc   ... Mercator            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - rob    ... Robinson            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - eqearth... EqualEarth          (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - mol    ... Mollweide           (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - nps    ... NorthPolarStereo    (box=[-180, 180, &gt;0, latmax])</span>
<span class="sd">                    - sps    ... SouthPolarStereo    (box=[-180, 180, latmin, &lt;0])</span>
<span class="sd">                    - ortho  ... Orthographic        (box=[loncenter, latcenter]) </span>
<span class="sd">                    - nears  ... NearsidePerspective (box=[loncenter, latcenter, zoom]) </span>
<span class="sd">                    - channel... PlateCaree</span>

<span class="sd">        :do_ie2n:   bool, (default: False) do interpolation of data on elements towards nodes</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>

<span class="sd">        ___plot data parameters_____________________________</span>

<span class="sd">        :do_plt:    str, (default: tpc)</span>
<span class="sd">                    - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                    - tcf ... make contourf color plot (tricontourf)</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                    or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb: bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt: dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contf: bool, (default: False) overlay thicker contour lines of the main colorbar steps (foreground)</span>

<span class="sd">        :pltcf_opt: dict, (default: dict()) foreground contour line option</span>

<span class="sd">        :plt_contr: bool, (default: False) overlay thick contour lines of reference color steps (reference)</span>

<span class="sd">        :pltcr_opt: dict, (default: dict()) reference contour line option</span>

<span class="sd">        :plt_contl: bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt: dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">        ___plot mesh________________________________________</span>

<span class="sd">        :do_mesh:   bool, (default: True), overlay FESOM grid over dataplot</span>

<span class="sd">        :mesh_opt:  dict, (default: dict()) additional options that are given to the mesh plotting via kwarg</span>

<span class="sd">        ___plot bottom mask_________________________________</span>

<span class="sd">        :do_bot:    bool, (default: True), overlay topographic bottom mask</span>

<span class="sd">        :bot_opt:   dict, (default: dict()) additional options that are given to the bottom mask plotting via kwarg</span>

<span class="sd">        ___plot lsmask______________________________________</span>

<span class="sd">        :do_lsm:    str, (default: &#39;fesom&#39;), overlay FESOM grid inverted land sea mask</span>
<span class="sd">                    option are here:</span>
<span class="sd">                    </span>
<span class="sd">                    - fesom      ... grey fesom landsea mask</span>
<span class="sd">                    - stock      ... uses cartopy stock image</span>
<span class="sd">                    - bluemarble ... uses bluemarble image in folder tripyview/background/</span>
<span class="sd">                    - etopo      ... uses etopo image in folder tripyview/background/</span>

<span class="sd">        :lsm_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the landsea mask plotting via kwarg</span>

<span class="sd">        :lsm_res:   str, (default=&#39;low&#39;) resolution of bluemarble texture file either &#39;low&#39; or &#39;high&#39;</span>

<span class="sd">        ___plot cartopy gridlines____________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>

<span class="sd">        :do_boundbox: bool, (default: True) plot cartopy black bounding box. If you </span>
<span class="sd">                    make plots as a texture to use in blender, unity or pyvista the bounding box </span>
<span class="sd">                    has to be removed with do_boundbox=False</span>

<span class="sd">        ___colorbar_________________________________________</span>

<span class="sd">        :cb_label:  str, (default: None) if string its used as colorbar label, otherwise </span>
<span class="sd">                    information from data (&#39;long_name, short_name) are used</span>

<span class="sd">        :cb_lunit:  str, (default: None) if string its used as colorbar unit label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ltime:  str, (default: None) if string its used as colorbar time label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ldep:   str, (default: None) if string its used as colorbar depth label, </span>
<span class="sd">                    otherwise info from data are used                </span>

<span class="sd">        :cb_opt:    dict, (default: dict()) direct option for colorbar via kwarg</span>

<span class="sd">        :cbl_opt:   dict, (default: dict()) direct option for colorbar labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine </span>
<span class="sd">                    do_axes_arrange</span>

<span class="sd">        :axl_opt:   dict, (default: dict()) set option for axes labels (fontsize, ...)</span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings        , </span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - hcb  ... list of colorbar handles (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>

<span class="sd">        :hax: returns list with axes handle </span>

<span class="sd">        :hcb: returns colorbar handle</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create box</span>
    <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">box</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="n">box</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span>  <span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">mesh</span>   <span class="o">=</span> <span class="p">[</span><span class="n">mesh</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_lsm</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">do_lsm</span> <span class="o">=</span> <span class="p">[</span><span class="n">do_lsm</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; look if you need data</span>
    <span class="n">aux_cb_plt</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">aux_cb_plt</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">box</span><span class="p">,</span> <span class="s1">&#39;cb_plt&#39;</span><span class="p">:</span><span class="n">aux_cb_plt</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">ndat</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">ndat</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">ndat</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># build triangulation</span>
            <span class="n">tri</span> <span class="o">=</span> <span class="n">do_triangulation</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                <span class="k">if</span>  <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span> <span class="s1">&#39;resol&#39;</span><span class="p">,</span> <span class="s1">&#39;n_resol&#39;</span><span class="p">,</span> <span class="s1">&#39;nresol&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">n_resol</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">compute_n_resol</span><span class="p">()</span>
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">n_resol</span><span class="o">/</span><span class="mi">1000</span>
                    <span class="c1">#data_plot = mesh[ii].n_resol[0,:]/1000</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;vertice resolution&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
                    
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;narea&#39;</span><span class="p">,</span> <span class="s1">&#39;n_area&#39;</span><span class="p">,</span> <span class="s1">&#39;clusterarea&#39;</span><span class="p">,</span> <span class="s1">&#39;scalararea&#39;</span><span class="p">]:</span>    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">n_area</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">compute_n_area</span><span class="p">()</span>
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">n_area</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;vertice area&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;m^2&#39;</span>
                    
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eresol&#39;</span><span class="p">,</span> <span class="s1">&#39;e_resol&#39;</span><span class="p">,</span> <span class="s1">&#39;triresolution&#39;</span><span class="p">,</span> <span class="s1">&#39;triresol&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">e_resol</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">compute_e_resol</span><span class="p">()</span>
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">e_resol</span><span class="o">/</span><span class="mi">1000</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;element resolution&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
                    
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;earea&#39;</span><span class="p">,</span> <span class="s1">&#39;e_area&#39;</span><span class="p">,</span> <span class="s1">&#39;triarea&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">e_area</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">compute_e_area</span><span class="p">()</span>
                    <span class="n">data_plot</span> <span class="o">=</span>  <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">e_area</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;element area&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;m^2&#39;</span>
                    
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ndepth&#39;</span><span class="p">,</span> <span class="s1">&#39;ntopo&#39;</span><span class="p">,</span> <span class="s1">&#39;n_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;n_topo&#39;</span><span class="p">,</span> <span class="s1">&#39;topography&#39;</span><span class="p">,</span> <span class="s1">&#39;zcoord&#39;</span><span class="p">]:</span>
                    <span class="n">data_plot</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">n_z</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;vertice depth&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
                    
                <span class="k">elif</span> <span class="n">data</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;edepth&#39;</span><span class="p">,</span> <span class="s1">&#39;etopo&#39;</span><span class="p">,</span> <span class="s1">&#39;e_depth&#39;</span><span class="p">,</span> <span class="s1">&#39;e_topo&#39;</span> <span class="p">]:</span>
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">zlev</span><span class="p">[</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">e_iz</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;element depth&#39;</span>
                    <span class="k">if</span> <span class="n">cb_lunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_lunit</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="n">cinfo_plot</span> <span class="o">=</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="p">[</span><span class="n">data_plot</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
                <span class="n">norm_plot</span>  <span class="o">=</span> <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">)</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># prepare unstructured data for plotting, </span>
                <span class="n">data_plot</span><span class="p">,</span> <span class="n">e_ok_mask</span> <span class="o">=</span> <span class="n">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">do_ie2n</span><span class="p">)</span>

                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># add tripcolor or tricontourf plot </span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_data</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> 
                                 <span class="n">plt_opt</span>  <span class="o">=</span><span class="n">plt_opt</span><span class="p">,</span> 
                                 <span class="n">plt_contb</span><span class="o">=</span><span class="n">plt_contb</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">pltcb_opt</span><span class="p">,</span> 
                                 <span class="n">plt_contf</span><span class="o">=</span><span class="n">plt_contf</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="n">pltcf_opt</span><span class="p">,</span>
                                 <span class="n">plt_contr</span><span class="o">=</span><span class="n">plt_contr</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="n">pltcr_opt</span><span class="p">,</span>
                                 <span class="n">plt_contl</span><span class="o">=</span><span class="n">plt_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">pltcl_opt</span><span class="p">)</span>
                <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                
                
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grid mesh on top</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_mesh</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">mesh_opt</span><span class="o">=</span><span class="n">mesh_opt</span><span class="p">)</span>
            <span class="n">hmsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add mesh land-sea mask</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_lsmask</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_lsm</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">mesh</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">lsm_opt</span><span class="o">=</span><span class="n">lsm_opt</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">lsm_res</span><span class="p">)</span>
            <span class="n">hlsm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>  
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="p">),</span> <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># is title  string:</span>
                <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                <span class="c1"># is title list of string        </span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># remove platecaree bounding box when used as image alpha map or texture</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">do_boundbox</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># add colorbar </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">hcb_ii</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> 
                                <span class="n">cb_label</span><span class="p">,</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hcb_ii</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">hcb_ii</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># hfig.canvas.draw()   </span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of horizontal slices</span>
<div class="viewcode-block" id="plot_hquiver">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_hquiver">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_hquiver</span><span class="p">(</span><span class="n">mesh</span>                  <span class="p">,</span> 
                <span class="n">data</span>                   <span class="p">,</span> 
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cinfo</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># colormap info and defintion</span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;pc&#39;</span>      <span class="p">,</span>
                <span class="n">do_ie2n</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># interpolate element data to vertices</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="c1">#--- quiver ---------</span>
                <span class="n">do_quiv</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> <span class="c1"># tpc:tripcolor, tcf:tricontourf</span>
                <span class="n">quiv_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">quiv_scalfac</span>  <span class="o">=</span> <span class="mi">1</span>      <span class="p">,</span> <span class="c1"># bigger means larger arrows  </span>
                <span class="n">quiv_arrwidth</span> <span class="o">=</span> <span class="mf">0.25</span>   <span class="p">,</span>
                <span class="n">quiv_dens</span>  <span class="o">=</span> <span class="mf">0.5</span>       <span class="p">,</span> <span class="c1"># larger mean more excluded arrows</span>
                <span class="n">quiv_smax</span>  <span class="o">=</span> <span class="mi">10</span>        <span class="p">,</span> <span class="c1"># small arrow are scaled strong with factor smax, its off when smax=1</span>
                <span class="n">quiv_shiftL</span><span class="o">=</span> <span class="mi">2</span>         <span class="p">,</span> <span class="c1"># shift smothing function to the left</span>
                <span class="n">quiv_smooth</span><span class="o">=</span> <span class="mi">2</span>         <span class="p">,</span> <span class="c1"># slope of transitions zone, smaller value steeper transition</span>
                <span class="c1">#--- mesh -----------</span>
                <span class="n">do_mesh</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">mesh_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="c1">#--- bottom mask ----</span>
                <span class="n">do_bot</span>     <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">bot_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- topography -----</span>
                <span class="n">do_topo</span>    <span class="o">=</span> <span class="s1">&#39;tpc&#39;</span>     <span class="p">,</span> 
                <span class="n">topo_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">topo_cont</span>  <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> <span class="c1"># plot contour lines: True/False </span>
                <span class="n">topoc_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># contour line option</span>
                <span class="n">topo_contl</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># do contourline labels </span>
                <span class="n">topocl_opt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># contour line label options</span>
                <span class="c1">#--- landsea mask ---</span>
                <span class="n">do_lsm</span>     <span class="o">=</span> <span class="s1">&#39;fesom&#39;</span>   <span class="p">,</span> 
                <span class="n">lsm_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">lsm_res</span>    <span class="o">=</span> <span class="s1">&#39;low&#39;</span>     <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">do_boundbox</span><span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- colorbar -------</span>
                <span class="n">cb_label</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_lunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ltime</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ldep</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cb_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar option</span>
                <span class="n">cbl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar label option, fontsize ,...</span>
                <span class="n">cbtl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar ticklabel option, fontsize ,...</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># dictionary that defines axes and colorbar arangement</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>      <span class="p">,</span> <span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">,</span> <span class="s1">&#39;hcb&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot FESOM2 horizontal data slice as quiver plot:</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        :mesh:      fesom2 mesh object, with all mesh information</span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None) regional limitation of plot. For ortho...</span>
<span class="sd">                    box=[lonc, latc], nears...box=[lonc, latc, zoom], for all others box = </span>
<span class="sd">                    [lonmin, lonmax, latmin, latmax]</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>
<span class="sd"> </span>
<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;pc&#39;) which projection should be used, </span>
<span class="sd">                    - pc     ... PlateCarree         (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - merc   ... Mercator            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - rob    ... Robinson            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - eqearth... EqualEarth          (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - mol    ... Mollweide           (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - nps    ... NorthPolarStereo    (box=[-180, 180, &gt;0, latmax])</span>
<span class="sd">                    - sps    ... SouthPolarStereo    (box=[-180, 180, latmin, &lt;0])</span>
<span class="sd">                    - ortho  ... Orthographic        (box=[loncenter, latcenter]) </span>
<span class="sd">                    - nears  ... NearsidePerspective (box=[loncenter, latcenter, zoom]) </span>
<span class="sd">                    - channel... PlateCaree</span>

<span class="sd">        :do_ie2n:    bool, (default: False) do interpolation of data on elements towards nodes</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>

<span class="sd">        ___plot quiver parameters___________________________</span>

<span class="sd">        :do_quiv:   bool, (default: True), do cartopy quiver plot</span>

<span class="sd">        :quiv_opt:  dict, (default: dict()) additional options that are given to quiver plot routine</span>

<span class="sd">        :quiv_scalfac:  float, (default: 1.0)  bigger means larger arrows</span>

<span class="sd">        :quiv_arrwidth: float, (default: 0.25) scale arrow width</span>

<span class="sd">        :quiv_dens: float, (default: 0.5)  larger mean more excluded arrows</span>

<span class="sd">        :quiv_smax: float, (default: 10) small arrow are scaled strong with factor smax, its off when smax=1</span>

<span class="sd">        :quiv_shiftL: float, (default: 2) shift smothing function to the left</span>

<span class="sd">        :quiv_smooth: float, (default: 2) slope of transitions zone, smaller value steeper transition</span>

<span class="sd">        ___plot mesh________________________________________</span>

<span class="sd">        :do_mesh:   bool, (default: True), overlay FESOM grid over dataplot</span>

<span class="sd">        :mesh_opt:  dict, (default: dict()) additional options that are given to the mesh plotting via kwarg</span>

<span class="sd">        ___plot bottom mask_________________________________</span>

<span class="sd">        :do_bot:    bool, (default: True), overlay topographic bottom mask</span>

<span class="sd">        :bot_opt:   dict, (default: dict()) additional options that are given to the bottom mask plotting via kwarg</span>

<span class="sd">        ___plot topo________________________________________</span>

<span class="sd">        :do_topo:   str, (default: tpc) = </span>
<span class="sd">                    - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                    - tcf ... make contourf coor plot (tricontourf)  , # tpc:tripcolor, tcf:tricontourf    </span>

<span class="sd">        :topo_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    tripcolor or tricontourf via the kwarg argument</span>

<span class="sd">        :topo_cont: bool, (default: False) overlay contour line plot of data</span>

<span class="sd">        :topoc_opt: dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    tricontour via the kwarg argument</span>

<span class="sd">        :topo_contl: bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :topocl_opt: dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    clabel via the kwarg argument</span>

<span class="sd">         ___plot lsmask______________________________________</span>

<span class="sd">        :do_lsm:    str, (default: &#39;fesom&#39;), overlay FESOM grid inverted land sea mask</span>
<span class="sd">                    option are here:</span>
<span class="sd">                    </span>
<span class="sd">                    - fesom      ... grey fesom landsea mask</span>
<span class="sd">                    - stock      ... uses cartopy stock image</span>
<span class="sd">                    - bluemarble ... uses bluemarble image in folder tripyview/background/</span>
<span class="sd">                    - etopo      ... uses etopo image in folder tripyview/background/</span>

<span class="sd">        :lsm_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the landsea mask plotting via kwarg</span>

<span class="sd">        :lsm_res:   str, (default=&#39;low&#39;) resolution of bluemarble texture file either &#39;low&#39; or &#39;high&#39;</span>

<span class="sd">        ___plot cartopy gridlines____________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>

<span class="sd">        :do_boundbox: bool, (default: True) plot cartopy black bounding box. If you </span>
<span class="sd">                    make plots as a texture to use in blender, unity or pyvista the bounding box </span>
<span class="sd">                    has to be removed with do_boundbox=False</span>

<span class="sd">        ___colorbar_________________________________________</span>

<span class="sd">        :cb_label:  str, (default: None) if string its used as colorbar label, otherwise </span>
<span class="sd">                    information from data (&#39;long_name, short_name) are used</span>

<span class="sd">        :cb_lunit:  str, (default: None) if string its used as colorbar unit label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ltime:  str, (default: None) if string its used as colorbar time label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ldep:   str, (default: None) if string its used as colorbar depth label, </span>
<span class="sd">                    otherwise info from data are used                </span>

<span class="sd">        :cb_opt:    dict, (default: dict()) direct option for colorbar via kwarg</span>

<span class="sd">        :cbl_opt:   dict, (default: dict()) direct option for colorbar labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine </span>
<span class="sd">                    do_axes_arrange</span>

<span class="sd">        :axl_opt:   dict, (default: dict()) set option for axes labels (fontsize, ...)</span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings        , </span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - hcb  ... list of colorbar handles (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        hfig: returns figure handle </span>

<span class="sd">        hax: returns list with axes handle </span>

<span class="sd">        hcb: returns colorbar handle</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create box</span>
    <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">box</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="n">box</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="mi">180</span><span class="o">+</span><span class="n">mesh</span><span class="o">.</span><span class="n">focus</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="p">]</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">clock</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">box</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">ndat</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">ndat</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create mesh triangulation, when input data are unstructured</span>
    <span class="n">tri</span> <span class="o">=</span>  <span class="n">do_triangulation</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">do_triorig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_earea</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; set up color info</span>
    <span class="c1"># --&gt; setup normalization log10, symetric log10, None</span>
    <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="p">):</span>
        <span class="n">idsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="o">==</span><span class="n">ii</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">do_vec</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">do_vec</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span><span class="p">,</span> <span class="n">htop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">ndat</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ii_valid</span><span class="o">=</span><span class="n">ii</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">clock</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># prepare unstructured data for plotting, augment periodic </span>
            <span class="c1"># boundaries, interpolate from elements to nodes, kick out nan </span>
            <span class="c1"># values from plotting that are bottom topo  </span>
            <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">tri</span>   <span class="o">=</span> <span class="n">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">do_ie2n</span><span class="p">)</span>
            <span class="n">data_plot_v</span><span class="p">,</span> <span class="n">tri</span>   <span class="o">=</span> <span class="n">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">,</span> <span class="n">do_ie2n</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add color for ocean bottom</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">,</span> <span class="n">bot_opt</span><span class="o">=</span><span class="n">bot_opt</span><span class="p">)</span>
            <span class="n">hbot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grey topo</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_topo</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_topo</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_z</span><span class="p">),</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tri</span><span class="p">),</span> 
                             <span class="n">plt_opt</span><span class="o">=</span><span class="n">topo_opt</span><span class="p">,</span>
                             <span class="n">plt_contb</span><span class="o">=</span><span class="n">topo_cont</span> <span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">topoc_opt</span><span class="p">,</span>
                             <span class="n">plt_contl</span><span class="o">=</span><span class="n">topo_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">topocl_opt</span><span class="p">)</span>
            <span class="n">htop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grid mesh on top</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_mesh</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">mesh_opt</span><span class="o">=</span><span class="n">mesh_opt</span><span class="p">)</span>
            <span class="n">hmsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># do quiver computations</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_quiver</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_quiv</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">,</span> 
                               <span class="n">cinfo_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                               <span class="n">quiv_scalfac</span><span class="o">=</span><span class="n">quiv_scalfac</span><span class="p">,</span> <span class="n">quiv_arrwidth</span><span class="o">=</span><span class="n">quiv_arrwidth</span><span class="p">,</span> <span class="n">quiv_dens</span><span class="o">=</span><span class="n">quiv_dens</span><span class="p">,</span>
                               <span class="n">quiv_smax</span><span class="o">=</span><span class="n">quiv_smax</span><span class="p">,</span> <span class="n">quiv_shiftL</span><span class="o">=</span><span class="n">quiv_shiftL</span><span class="p">,</span> 
                               <span class="n">quiv_smooth</span><span class="o">=</span><span class="n">quiv_smooth</span><span class="p">,</span> <span class="n">quiv_opt</span><span class="o">=</span><span class="n">quiv_opt</span><span class="p">)</span>
            <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add mesh land-sea mask</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_lsmask</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_lsm</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">lsm_opt</span><span class="o">=</span><span class="n">lsm_opt</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">lsm_res</span><span class="p">)</span>
            <span class="n">hlsm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>  
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">ndat</span><span class="p">,</span> <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># is title  string:</span>
                <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="c1"># if title string is &#39;descript&#39; than use descript attribute from </span>
                    <span class="c1"># data to set plot title </span>
                    <span class="k">if</span> <span class="n">ax_title</span><span class="o">==</span><span class="s1">&#39;descript&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;descript&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">):</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                <span class="c1"># is title list of string        </span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># remove platecaree bounding box when used as image alpha map or texture</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">do_boundbox</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;geo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># add colorbar </span>
        <span class="k">if</span> <span class="n">hcb_ii</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">],</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> 
                             <span class="n">cb_label</span><span class="p">,</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># hfig.canvas.draw()   </span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>

    

    
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of horizontal slices</span>
<div class="viewcode-block" id="plot_vslice">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_vslice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_vslice</span><span class="p">(</span><span class="n">mesh</span>                   <span class="p">,</span> 
                <span class="n">data</span>                   <span class="p">,</span> 
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">box_idx</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">box_label</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">boxl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># option for box label string </span>
                <span class="n">cinfo</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># colormap info and defintion</span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">do_ie2n</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># interpolate element data to vertices</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="c1">#--- data -----------</span>
                <span class="n">do_plt</span>     <span class="o">=</span> <span class="s1">&#39;tpc&#39;</span>     <span class="p">,</span> <span class="c1"># tpc:tripcolor, tcf:tricontourf</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">plt_contb</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot background contour lines: True/False </span>
                <span class="n">pltcb_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># background contour line option</span>
                <span class="n">plt_contf</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot foreground contour lines: True/False </span>
                <span class="n">pltcf_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># foreground contour line option</span>
                <span class="n">plt_contr</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># plot reference contour lines: True/False </span>
                <span class="n">pltcr_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># reference contour line option</span>
                <span class="n">plt_contl</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># do contourline labels </span>
                <span class="n">pltcl_opt</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># contour line label options</span>
                <span class="n">do_smooth</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> <span class="c1"># apply convolution filterwarnings</span>
                <span class="n">smooth_opt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>     <span class="p">,</span> <span class="c1"># smothing filter size (ndi, nx)--&gt; default (3,9)</span>
                <span class="c1">#--- mesh -----------</span>
                <span class="n">do_mesh</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">mesh_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="c1">#--- bottom mask ----</span>
                <span class="n">do_bot</span>     <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">bot_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- landsea mask ---</span>
                <span class="n">do_lsm</span>     <span class="o">=</span> <span class="s1">&#39;fesom&#39;</span>   <span class="p">,</span> 
                <span class="n">lsm_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">lsm_res</span>    <span class="o">=</span> <span class="s1">&#39;low&#39;</span>     <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;yexp&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>    <span class="p">,</span>
                <span class="c1">#--- colorbar -------</span>
                <span class="n">cb_label</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_lunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ltime</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">cb_ldep</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">cb_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar option</span>
                <span class="n">cbl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar label option, fontsize ,...</span>
                <span class="n">cbtl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># colorbar ticklabel option, fontsize ,...</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># dictionary that defines axes and colorbar arangement</span>
                <span class="n">ax_xlim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">})</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.000</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.005</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>    <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">,</span> <span class="s1">&#39;hcb&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot FESOM2 horizontal data slice:</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :mesh:      fesom2 mesh object,  with all mesh information </span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None)  list with regional box limitation for index computation box can be: </span>

<span class="sd">                    - [&#39;global&#39;]   ... compute global index </span>
<span class="sd">                    - [shp.Reader] ... index region defined by shapefile </span>
<span class="sd">                    - [ [lonmin,lonmax,latmin, latmax], boxname] index region defined by rect box </span>
<span class="sd">                    - [ [ [px1,px2...], [py1,py2,...]], boxname] index region defined by polygon</span>
<span class="sd">                    - [ np.array(2 x npts), boxname] index region defined by polygon</span>

<span class="sd">        :box_idx:   int, (default: None) index in boxlist </span>

<span class="sd">        :box_label: str  (default: None) overwrites boxname string </span>

<span class="sd">        :boxl_opt:  dict (default: dict() additional options for boxlabel string (fontsize...)</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: None) is choosen here autometically by data attribute</span>
<span class="sd">                    proj, can be setted also from hand to ...</span>
<span class="sd">                    - index+depth+xy    </span>
<span class="sd">                    - index+depth+time  </span>
<span class="sd">                    - zmoc   </span>
<span class="sd">                    - dmoc</span>
<span class="sd">                    - dmoc+depth</span>
<span class="sd">                    - dmoc+dens</span>

<span class="sd">        :do_ie2n:   bool, (default: False) do interpolation of data on elements towards nodes</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>

<span class="sd">        ___plot data parameters_____________________________</span>

<span class="sd">        :do_plt:    str, (default: tpc)</span>
<span class="sd">                    - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                    - tcf ... make contourf color plot (tricontourf)</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                    or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb: bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt: dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contf: bool, (default: False) overlay thicker contour lines of the main colorbar steps (foreground)</span>

<span class="sd">        :pltcf_opt: dict, (default: dict()) foreground contour line option</span>

<span class="sd">        :plt_contr: bool, (default: False) overlay thick contour lines of reference color steps (reference)</span>

<span class="sd">        :pltcr_opt: dict, (default: dict()) reference contour line option</span>

<span class="sd">        :plt_contl: bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt: dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">        ___plot mesh________________________________________</span>

<span class="sd">        :do_mesh:   bool, (default: True), overlay FESOM grid over dataplot</span>

<span class="sd">        :mesh_opt:  dict, (default: dict()) additional options that are given to the mesh plotting via kwarg</span>

<span class="sd">        ___plot bottom mask_________________________________</span>
<span class="sd">        </span>
<span class="sd">        :do_bot:    bool, (default: True), overlay topographic bottom mask</span>

<span class="sd">        :bot_opt:   dict, (default: dict()) additional options that are given to the bottom mask plotting via kwarg</span>
<span class="sd"> </span>
<span class="sd">        ___plot cartopy gridlines____________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>

<span class="sd">        ___colorbar_________________________________________</span>

<span class="sd">        :cb_label:  str, (default: None) if string its used as colorbar label, otherwise </span>
<span class="sd">                    information from data (&#39;long_name, short_name) are used</span>

<span class="sd">        :cb_lunit:  str, (default: None) if string its used as colorbar unit label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ltime:  str, (default: None) if string its used as colorbar time label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ldep:   str, (default: None) if string its used as colorbar depth label, </span>
<span class="sd">                    otherwise info from data are used                </span>

<span class="sd">        :cb_opt:    dict, (default: dict()) direct option for colorbar via kwarg</span>

<span class="sd">        :cbl_opt:   dict, (default: dict()) direct option for colorbar labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine </span>
<span class="sd">                    do_axes_arrange</span>

<span class="sd">        :axl_opt:   dict, (default: dict()) set option for axes labels (fontsize, ...)</span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings        , </span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">    </span>
<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - hcb  ... list of colorbar handles (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>
<span class="sd">        </span>
<span class="sd">        :hax: returns list with axes handle </span>
<span class="sd">        </span>
<span class="sd">        :hcb: returns colorbar handle</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># check vertical plotting mode if index+depth+xy, zmoc, dmoc</span>
    <span class="k">if</span> <span class="n">proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="c1">#print(ncol, nrow)</span>
    
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">ndat</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">ndat</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; set up color info</span>
    <span class="c1"># --&gt; setup normalization log10, symetric log10, None</span>
    <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="p">):</span>
        <span class="n">idsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="o">==</span><span class="n">ii</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># setup my own colormap definition dictionary</span>
        <span class="n">cinfo_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span>   <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;index+depth+xy&#39;</span><span class="p">,</span> <span class="s1">&#39;index+depth+time&#39;</span><span class="p">]:</span>
            <span class="n">cinfo_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;do_index&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;box_idx&#39;</span><span class="p">:</span><span class="n">box_idx</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;zmoc&#39;</span> <span class="p">:</span>
            <span class="n">cinfo_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;do_moc&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;dmoc+depth&#39;</span> <span class="ow">or</span> <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;dmoc+dens&#39;</span><span class="p">:</span>
            <span class="n">cinfo_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;do_dmoc&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
        
        <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">cinfo_optdefault</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="o">**</span><span class="n">cinfo_optdefault</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">cinfo_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">idsel</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="o">**</span><span class="n">cinfo_optdefault</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># setup matplotlib rescaling options for, log10, slog10, or predefined array</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">norm_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">do_data_norm</span><span class="p">(</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">)</span> <span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">count_cb</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">ndat</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>        
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">ii_valid</span><span class="o">=</span><span class="n">ii</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">do_data_prepare_vslice</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">box_idx</span><span class="p">,</span>
                                                            <span class="n">do_smooth</span><span class="o">=</span><span class="n">do_smooth</span><span class="p">,</span> <span class="n">smooth_opt</span><span class="o">=</span><span class="n">smooth_opt</span><span class="p">)</span>
           
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add tripcolor or tricontourf plot </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_datareg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> 
                                <span class="n">cinfo_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> <span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                                <span class="n">plt_opt</span>  <span class="o">=</span><span class="n">plt_opt</span><span class="p">,</span>
                                <span class="n">plt_contb</span><span class="o">=</span><span class="n">plt_contb</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">pltcb_opt</span><span class="p">,</span>
                                <span class="n">plt_contf</span><span class="o">=</span><span class="n">plt_contf</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="n">pltcf_opt</span><span class="p">,</span>
                                <span class="n">plt_contr</span><span class="o">=</span><span class="n">plt_contr</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="n">pltcr_opt</span><span class="p">,</span>
                                <span class="n">plt_contl</span><span class="o">=</span><span class="n">plt_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">pltcl_opt</span><span class="p">)</span>
            <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">##__________________________________________________________________</span>
            <span class="c1">## add bottom  mask</span>
            <span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="n">ax_xlim</span><span class="p">,</span> <span class="n">ax_ylim</span>
            <span class="k">if</span>   <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">==</span><span class="s1">&#39;index+depth+xy&#39;</span><span class="p">:</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> 
                                <span class="n">data_plot</span><span class="o">=</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">bot_opt</span><span class="o">=</span><span class="n">bot_opt</span><span class="p">)</span>
        
            <span class="c1"># zmoc bottom patch</span>
            <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">==</span><span class="s1">&#39;zmoc&#39;</span><span class="p">:</span>
                <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">zlev</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> 
                                <span class="n">data_plot</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;botmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                <span class="n">bot_opt</span><span class="o">=</span><span class="n">bot_opt</span><span class="p">)</span> 
                
            <span class="c1"># dmoc when doeing z-coordinate projection bottom patch                   </span>
            <span class="k">elif</span> <span class="s1">&#39;dmoc&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="s1">&#39;ndens_zfh&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">or</span> <span class="s1">&#39;nz_rho&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span> <span class="ow">or</span><span class="s1">&#39;ndens_z&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">zlev</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> 
                                <span class="n">data_plot</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;botmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                <span class="n">bot_opt</span><span class="o">=</span><span class="n">bot_opt</span><span class="p">)</span>    
            <span class="n">hbot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">ndat</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> 
                                  <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                  <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="c1"># is title  string:</span>
                <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="p">:</span> 
                    <span class="c1"># if title string is &#39;descript&#39; than use descript attribute from </span>
                    <span class="c1"># data to set plot title </span>
                    <span class="k">if</span> <span class="n">box_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                        <span class="n">vname</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">loc_attrs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">box_idx</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vname</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> 
                        <span class="n">loc_attrs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                    
                    <span class="k">if</span> <span class="n">ax_title</span><span class="o">==</span><span class="s1">&#39;descript&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;descript&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">):</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                        
                <span class="c1"># is title list of string        </span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># set superior title</span>
            <span class="n">boxl_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mf">0.99</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mf">0.99</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> \
                                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;fontweight&#39;</span><span class="p">:</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="s1">&#39;transform&#39;</span><span class="p">:</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>\
                                    <span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;verticalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>                
            <span class="c1"># print transect labels</span>
            <span class="k">if</span>  <span class="n">box_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vname</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">loc_attrs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">box_idx</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                <span class="k">if</span>   <span class="s1">&#39;transect_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;transect_name&#39;</span><span class="p">]})</span>
                <span class="k">elif</span> <span class="s1">&#39;boxname&#39;</span>       <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;boxname&#39;</span><span class="p">]})</span>
            
            <span class="c1"># print precribed box_label</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box_label</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">box_label</span><span class="p">})</span>
            
            <span class="c1"># print list of prescribed box_label</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box_label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">box_label</span><span class="p">[</span><span class="n">ii</span><span class="p">]})</span> 
            
            <span class="c1"># print moc labels</span>
            <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zmoc&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+depth&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+dens&#39;</span><span class="p">]:</span>
                <span class="n">vname</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">loc_attrs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                <span class="k">if</span> <span class="s1">&#39;short_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]})</span>
                <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;verticalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;bottom&#39;</span><span class="p">})</span>
                
            <span class="n">boxl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">boxl_opt</span><span class="p">)</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">**</span><span class="n">boxl_optdefault</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># add colorbar </span>
        
        <span class="k">if</span> <span class="n">hcb_ii</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_label</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">cb_label2</span> <span class="o">=</span> <span class="n">cb_label</span><span class="p">[</span><span class="n">count_cb</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">cb_label2</span> <span class="o">=</span> <span class="n">cb_label</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">],</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                             <span class="n">cb_label2</span><span class="p">,</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                             <span class="n">box_idx</span><span class="o">=</span><span class="n">box_idx</span><span class="p">,</span> <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">],</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">do_rescale</span><span class="p">,</span> 
                                <span class="n">cb_label2</span><span class="p">,</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm_plot</span><span class="p">[</span> <span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">ii_valid</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="p">],</span> 
                                <span class="n">box_idx</span><span class="o">=</span><span class="n">box_idx</span><span class="p">,</span> <span class="n">cb_opt</span><span class="o">=</span><span class="n">cb_opt</span><span class="p">,</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="n">cbl_opt</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
                
            <span class="n">count_cb</span><span class="o">=</span><span class="n">count_cb</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># hfig.canvas.draw()   </span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>

 
 

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of horizontal lines over index region (e.g. heatflux vs lon, lat)</span>
<div class="viewcode-block" id="plot_hline">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_hline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_hline</span><span class="p">(</span><span class="n">data</span>                   <span class="p">,</span> 
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">box_idx</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">box_label</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">boxl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># option for box label string </span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;index+xy&#39;</span><span class="p">,</span>
                <span class="n">n_cycl</span>     <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">do_allcycl</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">do_shdw</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span>
                <span class="n">do_mean</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="c1">#--- data -----------</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">mark_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_xlabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_xunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_yunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># dictionary that defines axes and colorbar arangement</span>
                <span class="n">ax_xlim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">})</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.000</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.005</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>    <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do plotting of horizontal lines over index region (e.g. heatflux vs lon, lat)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None)  list with regional box limitation for index computation box can be: </span>

<span class="sd">                    - [&#39;global&#39;]   ... compute global index </span>
<span class="sd">                    - [shp.Reader] ... index region defined by shapefile </span>
<span class="sd">                    - [ [lonmin,lonmax,latmin, latmax], boxname] index region defined by rect box </span>
<span class="sd">                    - [ [ [px1,px2...], [py1,py2,...]], boxname] index region defined by polygon</span>
<span class="sd">                    - [ np.array(2 x npts) boxname] index region defined by polygon</span>

<span class="sd">        :box_idx:   int, (default: None) index in boxlist </span>

<span class="sd">        :box_label: str  (default: None) overwrites boxname string </span>

<span class="sd">        :boxl_opt:  dict (default: dict() additional options for boxlabel string (fontsize...)</span>
<span class="sd">        </span>
<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;index+xy&#39;)</span>
<span class="sd">                        </span>
<span class="sd">        :n_cycl:    int, (default: None) How many spinup cycles are contained</span>
<span class="sd">                    in the data_list. Info is needed when do_allcycl=True,</span>

<span class="sd">        :do_allcycl: bool, (default: False) plot all spinupcycles based on colormap value </span>

<span class="sd">        :do_shdw:   bool, (default: True) give lines a black outline</span>

<span class="sd">        :do_mean:   bool, (default: False) plot triangle on the left side that indicates </span>
<span class="sd">                    the mean value</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>

<span class="sd">        ___plot data parameters_____________________________</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    line plot routine via the kwarg argument</span>

<span class="sd">        :mark_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    control the line markers via the kwarg argument</span>

<span class="sd">        ___plot gridlines___________________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>
<span class="sd">                    </span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_xlabel: str, (default: None) overwrites default xlabel</span>

<span class="sd">        :ax_ylabel: str, (default: None) overwrites default ylabel</span>

<span class="sd">        :ax_xunit:  str, (default: None) overwrites default xlabel unit</span>

<span class="sd">        :ax_yunit:  str, (default: None) overwrites default ylabel unit</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine do_axes_arrange</span>

<span class="sd">        :ax_xlim:   list (default: None) overright data related xlimits</span>

<span class="sd">        :ax_ylim:   list (default: None) overright data related ylimits  </span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings</span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>

<span class="sd">        :hax: returns list with axes handle </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="c1"># keep in mind ndat is here the number index boxes in thre list, not the number </span>
    <span class="c1"># of datas that are loaded</span>
    <span class="n">nbox</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># check vertical plotting mode if index+depth+xy, zmoc, dmoc</span>
    <span class="k">if</span> <span class="n">proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;ax_sharex&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;ax_sharey&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;ax_dt&#39;</span><span class="p">:</span><span class="mf">1.75</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">nbox</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">nbox</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># setup colormap</span>
    <span class="k">if</span> <span class="n">do_allcycl</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ndat</span><span class="o">/</span><span class="n">n_cycl</span><span class="p">),</span> <span class="n">n_cycl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">list_strdatalabel</span><span class="p">,</span><span class="n">list_strboxlabel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">nbox</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="n">optline</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">:</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
            <span class="n">optmark</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;markeredgewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="s1">&#39;clip_on&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span> <span class="c1">#&#39;clip_box&#39;:False,</span>
            <span class="n">list_lstyle</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdotdotted&#39;</span><span class="p">]</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">allinone</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span>   <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span>   <span class="n">nbox</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">box_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">nbox</span> <span class="o">&gt;</span>  <span class="mi">1</span><span class="p">:</span> 
                    <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nbox</span><span class="p">)),</span> <span class="kc">True</span>
                    
            <span class="k">elif</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&lt;=</span> <span class="n">nbox</span><span class="p">:</span>   
                <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="kc">False</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># If nrow*ncol=1    &amp;&amp; nbox &gt; 1: plot all box lines in one figure panel</span>
            <span class="c1">#    nrow*ncol=nbox &amp;&amp; nbox &gt; 1: plot each box lines in separate figure panel</span>
            <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">box_idx</span><span class="p">:</span>
            
                <span class="c1">#___________________________________________________________________</span>
                <span class="n">cnt</span><span class="p">,</span> <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">):</span>
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">min</span><span class="p">()]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ymax</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="k">if</span>   <span class="s1">&#39;lat&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">]:</span> 
                        <span class="n">data_x</span>     <span class="o">=</span>  <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> 
                        <span class="n">str_xlabel</span> <span class="o">=</span> <span class="s1">&#39;Latitude&#39;</span> <span class="k">if</span> <span class="n">ax_xlabel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax_xlabel</span>
                    <span class="k">elif</span> <span class="s1">&#39;lon&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">]:</span> 
                        <span class="n">data_x</span>     <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> 
                        <span class="n">str_xlabel</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span> <span class="k">if</span> <span class="n">ax_xlabel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ax_xlabel</span> 
                    <span class="k">if</span> <span class="n">ax_xunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="s1">&#39; / deg&#39;</span>
                    <span class="k">else</span>               <span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="n">ax_xunit</span>
                    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">data_x</span><span class="o">.</span><span class="n">min</span><span class="p">()]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">data_x</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">loc_attrs</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                    <span class="n">str_ylabel</span><span class="p">,</span> <span class="n">str_llabel</span><span class="p">,</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">ax_ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span>   <span class="s1">&#39;long_name&#39;</span>     <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="s1">&#39;short_name&#39;</span>    <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">ax_ylabel</span>
                    <span class="k">if</span> <span class="n">ax_yunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span> <span class="n">ax_yunit</span>
                        
                    <span class="k">if</span>   <span class="s1">&#39;descript&#39;</span>      <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_llabel</span> <span class="o">=</span> <span class="n">str_llabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;boxname&#39;</span>       <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;boxname&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;transect_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;transect_name&#39;</span><span class="p">]</span>    
                    <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;MOC&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bi</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strdatalabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_llabel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strboxlabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="c1"># plot lines </span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="n">list_lstyle</span><span class="p">[</span><span class="n">bi</span><span class="p">]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mark_opt</span><span class="p">)</span>
                    
                    <span class="c1"># plot black underlying shadow slightly wider than line on top </span>
                    <span class="k">if</span> <span class="n">do_shdw</span><span class="p">:</span>
                        <span class="n">optline2</span> <span class="o">=</span> <span class="n">optline</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">optline2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="n">optline</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="o">**</span><span class="n">optline2</span><span class="p">)</span>
                    
                    <span class="c1"># plot actual line with color </span>
                    <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">str_llabel</span><span class="p">,</span> <span class="o">**</span><span class="n">optline</span><span class="p">)</span>
                    <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                    
                    <span class="c1"># plot mean value with left triangle </span>
                    <span class="k">if</span> <span class="n">do_mean</span><span class="p">:</span> 
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">optmark</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">cnt</span>      <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="n">cnt_cycl</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cnt_cycl</span><span class="o">&gt;=</span> <span class="n">n_cycl</span><span class="p">:</span> <span class="n">cnt_cycl</span><span class="o">=</span><span class="mi">0</span>
                
            <span class="c1">#___________________________________________________________________</span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">str_xlabel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">str_ylabel</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="n">ax_xlim</span><span class="p">,</span> <span class="n">ax_ylim</span> 
            <span class="k">if</span> <span class="n">ax_xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_xlim0</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ax_ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_ylim0</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                  <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">,</span> <span class="n">do_rescale</span><span class="o">=</span><span class="n">do_rescale</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#_______________________________________________________________________</span>
            <span class="c1"># do legend and legend positioning </span>
            <span class="c1"># --&gt;bbox_to_anchor=(1.0, 1.0), loc=&#39;upper left&#39; this should make sure </span>
            <span class="c1">#    that the legend is always outside in the upper right corner </span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">coli</span><span class="o">==</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">rowi</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">legend1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="n">list_strdatalabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                    
                    <span class="c1"># make box list legend:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="o">*</span><span class="n">nbox</span><span class="p">,</span> <span class="n">ndat</span><span class="p">)]</span>
                    <span class="c1"># make legend box lines always black, just show linestyle </span>
                    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span> <span class="n">lines</span><span class="p">[</span><span class="n">li</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">list_strboxlabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span> <span class="c1">#bbox_to_anchor=(1.5, 1.5))</span>
                    <span class="c1"># box label becomes here axes title</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                <span class="k">else</span>                        <span class="p">:</span> 
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                    
         
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>

    

    
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plotting of mean indices over depth (e.g. vertical profiles)</span>
<div class="viewcode-block" id="plot_vline">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_vline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_vline</span><span class="p">(</span><span class="n">data</span>                   <span class="p">,</span> 
                <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">box_idx</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">box_label</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">boxl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># option for box label string </span>
                <span class="n">cinfo</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> <span class="c1"># colormap info and defintion</span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;index+depth&#39;</span><span class="p">,</span>
                <span class="n">n_cycl</span>     <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">do_allcycl</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">do_shdw</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span>
                <span class="n">do_mean</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">do_rescale</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="c1">#--- data -----------</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">mark_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;yexp&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>    <span class="p">,</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_xlabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_xunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_yunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># dictionary that defines axes and colorbar arangement</span>
                <span class="n">ax_xlim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">})</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.000</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.005</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>    <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">],</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do plotting of mean indices over depth (e.g. vertical profiles)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None)  list with regional box limitation for index computation box can be: </span>

<span class="sd">                    - [&#39;global&#39;]   ... compute global index </span>
<span class="sd">                    - [shp.Reader] ... index region defined by shapefile </span>
<span class="sd">                    - [ [lonmin,lonmax,latmin, latmax], boxname] index region defined by rect box </span>
<span class="sd">                    - [ [ [px1,px2...], [py1,py2,...]], boxname] index region defined by polygon</span>
<span class="sd">                    - [ np.array(2 x npts) boxname] index region defined by polygon</span>

<span class="sd">        :box_idx:   int, (default: None) index in boxlist </span>

<span class="sd">        :box_label: str, (default: None) overwrites boxname string </span>

<span class="sd">        :boxl_opt:  dict, (default: dict() additional options for boxlabel string (fontsize...)</span>
<span class="sd">        </span>
<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;index+xy&#39;)</span>

<span class="sd">        :n_cycl:    int, (default: None) How many spinup cycles are contained</span>
<span class="sd">                    in the data_list. Info is needed when do_allcycl=True,</span>

<span class="sd">        :do_allcycl: bool, (default: False) plot all spinupcycles based on colormap value </span>

<span class="sd">        :do_shdw:   bool, (default: True) give lines a black outline</span>

<span class="sd">        :do_mean:   bool, (default: False) plot triangle on the left side that indicates </span>
<span class="sd">                    the mean value</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>

<span class="sd">         ___plot data parameters_____________________________</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    line plot routine via the kwarg argument</span>

<span class="sd">        :mark_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    control the line markers via the kwarg argument</span>

<span class="sd">        ___plot gridlines___________________________________</span>
<span class="sd">    </span>
<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>
<span class="sd">                    </span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_xlabel: str, (default: None) overwrites default xlabel</span>

<span class="sd">        :ax_ylabel: str, (default: None) overwrites default ylabel</span>

<span class="sd">        :ax_xunit:  str, (default: None) overwrites default xlabel unit</span>

<span class="sd">        :ax_yunit:  str, (default: None) overwrites default ylabel unit</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine do_axes_arrange</span>

<span class="sd">        :ax_xlim:   list (default: None) overright data related xlimits</span>

<span class="sd">        :ax_ylim:   list (default: None) overright data related ylimits  </span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings</span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">    </span>
<span class="sd">        ___set output_________________________________</span>

<span class="sd">        nargout:    list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>

<span class="sd">        :hax: returns list with axes handle </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="c1"># keep in mind ndat is here the number index boxes in thre list, not the number </span>
    <span class="c1"># of datas that are loaded</span>
    <span class="n">nbox</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># check vertical plotting mode if index+depth+xy, zmoc, dmoc</span>
    <span class="k">if</span> <span class="n">proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;ax_sharex&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;ax_sharey&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;ax_dt&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">nbox</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">nbox</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># setup colormap</span>
    <span class="k">if</span> <span class="n">do_allcycl</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ndat</span><span class="o">/</span><span class="n">n_cycl</span><span class="p">),</span> <span class="n">n_cycl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">list_strdatalabel</span><span class="p">,</span><span class="n">list_strboxlabel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">nbox</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="n">optline</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">:</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
            <span class="n">optmark</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;markeredgewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="s1">&#39;clip_on&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span> <span class="c1">#&#39;clip_box&#39;:False, </span>
            <span class="n">list_lstyle</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdotdotted&#39;</span><span class="p">]</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">allinone</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span>   <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span>   <span class="n">nbox</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">box_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">nbox</span> <span class="o">&gt;</span>  <span class="mi">1</span><span class="p">:</span> 
                    <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nbox</span><span class="p">)),</span> <span class="kc">True</span>
                    
            <span class="k">elif</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&gt;=</span> <span class="n">nbox</span><span class="p">:</span>   
                <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="kc">False</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># If nrow*ncol=1    &amp;&amp; nbox &gt; 1: plot all box lines in one figure panel</span>
            <span class="c1">#    nrow*ncol=nbox &amp;&amp; nbox &gt; 1: plot each box lines in separate figure panel</span>
            <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">box_idx</span><span class="p">:</span>
                
                <span class="c1">#___________________________________________________________________</span>
                <span class="c1"># prepare regular gridded data for plotting</span>
                <span class="n">cnt</span><span class="p">,</span> <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">):</span>
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data_x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_x</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_x</span><span class="p">)])</span>
                    
                    <span class="c1"># in case you plot anomalous Kv data, than they can be negativ. If</span>
                    <span class="c1"># than do_rescale ist setted to log10 it cant scale the x-axis </span>
                    <span class="c1"># and creates a error message</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">data_x</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;log10&#39;</span><span class="p">:</span> <span class="n">do_rescale</span><span class="o">=</span><span class="s1">&#39;slog10&#39;</span>
                    <span class="k">if</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span> 
                        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmax</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xmax</span><span class="p">)])</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">data_y</span><span class="p">,</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;Depth / m&#39;</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_y</span><span class="p">)]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ymax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_y</span><span class="p">)])</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">loc_attrs</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                    <span class="n">str_xlabel</span><span class="p">,</span> <span class="n">str_llabel</span><span class="p">,</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">ax_xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span>   <span class="s1">&#39;long_name&#39;</span>     <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                        <span class="k">elif</span> <span class="s1">&#39;short_name&#39;</span>    <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">ax_xlabel</span>
                    <span class="k">if</span> <span class="n">ax_xunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span> <span class="n">ax_xunit</span>
                        
                    <span class="k">if</span>   <span class="s1">&#39;descript&#39;</span>      <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_llabel</span> <span class="o">=</span> <span class="n">str_llabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;boxname&#39;</span>       <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;boxname&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;transect_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span> <span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;transect_name&#39;</span><span class="p">]</span>
                    <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;MOC&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bi</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strdatalabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_llabel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strboxlabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="c1"># plot lines </span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="n">list_lstyle</span><span class="p">[</span><span class="n">bi</span><span class="p">]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mark_opt</span><span class="p">)</span>
                    
                    <span class="c1"># plot black underlying shadow slightly wider than line on top </span>
                    <span class="k">if</span> <span class="n">do_shdw</span><span class="p">:</span>
                        <span class="n">optline2</span> <span class="o">=</span> <span class="n">optline</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">optline2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="n">optline</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="o">**</span><span class="n">optline2</span><span class="p">)</span>
                        
                    <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">str_llabel</span><span class="p">,</span> <span class="o">**</span><span class="n">optline</span><span class="p">)</span>
                    <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                    
                    <span class="c1"># plot mean value with left triangle </span>
                    <span class="k">if</span> <span class="n">do_mean</span><span class="p">:</span> 
                        <span class="n">auxx</span><span class="p">,</span> <span class="n">auxy</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">data_y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">auxy</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">auxx</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">auxx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">auxx</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">auxx</span><span class="o">*</span><span class="n">auxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">auxy</span><span class="p">),</span> <span class="n">ymax</span><span class="o">+</span><span class="p">(</span><span class="n">data_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">optmark</span><span class="p">)</span>
                        <span class="k">del</span><span class="p">(</span><span class="n">auxx</span><span class="p">,</span><span class="n">auxy</span><span class="p">)</span>
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">cnt</span>      <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="n">cnt_cycl</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cnt_cycl</span><span class="o">&gt;=</span> <span class="n">n_cycl</span><span class="p">:</span> <span class="n">cnt_cycl</span><span class="o">=</span><span class="mi">0</span>
                        
                <span class="c1">#___________________________________________________________________</span>
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> 
                    <span class="c1"># wrap xlabel string when they are to long</span>
                    <span class="c1"># Estimate the width of the axes dynamically</span>
                    <span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
                    <span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()</span>
                    <span class="n">axes_width_px</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">fig_width</span> <span class="o">*</span> <span class="n">fig_dpi</span>
                    
                    <span class="c1"># Estimate the width of the axes in terms of characters</span>
                    <span class="c1"># font_size = plt.rcParams[&#39;font.size&#39;]</span>
                    <span class="n">font_size</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
                    <span class="n">max_chars_per_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">axes_width_px</span> <span class="o">/</span> <span class="p">(</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.6</span><span class="p">))</span>  <span class="c1"># Empirical factor for font size to character width ratio</span>
                    <span class="n">str_xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">str_xlabel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">max_chars_per_line</span><span class="p">))</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">str_xlabel</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> 
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">str_ylabel</span><span class="p">)</span>
            
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="n">ax_ylim</span>
            <span class="k">if</span> <span class="n">ax_ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_ylim0</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ax_xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_xlim0</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]</span>
            
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                  <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">,</span> <span class="n">do_rescale</span><span class="o">=</span><span class="n">do_rescale</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
            
            <span class="c1">#_______________________________________________________________________</span>
            <span class="c1"># do legend and legend positioning </span>
            <span class="c1"># --&gt;bbox_to_anchor=(1.0, 1.0), loc=&#39;upper left&#39; this should make sure </span>
            <span class="c1">#    that the legend is always outside in the upper right corner </span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">coli</span><span class="o">==</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">rowi</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">legend1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="n">list_strdatalabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                    
                    <span class="c1"># make box list legend:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="o">*</span><span class="n">nbox</span><span class="p">,</span> <span class="n">ndat</span><span class="p">)]</span>
                    <span class="c1"># make legend box lines always black, just show linestyle </span>
                    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span> <span class="n">lines</span><span class="p">[</span><span class="n">li</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">list_strboxlabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span> <span class="c1">#bbox_to_anchor=(1.5, 1.5))</span>
                    <span class="c1"># box label becomes here axes title</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                <span class="k">else</span>                        <span class="p">:</span> 
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
         
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>

    


<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do plot timeseries of mean index</span>
<div class="viewcode-block" id="plot_tline">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.plot_tline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_tline</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
                <span class="n">box</span><span class="p">,</span> 
                <span class="n">box_idx</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">box_label</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">boxl_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> <span class="c1"># option for box label string </span>
                <span class="n">nrow</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of row in figures panel</span>
                <span class="n">ncol</span>       <span class="o">=</span> <span class="mi">1</span>         <span class="p">,</span> <span class="c1"># number of column in figure panel</span>
                <span class="n">proj</span>       <span class="o">=</span> <span class="s1">&#39;index+time&#39;</span><span class="p">,</span>
                <span class="n">n_cycl</span>     <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">do_allcycl</span> <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">do_concat</span>  <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span> 
                <span class="n">do_shdw</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span>
                <span class="n">do_mean</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span>
                <span class="n">do_std</span>     <span class="o">=</span> <span class="kc">False</span>      <span class="p">,</span>
                <span class="c1">#--- data -----------</span>
                <span class="n">plt_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">mark_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- gridlines ------</span>
                <span class="n">do_grid</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="p">,</span> 
                <span class="n">grid_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- axes -----------</span>
                <span class="n">ax_title</span>   <span class="o">=</span> <span class="s1">&#39;descript&#39;</span><span class="p">,</span>
                <span class="n">ax_xlabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylabel</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_xunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_yunit</span>   <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">ax_opt</span>     <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">axl_opt</span>    <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="n">ax_xlim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="n">ax_ylim</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span>
                <span class="c1">#--- enumerate axes -</span>
                <span class="n">do_enum</span>    <span class="o">=</span> <span class="kc">False</span>     <span class="p">,</span>
                <span class="n">enum_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span> 
                <span class="n">enum_str</span>   <span class="o">=</span> <span class="p">[]</span>        <span class="p">,</span> 
                <span class="n">enum_x</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">]</span>   <span class="p">,</span> 
                <span class="n">enum_y</span>     <span class="o">=</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">]</span>    <span class="p">,</span>
                <span class="n">enum_dir</span>   <span class="o">=</span> <span class="s1">&#39;lr&#39;</span>      <span class="p">,</span><span class="c1"># prescribed list of enumeration strings</span>
                <span class="c1">#--- save figure ----</span>
                <span class="n">do_save</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="p">,</span> 
                <span class="n">save_dpi</span>   <span class="o">=</span> <span class="mi">300</span>       <span class="p">,</span>
                <span class="n">save_opt</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>    <span class="p">,</span>
                <span class="c1">#--- set output -----</span>
                <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">],</span>
                <span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do plotting of mean indices over time (e.g. time-series)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">        :data:      xarray dataset object, or list of xarray dataset object</span>

<span class="sd">        :box:       None, list (default: None)  list with regional box limitation for index computation box can be: </span>

<span class="sd">                    - [&#39;global&#39;]   ... compute global index </span>
<span class="sd">                    - [shp.Reader] ... index region defined by shapefile </span>
<span class="sd">                    - [ [lonmin,lonmax,latmin, latmax], boxname] index region defined by rect box </span>
<span class="sd">                    - [ [ [px1,px2...], [py1,py2,...]], boxname] index region defined by polygon</span>
<span class="sd">                    - [ np.array(2 x npts) boxname] index region defined by polygon</span>

<span class="sd">        :box_idx:   int, (default: None) index in boxlist </span>

<span class="sd">        :box_label: str  (default: None) overwrites boxname string </span>

<span class="sd">        :boxl_opt:  dict (default: dict() additional options for boxlabel string (fontsize...)</span>
<span class="sd">        </span>
<span class="sd">        :nrow:      int, (default: 1) number of columns when plotting multiple data panels</span>

<span class="sd">        :ncol:      int, (default: 1) number of rows when plotting multiple data panels</span>

<span class="sd">        :proj:      str, (default: &#39;index+xy&#39;)</span>
<span class="sd">                        </span>
<span class="sd">        :n_cycl:    int, (default: None) How many spinup cycles are contained</span>
<span class="sd">                    in the data_list. Info is needed when do_allcycl=True,</span>

<span class="sd">        :do_allcycl: bool, (default: False) plot all spinupcycles based on colormap value </span>

<span class="sd">        :do_concat: bool, (default: False) attache time-series of the the same spinup</span>
<span class="sd">                    cycle behind each other. Create one long spinup time-series</span>

<span class="sd">        :do_shdw:   bool, (default: True) give lines a black outline</span>

<span class="sd">        :do_mean:   bool, (default: False) plot triangle on the left side that indicates </span>
<span class="sd">                    the mean value</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">        </span>
<span class="sd">        ___plot data parameters_____________________________</span>

<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    line plot routine via the kwarg argument</span>

<span class="sd">        :mark_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    control the line markers via the kwarg argument</span>

<span class="sd">        ___plot gridlines___________________________________</span>

<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>
<span class="sd">                    </span>

<span class="sd">        ___axes______________________________________</span>

<span class="sd">        :ax_title:  str, (default: &#39;descript&#39;) If &#39;descript&#39; use descript attribute </span>
<span class="sd">                    in data to title label axes, If &#39;str&#39; use this string to label axes</span>

<span class="sd">        :ax_xlabel: str, (default: None) overwrites default xlabel</span>

<span class="sd">        :ax_ylabel: str, (default: None) overwrites default ylabel</span>

<span class="sd">        :ax_xunit:  str, (default: None) overwrites default xlabel unit</span>

<span class="sd">        :ax_yunit:  str, (default: None) overwrites default ylabel unit</span>

<span class="sd">        :ax_opt:    dict, (default: dict()) set option for axes arangement see subroutine do_axes_arrange</span>

<span class="sd">        :ax_xlim:   list (default: None) overright data related xlimits</span>

<span class="sd">        :ax_ylim:   list (default: None) overright data related ylimits  </span>

<span class="sd">        ___enumerate_________________________________</span>

<span class="sd">        :do_enum:   bool, (default: False) do enumeration of axes with a), b), c) ...</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings</span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in axes coordinates</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to right, &#39;ud&#39; from up to down</span>

<span class="sd">        ___save figure________________________________</span>

<span class="sd">        :do_save:   str, (default: None) if None figure will by not saved, if string figure </span>
<span class="sd">                    will be saved, strings must give directory and filename  where to save.</span>

<span class="sd">        :save_dpi:  int, (default: 300) dpi resolution at which the figure is saved</span>

<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>

<span class="sd">        ___set output_________________________________</span>

<span class="sd">        :nargout:   list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;]) list of variables that are given </span>
<span class="sd">                    out from the routine. </span>
<span class="sd">                    Default: </span>
<span class="sd">                    </span>
<span class="sd">                    - hfig ... figure handle</span>
<span class="sd">                    - hax  ... list of axes handle </span>
<span class="sd">                    - (every variable that is defined in this subroutine can become output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig: returns figure handle </span>

<span class="sd">        :hax: returns list with axes handle </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patheffects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">path_effects</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">MultipleLocator</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; check if input data is a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="n">ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">nbox</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">#print(ndat, nbox)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># check vertical plotting mode if index+depth+xy, zmoc, dmoc</span>
    <span class="k">if</span> <span class="n">proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">],</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;proj&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span> <span class="n">proj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;proj&#39;</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; create projection</span>
    <span class="n">proj_to</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># proj is string </span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
        <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1"># proj is cartopy projection object</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="c1"># proj is list of cartopy projection objects or string</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> 
        <span class="n">proj_to</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proj_ii</span> <span class="ow">in</span> <span class="n">proj</span><span class="p">:</span>
            <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> 
                <span class="n">proj_dum</span><span class="p">,</span> <span class="n">box</span> <span class="o">=</span> <span class="n">do_projection</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj_ii</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_dum</span><span class="p">)</span>                
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>    
                <span class="n">proj_to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proj_ii</span><span class="p">)</span>    

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; pre-arange axes</span>
    <span class="n">ax_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">proj_to</span><span class="p">,</span> <span class="s1">&#39;ax_sharey&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,})</span>
    <span class="n">ax_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ax_opt</span><span class="p">)</span>
    <span class="n">hfig</span><span class="p">,</span> <span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">,</span> <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">do_axes_arrange</span><span class="p">(</span><span class="n">ncol</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="o">**</span><span class="n">ax_optdefault</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span><span class="o">=</span><span class="n">cb_plt_idx</span><span class="p">[:</span><span class="n">ndat</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; axes enumeration </span>
    <span class="n">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">[:</span><span class="n">ndat</span><span class="p">],</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_opt</span><span class="o">=</span><span class="n">enum_opt</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="n">enum_str</span><span class="p">,</span> 
                       <span class="n">enum_x</span><span class="o">=</span><span class="n">enum_x</span><span class="p">,</span> <span class="n">enum_y</span><span class="o">=</span><span class="n">enum_y</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="n">enum_dir</span><span class="p">)</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># setup colormap</span>
    <span class="k">if</span> <span class="n">do_allcycl</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ndat</span><span class="o">/</span><span class="n">n_cycl</span><span class="p">),</span> <span class="n">n_cycl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">do_concat</span><span class="p">:</span> <span class="n">do_concat</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">categorical_cmap</span><span class="p">(</span><span class="n">ndat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; loop over axes</span>
    <span class="n">hp</span><span class="p">,</span> <span class="n">hbot</span><span class="p">,</span> <span class="n">hmsh</span><span class="p">,</span> <span class="n">hlsm</span><span class="p">,</span> <span class="n">hgrd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">cnt</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">list_strdatalabel</span><span class="p">,</span><span class="n">list_strboxlabel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">hcb_ii</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">hcb</span><span class="p">)):</span>
        <span class="c1"># if there are no ddatra to fill axes, make it invisible </span>
        <span class="k">if</span> <span class="n">ii</span><span class="o">&gt;=</span><span class="n">nbox</span><span class="p">:</span> 
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="c1"># axis is normally fillt with data    </span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">ii_valid</span><span class="o">=</span><span class="n">ii</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># prepare regular gridded data for plotting</span>
            <span class="n">optline</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;markerfacecolor&#39;</span><span class="p">:</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
            <span class="n">optmark</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;markersize&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;markeredgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;markeredgewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="s1">&#39;clip_on&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span> <span class="c1">#&#39;clip_box&#39;:False, </span>
            <span class="n">list_lstyle</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="s1">&#39;dashdotdotted&#39;</span><span class="p">]</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">allinone</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">box_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span>   <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span>   <span class="n">nbox</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">box_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">nbox</span> <span class="o">&gt;</span>  <span class="mi">1</span><span class="p">:</span> 
                        <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nbox</span><span class="p">)),</span> <span class="kc">True</span>
                        
                <span class="k">elif</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span> <span class="o">&gt;=</span> <span class="n">nbox</span><span class="p">:</span>   
                    <span class="n">box_idx</span><span class="p">,</span> <span class="n">allinone</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="kc">False</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># If nrow*ncol=1    &amp;&amp; nbox &gt; 1: plot all box lines in one figure panel</span>
            <span class="c1">#    nrow*ncol=nbox &amp;&amp; nbox &gt; 1: plot each box lines in separate figure panel</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">box_idx</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">box_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_idx</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">box_idx</span><span class="p">:</span>
                <span class="c1">#___________________________________________________________________</span>
                <span class="c1"># prepare regular gridded data for plotting</span>
                <span class="n">cnt</span><span class="p">,</span> <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">xmax_list</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">):</span>
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">vname</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data_y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">min</span><span class="p">()]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ymax</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="n">data_x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="c1"># total number of days per year considers leap years</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># data contain only mean seasonal cycle </span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">))</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
                        <span class="k">else</span><span class="p">:</span>    
                            <span class="n">dperyr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span><span class="p">,</span> <span class="mi">366</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
                            <span class="c1"># time vector in units of years</span>
                            <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span><span class="o">-</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">dperyr</span>   
                    <span class="k">if</span> <span class="n">cnt_cycl</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">do_concat</span><span class="p">:</span> 
                        <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">cnt_cycl</span><span class="c1"># + (data_x[1]-data_x[0])</span>
                        <span class="n">data_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_x0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_x</span><span class="p">))</span>
                        <span class="n">data_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_y0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_y</span><span class="p">))</span>
                        
                        
                    <span class="c1">#data_x = data_x.values</span>
                    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">data_x</span><span class="o">.</span><span class="n">min</span><span class="p">()]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">data_x</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
                    <span class="n">data_x0</span><span class="p">,</span> <span class="n">data_y0</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span>
                    <span class="n">xmax_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="c1"># set labels</span>
                    <span class="n">loc_attrs</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">bi</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
                    <span class="n">str_xlabel</span><span class="p">,</span> <span class="n">str_ylabel</span><span class="p">,</span> <span class="n">str_llabel</span><span class="p">,</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                    
                    <span class="k">if</span> <span class="n">ax_xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">str_xlabel</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
                        <span class="k">if</span>   <span class="s1">&#39;add2xlabel&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;add2xlabel&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">ax_xunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="s1">&#39; / years&#39;</span>
                        <span class="k">else</span>               <span class="p">:</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">str_xlabel</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="n">ax_xunit</span> 
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">ax_xlabel</span>
                    
                    <span class="k">if</span> <span class="n">ax_ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span>   <span class="s1">&#39;long_name&#39;</span>  <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="s1">&#39;short_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]</span>
                        <span class="k">if</span>   <span class="s1">&#39;add2ylabel&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="s1">&#39; &#39;</span>  <span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;add2ylabel&#39;</span><span class="p">]</span>
                        
                        <span class="k">if</span> <span class="n">ax_yunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">if</span>   <span class="s1">&#39;units&#39;</span>      <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">str_ylabel</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span> <span class="n">ax_yunit</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">ax_ylabel</span>
                    
                    <span class="k">if</span>   <span class="s1">&#39;descript&#39;</span>       <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_llabel</span> <span class="o">=</span> <span class="n">str_llabel</span> <span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;descript&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;boxname&#39;</span>        <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;boxname&#39;</span><span class="p">]</span>
                    <span class="k">if</span>   <span class="s1">&#39;transect_name&#39;</span>  <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span> <span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;transect_name&#39;</span><span class="p">]</span>
                    <span class="n">str_blabel</span> <span class="o">=</span> <span class="n">str_blabel</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;MOC&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bi</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strdatalabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_llabel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">list_strboxlabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________</span>
                    <span class="c1"># plot lines </span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nrow</span><span class="o">*</span><span class="n">ncol</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">optline</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="n">list_lstyle</span><span class="p">[</span><span class="n">bi</span><span class="p">]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">cnt</span><span class="p">,:]})</span>
                    <span class="n">optmark</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mark_opt</span><span class="p">)</span>
                    
                    <span class="c1"># plot black underlying shadow slightly wider than line on top </span>
                    <span class="k">if</span> <span class="n">do_shdw</span><span class="p">:</span>
                        <span class="n">optline2</span> <span class="o">=</span> <span class="n">optline</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="n">optline2</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="n">optline</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="o">**</span><span class="n">optline2</span><span class="p">)</span>
                    
                    <span class="c1"># plot actual time series with color </span>
                    <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">str_llabel</span><span class="p">,</span> <span class="o">**</span><span class="n">optline</span><span class="p">)</span>
                    
                    <span class="c1"># plot mean value with left triangle </span>
                    <span class="k">if</span> <span class="n">do_mean</span><span class="p">:</span> 
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span>  <span class="o">**</span><span class="n">optmark</span><span class="p">)</span>
                    
                    <span class="c1"># plot std. range with up/dwn triangle </span>
                    <span class="k">if</span> <span class="n">do_std</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;overflow encountered in multiply&quot;</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">+</span><span class="n">data_y</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">optmark</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xmin</span><span class="o">-</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">-</span><span class="n">data_y</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">optmark</span><span class="p">)</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">resetwarnings</span><span class="p">()</span>
                        
                    <span class="n">hp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
                    
                    <span class="c1">#___________________________________________________________</span>
                    <span class="n">cnt</span>      <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">cnt_cycl</span> <span class="o">=</span> <span class="n">cnt_cycl</span><span class="o">+</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">n_cycl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cnt_cycl</span><span class="o">&gt;=</span> <span class="n">n_cycl</span><span class="p">:</span> <span class="n">cnt_cycl</span><span class="o">=</span><span class="mi">0</span>
                        
                <span class="c1">#_______________________________________________________________</span>
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> 
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">str_xlabel</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span>
                     <span class="c1"># wrap xlabel string when they are to long</span>
                    <span class="c1"># Estimate the width of the axes dynamically</span>
                    <span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
                    <span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">get_dpi</span><span class="p">()</span>
                    <span class="n">axes_width_px</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">fig_width</span> <span class="o">*</span> <span class="n">fig_dpi</span>
                    
                    <span class="c1"># Estimate the width of the axes in terms of characters</span>
                    <span class="c1"># font_size = plt.rcParams[&#39;font.size&#39;]</span>
                    <span class="n">font_size</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
                    <span class="n">max_chars_per_line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">axes_width_px</span> <span class="o">/</span> <span class="p">(</span><span class="n">font_size</span><span class="o">*</span><span class="mf">0.6</span><span class="p">))</span>  <span class="c1"># Empirical factor for font size to character width ratio</span>
                    <span class="n">str_ylabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">str_ylabel</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">max_chars_per_line</span><span class="p">))</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">str_ylabel</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add grids lines </span>
            <span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ax_ylim0</span> <span class="o">=</span> <span class="n">ax_xlim</span><span class="p">,</span> <span class="n">ax_ylim</span> 
            <span class="k">if</span> <span class="n">ax_xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_xlim0</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ax_ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax_ylim0</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                  <span class="n">data_y</span><span class="o">=</span><span class="n">data_y</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="n">ax_xlim0</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ax_ylim0</span><span class="p">,</span> 
                                  <span class="n">grid_opt</span><span class="o">=</span><span class="n">grid_opt</span><span class="p">)</span>
            <span class="n">hgrd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>  
            
            <span class="c1">#_______________________________________________________________</span>
            <span class="k">if</span> <span class="n">do_concat</span><span class="p">:</span>
                <span class="n">aux_ylim</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xmax_list</span><span class="p">),</span> <span class="n">aux_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aux_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">aux_ylim</span><span class="p">)</span>
            
            <span class="c1">#_______________________________________________________________________</span>
            <span class="c1"># do legend and legend positioning </span>
            <span class="c1"># --&gt;bbox_to_anchor=(1.0, 1.0), loc=&#39;upper left&#39; this should make sure </span>
            <span class="c1">#    that the legend is always outside in the upper right corner </span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">coli</span><span class="o">==</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">rowi</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> 
                <span class="k">if</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">legend1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span> <span class="n">list_strdatalabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                    
                    <span class="c1"># make box list legend:</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">hp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ndat</span><span class="o">*</span><span class="n">nbox</span><span class="p">,</span> <span class="n">ndat</span><span class="p">)]</span>
                    <span class="c1"># make legend box lines always black, just show linestyle </span>
                    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span> <span class="n">lines</span><span class="p">[</span><span class="n">li</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">list_strboxlabel</span><span class="p">,</span> 
                                         <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># make data legend:</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span> <span class="c1">#bbox_to_anchor=(1.5, 1.5))</span>
                    <span class="c1"># box label becomes here axes title</span>
             <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add title and axes labels</span>
            <span class="k">if</span> <span class="n">ax_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_title</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ax_title</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
                <span class="k">else</span>                        <span class="p">:</span> 
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">allinone</span> <span class="ow">and</span> <span class="n">nbox</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">str_blabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_label</span><span class="p">)</span>
           
         
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># save figure based on do_save contains either None or pathname</span>
    <span class="n">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">save_dpi</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="n">save_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span>   <span class="p">:</span> <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>



    
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; setup cartopy projections     </span>
<div class="viewcode-block" id="do_projection">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_projection">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_projection</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; set cartopy target projection </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :mesh:      fesom2 mesh object,  with all mesh information </span>

<span class="sd">        :proj:      str, (default: &#39;pc&#39;) which projection should be used, </span>
<span class="sd">                    - pc     ... PlateCarree         (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - merc   ... Mercator            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - rob    ... Robinson            (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - eqearth... EqualEarth          (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - mol    ... Mollweide           (box=[lonmin, lonmax, latmin, latmax])</span>
<span class="sd">                    - nps    ... NorthPolarStereo    (box=[-180, 180, &gt;0, latmax])</span>
<span class="sd">                    - sps    ... SouthPolarStereo    (box=[-180, 180, latmin, &lt;0])</span>
<span class="sd">                    - ortho  ... Orthographic        (box=[loncenter, latcenter]) </span>
<span class="sd">                    - nears  ... NearsidePerspective (box=[loncenter, latcenter, zoom]) </span>
<span class="sd">                    - channel... PlateCaree</span>

<span class="sd">        :box:       None, list (default: None) regional limitation of plot. For </span>
<span class="sd">                    ortho box = [lonc, latc], nears [lonc, latc, zoom], for all</span>
<span class="sd">                    others box = [lonmin, lonmax, latmin, latmax]</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :proj_to:   cartopy projection object </span>

<span class="sd">        :box:       return projection adapted box list</span>

<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span> 
     
    <span class="c1">#___Horizontal Projection___________________________________________________</span>
    <span class="k">if</span>   <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;pc&#39;</span>     <span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For PlateCarree projection: box=[lon_min, lon_max, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">360</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="c1">#proj_to = ccrs.PlateCarree(central_longitude=(box[0]+box[1])*0.5)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s1">&#39;--&gt; an uncentered (focus !=0) global PlateCarree, doesnt work in moment due to an issue with cartopy in multi axes environment &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>     
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;merc&#39;</span>   <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For Mercator projection: box=[lon_min, lon_max, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">()</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.25</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="mi">85</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">85</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;rob&#39;</span>    <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For Robinson projection: box=[lon_min, lon_max, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">360</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">()</span>  

    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;eqearth&#39;</span><span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For EqualEarth projection: box=[lon_min, lon_max, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">360</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">()</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.25</span>
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;mol&#39;</span><span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For Mollweide projection: box=[lon_min, lon_max, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">360</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">()</span>
        <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.25</span>
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;nps&#39;</span>    <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For NorthPolarStereo projection: box=[-180, 180, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;sps&#39;</span>    <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For SouthPolarStereo projection: box=[-180, 180, lat_min, lat_max]&#39;</span><span class="p">)</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;ortho&#39;</span>   <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For Orthographic projection: box=[lonc, latc]&#39;</span><span class="p">)</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">globe</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>        
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;nears&#39;</span>   <span class="p">:</span> 
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">box</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s1">&#39;For NearsidePerspective projection: box=[lonc, latc, zoom]&#39;</span><span class="p">)</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">satellite_height</span><span class="o">=</span><span class="mf">35785831.0</span><span class="o">/</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>        
    
    <span class="k">elif</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span>
        <span class="n">proj_to</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">box</span><span class="o">==</span><span class="s2">&quot;None&quot;</span><span class="p">:</span> <span class="n">box</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_x</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_xa</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_x</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_xa</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_y</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_ya</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_y</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_ya</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="n">proj</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
    <span class="c1">#___Vertical &quot;Projection&quot;___________________________________________________</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;index+depth+xy&#39;</span>   <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;index+depth+xy&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;index+depth+time&#39;</span> <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;index+depth+time&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;index+depth&#39;</span>      <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;index+depth&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;index+time&#39;</span>       <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;index+time&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;index+xy&#39;</span>         <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;index+xy&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;zmoc&#39;</span>             <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;zmoc&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;dmoc&#39;</span>             <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;dmoc&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;dmoc+depth&#39;</span>       <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;dmoc+depth&#39;</span>
    <span class="k">elif</span>  <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;dmoc+dens&#39;</span>        <span class="p">:</span> <span class="n">proj_to</span> <span class="o">=</span> <span class="s1">&#39;dmoc+dens&#39;</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The projection </span><span class="si">{}</span><span class="s1"> is not supporrted!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">proj</span><span class="p">))</span>
        
    <span class="c1">#___________________________________________________________________________    </span>
    <span class="k">return</span><span class="p">(</span><span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; do triangulation</span>
<div class="viewcode-block" id="do_triangulation">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_triangulation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_triangulation</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">proj_to</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">proj_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">do_triorig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_narea</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_earea</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; create matplotlib triangulation object</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax:       handle of current axes</span>

<span class="sd">        :mesh:      fesom2 mesh object,  with all mesh information </span>

<span class="sd">        :proj_to:   cartopy destination projection object   </span>

<span class="sd">        :proj_from: cartopy source projection object (default: ccrs.PlateCarree())                  </span>

<span class="sd">        :do_triorig: bool, (default=False) save original vertices coordinate in lon,lat space </span>

<span class="sd">        :do_narea:  bool (default=True), drag vertices area with you is needed for normalisation</span>

<span class="sd">        :do_earea:  bool (default=True), drag element area with you is needed for normalisation</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="n">Triangulation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_x</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_xa</span><span class="p">)),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_y</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_ya</span><span class="p">)),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_i</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_0</span><span class="p">,:],</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_ia</span><span class="p">)))</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">proj_from</span><span class="p">:</span> 
        <span class="n">proj_from</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>   
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; limit mesh triangulation to projection box</span>
    <span class="n">e_box_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_to</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">)</span> <span class="p">):</span>
        <span class="n">e_box_mask</span> <span class="o">=</span> <span class="n">grid_cutbox_e</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_to</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">)):</span>
        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">proj_to</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">proj_from</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">e_box_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">del</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">proj_to</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">)):</span>    
        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">proj_from</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">proj_to</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">fig_pts</span>    <span class="o">=</span> <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">)))</span>
            <span class="n">ax_pts</span>     <span class="o">=</span> <span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">fig_pts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">fig_pts</span>    <span class="o">=</span> <span class="n">hax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">)))</span>
            <span class="n">ax_pts</span>     <span class="o">=</span> <span class="n">hax</span><span class="o">.</span><span class="n">transAxes</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">fig_pts</span><span class="p">)</span>
        <span class="n">e_box_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax_pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=-</span><span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ax_pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">1.06</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ax_pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=-</span><span class="mf">0.05</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ax_pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="mf">1.06</span><span class="p">)</span>
        <span class="k">del</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">fig_pts</span><span class="p">,</span> <span class="n">ax_pts</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># --&gt; do the mapping transformation outside of tricontourf is absolutely </span>
    <span class="c1">#     faster than let doing cartopy doing it within </span>
    <span class="c1"># when you transpose a 2D array with two columns, it effectively swaps the </span>
    <span class="c1"># rows and columns, allowing you to use tuple unpacking to assign each </span>
    <span class="c1"># column to a separate variable.</span>
    <span class="k">if</span> <span class="n">do_triorig</span><span class="p">:</span> <span class="n">tri</span><span class="o">.</span><span class="n">xorig</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">yorig</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">proj_to</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">proj_from</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    
    <span class="c1"># In case you shift the center focus from 0 to somewhere else than there will </span>
    <span class="c1"># be still a periodic boundary spanning across that needs to eliminated</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">359</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="n">xmin_arr</span><span class="p">,</span> <span class="n">xmax_arr</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span>     <span class="n">xmax</span>     <span class="o">=</span> <span class="n">xmin_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xmax_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mask_pbnd</span>          <span class="o">=</span> <span class="p">((</span><span class="n">xmax_arr</span><span class="o">-</span><span class="n">xmin_arr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">e_box_mask</span><span class="p">[</span><span class="n">mask_pbnd</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">del</span><span class="p">(</span><span class="n">mask_pbnd</span><span class="p">,</span> <span class="n">xmin_arr</span><span class="p">,</span> <span class="n">xmax_arr</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    
    <span class="c1"># --&gt; reindex vertices and elements --&gt; ensure smallest triangulation object </span>
    <span class="c1"># hopefully saves some memory when going to very large meshes </span>
    <span class="n">n_box_mask</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">e_box_mask</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">tri</span><span class="p">,</span> <span class="n">n_box_mask</span> <span class="o">=</span> <span class="n">do_reindex_vert_and_elem</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">e_box_mask</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># add some more varaibles i need</span>
    <span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span>     <span class="o">=</span> <span class="n">e_box_mask</span>
    <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span>     <span class="o">=</span> <span class="n">n_box_mask</span>
    <span class="k">del</span><span class="p">(</span><span class="n">e_box_mask</span><span class="p">,</span> <span class="n">n_box_mask</span><span class="p">)</span>
    <span class="n">tri</span><span class="o">.</span><span class="n">n2dn</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">n2de</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2dn</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2de</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">do_narea</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># in case fesom14cmip6 n_area is not depth dependent, therefor ndims=1</span>
                <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
            <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">narea</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># in case fesom14cmip6 n_area is not depth dependent, therefor ndims=1</span>
                <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n_area</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">do_earea</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span> 
            <span class="n">tri</span><span class="o">.</span><span class="n">earea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_area</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_0</span><span class="p">],</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_area</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_a</span><span class="p">]))</span>
            <span class="n">tri</span><span class="o">.</span><span class="n">earea</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">earea</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">tri</span><span class="o">.</span><span class="n">earea</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">e_area</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_reindex_vert_and_elem">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_reindex_vert_and_elem">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_reindex_vert_and_elem</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">e_box_mask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; reindex element index in case of exluded triangles and unused vertices</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">        </span>
<span class="sd">        :e_box_mask: bool np.array with element masking from regional box definition</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object where unreferenced triangles </span>
<span class="sd">                    are kickout and the indices of the remaining vertices are </span>
<span class="sd">                    adapted accordingly in the element list</span>

<span class="sd">        :n_box_mask: bool np.array with vertices masking from regional box selection</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>     
    <span class="c1"># Identify used vertices</span>
    <span class="n">n_box_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">e_box_mask</span><span class="p">,:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    
    <span class="c1"># Create mapping dictionary between old and new vertex indices</span>
    <span class="n">vert_map</span>  <span class="o">=</span> <span class="p">{</span><span class="n">old_index</span><span class="p">:</span> <span class="n">new_index</span> <span class="k">for</span> <span class="n">new_index</span><span class="p">,</span> <span class="n">old_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_box_mask</span><span class="p">)}</span>

    <span class="c1"># Update vertices and elements using NumPy indexing</span>
    <span class="n">tri_new</span>       <span class="o">=</span> <span class="n">Triangulation</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">n_box_mask</span><span class="p">],</span> 
                                <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n_box_mask</span><span class="p">],</span> 
                                <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">vert_map</span><span class="o">.</span><span class="n">get</span><span class="p">)(</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">e_box_mask</span><span class="p">,:]))</span>
    
    <span class="c1"># rescue xorig and yorig into the new triangulation object</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="s1">&#39;xorig&#39;</span><span class="p">):</span> <span class="n">tri_new</span><span class="o">.</span><span class="n">xorig</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">xorig</span><span class="p">[</span><span class="n">n_box_mask</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="s1">&#39;yorig&#39;</span><span class="p">):</span> <span class="n">tri_new</span><span class="o">.</span><span class="n">yorig</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">yorig</span><span class="p">[</span><span class="n">n_box_mask</span><span class="p">]</span>
    <span class="k">del</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tri_new</span><span class="p">,</span> <span class="n">n_box_mask</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<span class="c1"># --&gt; this is based on work of Nils Bruegemann see </span>
<span class="c1"># https://gitlab.dkrz.de/m300602/pyicon/-/blob/master/pyicon/pyicon_plotting.py</span>
<span class="c1"># i needed this to originally unify the ploting between icon and fesom for model </span>
<span class="c1"># comparison paper</span>
<div class="viewcode-block" id="do_axes_arrange">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_axes_arrange">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_axes_arrange</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span>
                    <span class="c1">#---LABEL OPTION--------------------------------------------</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">tlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
                     <span class="c1"># font sizes of labels, titles, ticks</span>
                    <span class="n">fs_label</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">fs_title</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">fs_ticks</span> <span class="o">=</span> <span class="mf">10.</span><span class="p">,</span>
                    <span class="c1"># font size increasing factor</span>
                    <span class="n">fs_fac</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    
                    <span class="c1">#---AXES OPTIONS--------------------------------------------</span>
                    <span class="n">ax_sharex</span>   <span class="o">=</span> <span class="kc">True</span> <span class="p">,</span>    <span class="c1"># all subplot share x-axes</span>
                    <span class="n">ax_sharey</span>   <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>    <span class="c1"># all subplot share y-axes</span>
                    <span class="n">ax_optdict</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span>   <span class="c1"># additional axes option: fontssize, ...</span>
                    <span class="n">ax_asp</span>      <span class="o">=</span> <span class="mf">1.</span>   <span class="p">,</span>    <span class="c1"># aspect ratio of axes</span>
                    <span class="n">ax_w</span> <span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">ax_h</span> <span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="c1"># width and height of axes</span>
                    <span class="c1"># space aroung axes (left, right, top, bottom) </span>
                    <span class="n">ax_dl</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">ax_dr</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">ax_dt</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">ax_db</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> 
                    <span class="c1"># factors to increase spaces (axes)</span>
                    <span class="n">ax_fdl</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_fdr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_fdt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_fdb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">ax_fw</span> <span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ax_fh</span> <span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                    
                    <span class="c1">#---FIGURE OPTION-------------------------------------------</span>
                    <span class="n">fig_optdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="p">,</span>  <span class="c1"># additional figure option: fontssize, ...</span>
                    <span class="n">fig_sizefac</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>       <span class="c1"># factor to resize figures</span>
                    <span class="c1"># extra figure spaces (left, right, top, bottom)</span>
                    <span class="n">fig_dl</span> <span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fig_dr</span> <span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fig_dt</span> <span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fig_db</span> <span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                    <span class="c1"># factors to increase spaces (figures)</span>
                    <span class="n">fig_fdl</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fig_fdr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fig_fdt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fig_fdb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                
                    <span class="c1">#---COLORBAR OPTION-----------------------------------------</span>
                    <span class="n">cb_plt</span>        <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">cb_plt_single</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">cb_pos</span>        <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> 
                    <span class="c1"># space around colorbars (left, right, top, bottom) </span>
                    <span class="n">cb_dl</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">cb_dr</span> <span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">cb_dt</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">cb_db</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                    <span class="c1"># factors to increase spaces (colorbars)</span>
                    <span class="n">cb_fdl</span><span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">cb_fdr</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cb_fdt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cb_fdb</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="c1"># width and height of colorbars</span>
                    <span class="n">cb_w</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">cb_h</span>  <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                    <span class="c1"># factors to increase widths and heights of axes and colorbars</span>
                    <span class="n">cb_fw</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">cb_fh</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                 
                    <span class="c1">#-----------------------------------------------------------</span>
                    <span class="n">projection</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># projection (e.g. for cartopy)</span>
                    <span class="n">proj</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">box</span>        <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># define regional box needed for aspect ratio</span>
                    <span class="c1">#-----------------------------------------------------------</span>
                    <span class="n">nargout</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hfig&#39;</span><span class="p">,</span> <span class="s1">&#39;hax&#39;</span><span class="p">,</span> <span class="s1">&#39;hcb&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_plt_idx&#39;</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do multipanel axes arangement </span>

<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        ___LABEL OPTION____________________</span>
<span class="sd">        </span>
<span class="sd">        :xlabel:        str (default: &#39;&#39;) provide prescribed xlabel string </span>

<span class="sd">        :ylabel:        str (default: &#39;&#39;) provide prescribed ylabel string </span>

<span class="sd">        :tlabel:        str (default: &#39;&#39;) provide prescribed title string </span>

<span class="sd">        :fs_label:      int (default: 10) prescribed fontsize for labels</span>

<span class="sd">        :fs_title:      int (default: 10) prescribed fontsize for title</span>

<span class="sd">        :fs_ticks:      int (default: 10) prescribed fontsize for ticklabels</span>

<span class="sd">        :fs_fac:        int (default: 1)  factor to generally increase fontsize</span>

<span class="sd">        ___AXES OPTIONS____________________</span>

<span class="sd">        :ax_sharex:     bool (default: True) all subplot share x-axes</span>

<span class="sd">        :ax_sharey:     bool (default: True) all subplot share y-axes</span>

<span class="sd">        :ax_optdict:    dict (default: dict()) additional axes option: fontssize, ...</span>

<span class="sd">        :ax_asp:        float (default: 1.) aspect ratio of axes</span>
<span class="sd">        </span>
<span class="sd">        :ax_w:          float, int (default: &#39;auto&#39;) if &#39;auto&#39; width is defined based on</span>
<span class="sd">                        aspect ration ax_asp and height ax_h in cm, if float value is </span>
<span class="sd">                        used to define width in cm</span>

<span class="sd">        :ax_h:          float, int (default: 4) if &#39;auto&#39; height is defined based on</span>
<span class="sd">                        aspect ration ax_asp and width ax_w in cm, if float value is </span>
<span class="sd">                        used to define height in cm</span>

<span class="sd">        :ax_fw:         float (default: 1.0 factor to increase width spacing</span>

<span class="sd">        :ax_fh:         float (default: 1.0 factor to increase height spacing</span>

<span class="sd">        :ax_dl:         float (default: 0.6) left spacing around axes in cm</span>

<span class="sd">        :ax_dr:         float (default: 0.6) right spacing around axes in cm</span>

<span class="sd">        :ax_dt:         float (default: 0.6) top spacing around axes in cm</span>

<span class="sd">        :ax_db:         float (default: 0.6) bottom spacing around axes in cm</span>

<span class="sd">        :ax_fdl:        float (default: 1.0) factor to increase left axes spacing</span>

<span class="sd">        :ax_fdr:        float (default: 1.0) factor to increase right axes spacing</span>

<span class="sd">        :ax_fdt:        float (default: 1.0) factor to increase top axes spacing</span>

<span class="sd">        :ax_fdb:        float (default: 1.0) factor to increase bottom axes spacing</span>

<span class="sd">        ___FIGURE OPTION___________________</span>

<span class="sd">        :fig_optdict:   dict (default: dict()) additional figure option: fontssize, ...</span>

<span class="sd">        :fig_sizefac:   float (default: 1.) factor to resize figures</span>
<span class="sd">                        </span>
<span class="sd">        :fig_dl:        float (default: 0.6) left spacing around figure in cm</span>

<span class="sd">        :fig_dr:        float (default: 0.6) right spacing around figure in cm</span>

<span class="sd">        :fig_dt:        float (default: 0.6) top spacing around figure in cm</span>

<span class="sd">        :fig_db:        float (default: 0.6) bottom spacing around figure in cm</span>

<span class="sd">        :fig_fdl:       float (default: 1.0) factor to increase left figure spacing</span>

<span class="sd">        :fig_fdr:       float (default: 1.0) factor to increase right figure spacing</span>

<span class="sd">        :fig_fdt:       float (default: 1.0) factor to increase top figure spacing</span>

<span class="sd">        :fig_fdb:       float (default: 1.0) factor to increase bottom figure spacing</span>

<span class="sd">        ___COLORBAR OPTION_________________</span>

<span class="sd">        :cb_plt:        bool, list (default: True) If True colorbar is plotted to all </span>
<span class="sd">                        axes (cb_plt_single=False) or just one colorbar is plotted for </span>
<span class="sd">                        all axes (cb_plt_single=False), If list with 0 and 1 [0,1,0,1...], </span>
<span class="sd">                        which axes should have colorbar, if number higher than 1 in </span>
<span class="sd">                        list it is assumed there is more than one independed colorbar</span>

<span class="sd">        :cb_plt_single: bool (default: False) true/false if there is just one colorbar </span>
<span class="sd">                        for all the axes or if each axes should get a colorbar</span>

<span class="sd">        :cb_pos:        str (default: &#39;vertical&#39;) orientation of colorbar, either </span>
<span class="sd">                        vertical or horizontal</span>
<span class="sd">                        </span>
<span class="sd">        :cb_dl:         float (default: 0.6) left spacing around colorbar in cm</span>

<span class="sd">        :cb_dr:         float (default: 3.0) right spacing around colorbar in cm</span>

<span class="sd">        :cb_dt:         float (default: 1.0) top spacing around colorbar in cm</span>

<span class="sd">        :cb_db:         float (default: 0.6) bottom spacing around colorbar in cm</span>

<span class="sd">        :cb_fdl:        float (default: 1.0) factor to increase left colorbar spacing</span>

<span class="sd">        :cb_fdr:        float (default: 1.0) factor to increase right colorbar spacing</span>

<span class="sd">        :cb_fdt:        float (default: 1.0) factor to increase top colorbar spacing</span>

<span class="sd">        :cb_fdb:        float (default: 1.0) factor to increase bottom colorbar spacing</span>
<span class="sd">        </span>
<span class="sd">        :cb_w:          float, str (default: 0.5) if float it is used as width in cm,</span>
<span class="sd">                        if &#39;auto&#39; width is defined automatically based on width of axes</span>
<span class="sd">                        in case of horizontal colorbar</span>

<span class="sd">        :cb_h:          float, str (default: 0.5) if float it is used as height in cm,</span>
<span class="sd">                        if &#39;auto&#39; height is defined automatically based on height of axes</span>
<span class="sd">                        in case of vertical colorbar</span>

<span class="sd">        :cb_fw:         float (default: 1.0) factor to increase width of colorbar</span>

<span class="sd">        :cb_fh:         float (default: 1.0) factor to increase height colorbar</span>

<span class="sd">        ___PROJECTION_______________________</span>

<span class="sd">        :projection:    (default: None) provide single cartopy projection object to use </span>
<span class="sd">                        for all axes, or provide list of cartopy projection objects</span>

<span class="sd">        :box:           None, list (default: None) regional limitation of plot. For </span>
<span class="sd">                        ortho: box = [lonc, latc], nears: [lonc, latc, zoom], for all</span>
<span class="sd">                        others box = [lonmin, lonmax, latmin, latmax]</span>

<span class="sd">        ___OUTPUT___________________________</span>

<span class="sd">        :nargout:       list, (default: [&#39;hfig&#39;, &#39;hax&#39;, &#39;hcb&#39;, &#39;cb_plt_idx&#39;]) list of variables that</span>
<span class="sd">                        are given out from the routine. </span>
<span class="sd">                        Default: </span>
<span class="sd">                        - hfig      ... figure handle</span>
<span class="sd">                        - hax       ... list of axes handle </span>
<span class="sd">                        - hcb       ... list of colorbar handles</span>
<span class="sd">                        - cb_plt_idx... list that contains index of independent</span>
<span class="sd">                        - colorbars</span>
<span class="sd">                        (every variable that is defined in this subroutine can become </span>
<span class="sd">                        output parameter)</span>
<span class="sd">    </span>
<span class="sd">    __________________________________________________</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hfig:          returns figure handle </span>

<span class="sd">        :hax:           returns list with axes handle </span>

<span class="sd">        :hcb:           returns colorbar handle</span>

<span class="sd">        :cb_plt_idx:    list that contains index of independent colorbars</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># factor to convert cm into inch</span>
    <span class="n">cm2inch</span> <span class="o">=</span> <span class="mf">0.3937</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># make list of projections if it is not a list</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">projection</span> <span class="o">=</span> <span class="p">[</span><span class="n">projection</span><span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># determine ax_w in case it is auto</span>
    <span class="c1">#if isinstance(ax_w, str) and ax_w==&#39;auto&#39;: ax_w = ax_h/ax_asp</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax_w</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ax_w</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> 
        <span class="c1">#if box is not None and ax_asp==1.0:</span>
        <span class="k">if</span> <span class="n">ax_asp</span><span class="o">==</span><span class="mf">1.0</span><span class="p">:</span>        
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># projection[0] is an arbitrary cartopy-projection object</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">proj</span><span class="o">!=</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">)</span> <span class="p">):</span>
                    <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">1.0</span>
                    
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">)</span> <span class="p">):</span>
                    <span class="n">poly_x</span><span class="p">,</span> <span class="n">poly_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">]),</span>
                    <span class="n">ax_asp</span> <span class="o">=</span> <span class="p">(</span><span class="n">poly_x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">poly_x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">poly_y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">poly_y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">poly_x</span><span class="p">,</span> <span class="n">poly_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">],</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">]</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly_y</span><span class="p">))</span>
                    <span class="n">ax_asp</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># channel </span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>
                
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># projection is vertical section</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;index+depth+xy&#39;</span>  <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;index+depth+time&#39;</span><span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;index+depth&#39;</span>     <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;index+time&#39;</span>      <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.5</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;index+xy&#39;</span>        <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;zmoc&#39;</span>            <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>   
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;dmoc&#39;</span>            <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;dmoc+depth&#39;</span>      <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>   
            <span class="k">elif</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;dmoc+dens&#39;</span>       <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">2.0</span>   
            <span class="k">else</span>                                  <span class="p">:</span> <span class="n">ax_asp</span> <span class="o">=</span> <span class="mf">1.0</span>    
        <span class="c1">#print(&#39;ax_asp=&#39;, ax_asp)</span>
        <span class="n">ax_w</span> <span class="o">=</span> <span class="n">ax_h</span><span class="o">*</span><span class="n">ax_asp</span>
        <span class="c1">#print(&#39;ax_w=&#39;, ax_w, &#39;, ax_h=&#39;, ax_h)</span>

    <span class="c1"># rename horizontal-&gt;bottom and vertical-&gt;right</span>
    <span class="k">if</span>   <span class="n">cb_pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;horiz&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;bot&#39;</span><span class="p">]:</span> 
        <span class="k">if</span> <span class="n">cb_h</span> <span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">cb_h</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">fig_sizefac</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_w</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cb_w</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">cb_w</span> <span class="o">=</span> <span class="n">ax_w</span>
        <span class="n">cb_pos</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
        <span class="k">if</span> <span class="n">nx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">cb_h</span> <span class="o">=</span> <span class="n">cb_h</span><span class="o">*</span><span class="n">fig_sizefac</span>
    <span class="k">elif</span> <span class="n">cb_pos</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;vert&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span> 
        <span class="k">if</span> <span class="n">cb_w</span> <span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">cb_w</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_h</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cb_h</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="n">cb_h</span> <span class="o">=</span> <span class="n">ax_h</span>
        <span class="n">cb_pos</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="k">if</span> <span class="n">ny</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">cb_w</span> <span class="o">=</span> <span class="n">cb_w</span><span class="o">*</span><span class="n">fig_sizefac</span>
    <span class="c1">#print(ax_w, ax_h)</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># apply fig_size_fac</span>
    <span class="n">ax_fh</span> <span class="o">*=</span> <span class="n">fig_sizefac</span>
    <span class="n">ax_fw</span> <span class="o">*=</span> <span class="n">fig_sizefac</span>
    <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;right&#39;</span> <span class="p">:</span> <span class="n">cb_fh</span> <span class="o">*=</span> <span class="n">fig_sizefac</span>
    <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="n">cb_fw</span> <span class="o">*=</span> <span class="n">fig_sizefac</span>
    <span class="c1">#fs_fac *= fig_sizefac</span>
    
    <span class="c1">## factors to increase spaces (figure)</span>
    <span class="c1">#fig_fdl *= fig_sizefac</span>
    <span class="c1">#fig_fdr *= fig_sizefac</span>
    <span class="c1">#fig_fdt *= fig_sizefac</span>
    <span class="c1">#fig_fdb *= fig_sizefac</span>
    <span class="c1">## factors to increase spaces (axes)</span>
    <span class="c1">#ax_fdl  *= fig_sizefac</span>
    <span class="c1">#ax_fdr  *= fig_sizefac</span>
    <span class="c1">#ax_fdt  *= fig_sizefac</span>
    <span class="c1">#ax_fdb  *= fig_sizefac</span>
    <span class="c1">## factors to increase spaces (colorbars)</span>
    <span class="c1">#cb_fdl  *= fig_sizefac</span>
    <span class="c1">#cb_fdr  *= fig_sizefac</span>
    <span class="c1">#cb_fdt  *= fig_sizefac</span>
    <span class="c1">#cb_fdb  *= fig_sizefac</span>
  
    <span class="c1"># apply font size factor</span>
    <span class="k">if</span> <span class="n">fig_sizefac</span><span class="o">!=</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">fs_fac</span><span class="o">==</span><span class="mf">1.0</span><span class="p">:</span>
        <span class="n">fs_label</span> <span class="o">*=</span> <span class="n">fig_sizefac</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fig_sizefac</span><span class="p">)</span>
        <span class="n">fs_title</span> <span class="o">*=</span> <span class="n">fig_sizefac</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fig_sizefac</span><span class="p">)</span>
        <span class="n">fs_ticks</span> <span class="o">*=</span> <span class="n">fig_sizefac</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">fig_sizefac</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">fs_label</span> <span class="o">*=</span> <span class="n">fs_fac</span>
        <span class="n">fs_title</span> <span class="o">*=</span> <span class="n">fs_fac</span>
        <span class="n">fs_ticks</span> <span class="o">*=</span> <span class="n">fs_fac</span>
    <span class="c1">#print(fs_label, fs_title, fs_ticks)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># make vector of plot_cb if it has been true or false before</span>
    <span class="c1"># --&gt; 1: plot cb,  0: do not plot cb    # </span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_plt</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span>   <span class="n">cb_plt</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> 
            <span class="c1"># only one colorbar for the entire panels</span>
            <span class="k">if</span> <span class="n">cb_plt_single</span><span class="p">:</span>
                <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>  
                <span class="n">cb_plt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># each panel has a colorbar    </span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>  
        
        <span class="c1"># no colorbars et all</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span>  
        <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        
    <span class="c1"># only distinct panels have colorbar</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_plt</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cb_plt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">size</span><span class="o">!=</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span>    <span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Vector cb_plt has wrong length!&#39;</span><span class="p">)</span>
        <span class="k">if</span>   <span class="n">cb_plt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">:</span> <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">ny</span>   <span class="p">:</span> <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cb_plt</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">cb_plt_single</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">else</span>                  <span class="p">:</span> <span class="n">cb_plt_single</span><span class="o">=</span><span class="kc">True</span>
        
        <span class="c1"># check if there should be more than one independent colorbar</span>
        <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span> 
            <span class="n">cb_plt_new</span> <span class="o">=</span> <span class="n">cb_plt_idx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ncb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ncb</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="o">==</span><span class="n">ii</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cb_plt_new</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span>
        
            <span class="n">cb_plt</span> <span class="o">=</span> <span class="n">cb_plt_new</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; the format of cb_plt is not supported&#39;</span><span class="p">)</span>
    <span class="n">cb_plt_idx</span> <span class="o">=</span> <span class="n">cb_plt_idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># create multiple of horizontal axes, colorbar properties</span>
    <span class="n">ax_dl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_dl</span><span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fdl</span>
    <span class="n">ax_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_dr</span><span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fdr</span>
    <span class="n">cb_dl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_dl</span><span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fdl</span>
    <span class="n">cb_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_dr</span><span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fdr</span>
    <span class="n">ax_w</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_w</span> <span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fw</span>
    <span class="n">cb_w</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_w</span> <span class="p">]</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fw</span>
    
    <span class="c1"># create multiple of vertical axes, colorbar properties</span>
    <span class="n">ax_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_dt</span><span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fdt</span>
    <span class="n">ax_db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_db</span><span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fdb</span>
    <span class="n">cb_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_dt</span><span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fdt</span>
    <span class="n">cb_db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_db</span><span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fdb</span>
    <span class="n">ax_h</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax_h</span> <span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">ax_fh</span>
    <span class="n">cb_h</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cb_h</span> <span class="p">]</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span><span class="n">cb_fh</span>
    
    <span class="c1">#print(&#39;ax_w=&#39;,ax_w,&#39;, ax_dl=&#39;,ax_dl, &#39;, ax_dr=&#39;,ax_dr)</span>
    <span class="c1">#print(&#39;ax_h=&#39;,ax_h,&#39;, ax_dt=&#39;,ax_dt, &#39;, ax_db=&#39;,ax_db)</span>
    <span class="c1">#print(&#39;cb_w=&#39;,cb_w,&#39;, cb_dl=&#39;,cb_dl, &#39;, cb_dr=&#39;,cb_dr)</span>
    <span class="c1">#print(&#39;cb_h=&#39;,cb_h,&#39;, cb_dt=&#39;,cb_dt, &#39;, cb_db=&#39;,cb_db)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># adjust for shared axes</span>
    <span class="k">if</span> <span class="n">ax_sharex</span><span class="p">:</span> <span class="n">ax_db</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># only last row has x-axes label</span>
    <span class="k">if</span> <span class="n">ax_sharey</span><span class="p">:</span> <span class="n">ax_dl</span><span class="p">[</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># only first column has y-axes label</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># adjust for one colorbar at the right or bottom</span>
    <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="n">ax_dr_s</span> <span class="o">=</span> <span class="n">ax_dr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_dl_s</span> <span class="o">=</span> <span class="n">cb_dl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_dr_s</span> <span class="o">=</span> <span class="n">cb_dr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_w_s</span>  <span class="o">=</span> <span class="n">cb_w</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_h_s</span>  <span class="o">=</span> <span class="n">cb_h</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">fig_dr</span> <span class="o">+=</span> <span class="n">cb_dl_s</span><span class="o">+</span><span class="n">cb_w_s</span><span class="o">+</span><span class="mf">0.</span><span class="o">*</span><span class="n">cb_dr_s</span><span class="o">+</span><span class="n">ax_dl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># adjust for columns without colorbar</span>
        <span class="n">delete_cb_space</span> <span class="o">=</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
        <span class="n">cb_dl</span><span class="p">[</span><span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cb_dr</span><span class="p">[</span><span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cb_w</span><span class="p">[</span> <span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ax_dr</span><span class="p">[</span><span class="n">delete_cb_space</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
    <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
        <span class="n">ax_db_s</span> <span class="o">=</span> <span class="n">ax_db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cb_h_s</span>  <span class="o">=</span> <span class="n">cb_h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_w_s</span>  <span class="o">=</span> <span class="n">ax_w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cb_db_s</span> <span class="o">=</span> <span class="n">cb_db</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">ax_db</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cb_dt_s</span> <span class="o">=</span> <span class="n">cb_dt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#hcb_s  = hcb[0]</span>
        <span class="n">fig_db</span> <span class="o">+=</span> <span class="n">cb_db_s</span><span class="o">+</span><span class="n">cb_h_s</span><span class="o">+</span><span class="n">cb_dt_s</span>
  
        <span class="c1"># adjust for columns without colorbar</span>
        <span class="n">delete_cb_space</span> <span class="o">=</span> <span class="n">cb_plt</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span>
        <span class="n">cb_dt</span><span class="p">[</span><span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cb_db</span><span class="p">[</span><span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">cb_h</span><span class="p">[</span> <span class="n">delete_cb_space</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># determine ax position and fig dimensions in centimeters!!!</span>
    <span class="n">x0</span> <span class="p">,</span> <span class="n">y0</span>  <span class="o">=</span> <span class="n">fig_dl</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">fig_dt</span><span class="p">)</span>
    <span class="n">x00</span><span class="p">,</span> <span class="n">y00</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span>
    <span class="n">pos_axcm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">pos_cbcm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">nn</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">cb_pos</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="p">(</span><span class="n">ax_dt</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="n">ax_h</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x00</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span>  <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">ax_dl</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">pos_axcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">ax_w</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax_h</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">ax_w</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_dr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">cb_dl</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">pos_cbcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">cb_w</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">cb_h</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">cb_w</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="n">cb_dr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="p">(</span><span class="n">ax_db</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">elif</span> <span class="n">cb_pos</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="p">(</span><span class="n">ax_dt</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="n">ax_h</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x00</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span>  <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">nn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">ax_dl</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">pos_axcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">ax_w</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">ax_h</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span>
                <span class="n">pos_cbcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">-</span><span class="n">cb_dt</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">cb_h</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span> <span class="n">cb_w</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">cb_h</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">ax_w</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="n">ax_dr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">cb_dt</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">cb_h</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">cb_db</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
    <span class="c1">#___________________________________________________________________________        </span>
    <span class="n">fig_w</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">fig_dr</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">-</span> <span class="n">fig_db</span>
    <span class="c1">#print(&#39;fig_w=&#39;,fig_w,&#39; ,fig_h=&#39;, fig_h)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># transform from negative y axis to positive y axis</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="o">-</span><span class="n">fig_h</span>
    <span class="n">pos_axcm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fig_h</span>
    <span class="n">pos_cbcm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fig_h</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># now convert axis and colorbar position from centimeter to figcoords</span>
    <span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">cm2fig_y</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fig_w</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fig_h</span>
    
    <span class="n">pos_ax</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">pos_axcm</span>
    <span class="n">pos_cb</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">pos_cbcm</span>
    
    <span class="n">pos_ax</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_x</span>
    <span class="n">pos_ax</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_y</span>
    <span class="n">pos_ax</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_x</span>
    <span class="n">pos_ax</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_y</span>
    
    <span class="n">pos_cb</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_cbcm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_x</span>
    <span class="n">pos_cb</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_cbcm</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_y</span>
    <span class="n">pos_cb</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_cbcm</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_x</span>
    <span class="n">pos_cb</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_cbcm</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">cm2fig_y</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># make figure</span>
    <span class="c1">#print(fig_w, fig_h)</span>
    <span class="n">hfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_w</span><span class="o">*</span><span class="n">cm2inch</span><span class="p">,</span> <span class="n">fig_h</span><span class="o">*</span><span class="n">cm2inch</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
  
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># make axes and there positioning </span>
    <span class="n">hax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">hcb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
            <span class="n">nn</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># axes</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:],</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:],</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>    
            <span class="k">else</span><span class="p">:</span>   
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ax_sharex</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ax_sharey</span><span class="p">:</span>
                    <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_share</span><span class="p">,</span> <span class="n">y_share</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
                        <span class="k">if</span> <span class="n">ax_sharex</span><span class="p">:</span> <span class="n">x_share</span><span class="o">=</span><span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">ax_sharey</span><span class="p">:</span> <span class="n">y_share</span><span class="o">=</span><span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">x_share</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">y_share</span><span class="p">)</span>
                    
                <span class="c1">#hax[nn] = hfig.add_subplot(position=pos_ax[nn,:])    </span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>                           
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">sharex</span>     <span class="o">=</span> <span class="n">ax_sharex</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">sharey</span>     <span class="o">=</span> <span class="n">ax_sharey</span>
            <span class="c1"># set position of axes</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_ax</span><span class="p">[</span><span class="n">nn</span><span class="p">,:])</span>
            
            <span class="c1">#if box is not None: hax[nn].set_extent(box, crs=projection[nn])</span>
            <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> 
                <span class="k">if</span>  <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span> <span class="p">)</span> <span class="p">):</span> <span class="c1">#ccrs.NorthPolarStereo, ccrs.SouthPolarStereo,</span>
                    
                    <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">360</span> <span class="ow">and</span> <span class="p">(</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">==</span><span class="mi">180</span><span class="p">:</span>
                        <span class="c1">#print(&#39;set_global()&#39;)</span>
                        <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>    
                        <span class="c1">#print(&#39;set_extent(box, ...)&#39;)</span>
                        <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                    
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># label</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs_label</span><span class="p">)</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs_label</span><span class="p">)</span>
            <span class="c1">#hax[nn].set_title(&#39;&#39;, fontsize=fs_title)</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_title</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_label</span> <span class="o">=</span> <span class="n">fs_label</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_ticks</span> <span class="o">=</span> <span class="n">fs_ticks</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_title</span> <span class="o">=</span> <span class="n">fs_title</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fig_dpi</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">dpi</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fig_width</span><span class="p">,</span> <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fig_height</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># colorbar</span>
            <span class="k">if</span> <span class="n">cb_plt</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;index+depth&#39;</span> <span class="ow">and</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;index+time&#39;</span> <span class="ow">and</span> <span class="n">projection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;index+xy&#39;</span><span class="p">:</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">hfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">pos_cb</span><span class="p">[</span><span class="n">nn</span><span class="p">,:])</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_cb</span><span class="p">[</span><span class="n">nn</span><span class="p">,:])</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_label</span><span class="o">=</span><span class="n">fs_label</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_ticks</span><span class="o">=</span><span class="n">fs_ticks</span>
                <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">fs_title</span><span class="o">=</span><span class="n">fs_title</span>
                
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># ticks for axes</span>
            <span class="c1"># delete labels for shared axes</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">henum</span><span class="o">=</span><span class="kc">None</span> 
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_xlabel</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">if</span> <span class="n">ax_sharex</span> <span class="ow">and</span> <span class="n">jj</span><span class="o">!=</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_xlabel</span><span class="o">=</span><span class="kc">False</span>
            
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_ylabel</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">if</span> <span class="n">ax_sharey</span> <span class="ow">and</span> <span class="n">ii</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_ylabel</span><span class="o">=</span><span class="kc">False</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># add more variables to axes handle </span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">ncol</span><span class="p">,</span> <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">nrow</span> <span class="o">=</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">coli</span><span class="p">,</span> <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">rowi</span> <span class="o">=</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># ticks for colorbar </span>
            <span class="k">if</span> <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;right&#39;</span><span class="p">:</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_orient</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
                <span class="k">elif</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                    <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">do_orient</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># if there is a single colorbar for the entire pannel, than stretch out the </span>
    <span class="c1"># width/height of the colorbar over the size of the pannel</span>
    <span class="c1"># ther eis one single colorbar for the entire panel</span>
    <span class="k">if</span> <span class="n">cb_plt_single</span> <span class="ow">and</span> <span class="n">hcb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># find axes center (!= figure center) --&gt; make sure that singular colorbar</span>
        <span class="c1"># is centered over all the pannels</span>
        <span class="n">x_ax_cent</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pos_axcm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y_ax_cent</span> <span class="o">=</span> <span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pos_axcm</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># case of vertical colorbar</span>
        <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;right&#39;</span><span class="p">:</span>
            <span class="n">w0</span><span class="p">,</span> <span class="n">h0</span> <span class="o">=</span> <span class="n">cb_w_s</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pos_axcm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#h0 = cb_h_s</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_cbcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">y_ax_cent</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
            <span class="n">pos_cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">y0</span><span class="o">*</span><span class="n">cm2fig_y</span><span class="p">,</span> <span class="n">w0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">h0</span><span class="o">*</span><span class="n">cm2fig_y</span> <span class="p">])</span>
            
            <span class="n">nn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_cb</span><span class="p">)</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># case of horizontal colorbar</span>
        <span class="k">elif</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
            <span class="n">w0</span><span class="p">,</span> <span class="n">h0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">pos_axcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pos_axcm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">cb_h_s</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_ax_cent</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">w0</span><span class="p">),</span> <span class="p">(</span><span class="n">pos_cbcm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pos_cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">x0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">y0</span><span class="o">*</span><span class="n">cm2fig_y</span><span class="p">,</span> <span class="n">w0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">h0</span><span class="o">*</span><span class="n">cm2fig_y</span> <span class="p">])</span>
            
            <span class="n">nn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_cb</span><span class="p">)</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
            <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            
    <span class="c1"># there is more than independent colorbar within the figure panel        </span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">cb_plt_single</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">cb_plt</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="n">nn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">nn</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="n">auxidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cb_plt_idx</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">==</span><span class="n">cb_plt_idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">auxidx</span><span class="p">)</span>
                    
                    <span class="c1">#_______________________________________________________________________</span>
                    <span class="c1"># case of vertical colorbar</span>
                    <span class="k">if</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;right&#39;</span><span class="p">:</span>
                        <span class="n">ymax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yd</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">ymin</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">y_ax_cent</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">+</span><span class="n">yd</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span>
                        
                        <span class="n">w0</span><span class="p">,</span> <span class="n">h0</span> <span class="o">=</span> <span class="n">cb_w_s</span><span class="p">,</span> <span class="p">(</span><span class="n">ymax</span><span class="o">+</span><span class="n">yd</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span>
                        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_cbcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">y_ax_cent</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
                        <span class="n">pos_cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">y0</span><span class="o">*</span><span class="n">cm2fig_y</span><span class="p">,</span> <span class="n">w0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">h0</span><span class="o">*</span><span class="n">cm2fig_y</span> <span class="p">])</span>
                        
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_cb</span><span class="p">)</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
                        
                    <span class="c1">#_______________________________________________________________________</span>
                    <span class="c1"># case of horizontal colorbar</span>
                    <span class="k">elif</span> <span class="n">cb_pos</span><span class="o">==</span><span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
                        <span class="n">xmax</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">xd</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">xmin</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pos_axcm</span><span class="p">[</span><span class="n">auxidx</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">x_ax_cent</span> <span class="o">=</span> <span class="n">ymin</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymax</span><span class="o">+</span><span class="n">yd</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span>
                        
                        <span class="n">w0</span><span class="p">,</span> <span class="n">h0</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span><span class="o">+</span><span class="n">xd</span><span class="o">-</span><span class="n">xmin</span><span class="p">),</span> <span class="n">cb_h_s</span>
                        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_ax_cent</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">w0</span><span class="p">),</span> <span class="p">(</span><span class="n">pos_cbcm</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">pos_cb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">x0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">y0</span><span class="o">*</span><span class="n">cm2fig_y</span><span class="p">,</span> <span class="n">w0</span><span class="o">*</span><span class="n">cm2fig_x</span><span class="p">,</span> <span class="n">h0</span><span class="o">*</span><span class="n">cm2fig_y</span> <span class="p">])</span>
                        
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pos_cb</span><span class="p">)</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs_ticks</span><span class="p">)</span>
                        <span class="n">hcb</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">list_argout</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nargout</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stri</span> <span class="ow">in</span> <span class="n">nargout</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">list_argout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">stri</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; -warning-&gt; variable </span><span class="si">{</span><span class="n">stri</span><span class="si">}</span><span class="s2"> was not found, could not be added as output argument&quot;</span><span class="p">)</span> 
            
        <span class="k">return</span><span class="p">(</span><span class="n">list_argout</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_axes_enum">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_axes_enum">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_axes_enum</span><span class="p">(</span><span class="n">hax</span><span class="p">,</span> <span class="n">do_enum</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">enum_dir</span><span class="o">=</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">enum_str</span><span class="o">=</span><span class="p">[],</span> <span class="n">enum_x</span><span class="o">=</span><span class="p">[</span><span class="mf">0.005</span><span class="p">],</span> <span class="n">enum_y</span><span class="o">=</span><span class="p">[</span><span class="mf">1.00</span><span class="p">],</span> <span class="n">enum_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do enumeration of axes</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax:       list, list of all axes handles</span>

<span class="sd">        :do_enum:   bool, switch for using enumeration </span>

<span class="sd">        :nrow:      int, number of rows in multi panel plot</span>

<span class="sd">        :ncol :     int, number of column in multi panel plot</span>

<span class="sd">        :enum_dir:  str, (default: &#39;lr&#39;)  direction of numbering, &#39;lr&#39; from left to </span>
<span class="sd">                    right, &#39;ud&#39; from up to down</span>

<span class="sd">        :enum_str:  list, (default: []) overwrite default enumeration strings        , </span>

<span class="sd">        :enum_x:    float, (default: 0.005)  x position of enumeration string in </span>
<span class="sd">                    axes coordinates</span>

<span class="sd">        :enum_y:    float, (default: 1.000)  y position of enumeration string in </span>
<span class="sd">                    axes coordinates</span>

<span class="sd">        :enum_opt:  dict, (default: dict()) direct option for enumeration strings via kwarg </span>
<span class="sd">    </span>
<span class="sd">    Returns:     </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">enumn_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;horizontalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;verticalalignment&#39;</span><span class="p">:</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="n">hax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fs_label</span><span class="p">})</span>
    <span class="n">enumn_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">enum_opt</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_enum</span><span class="p">:</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># make list that looks like [ &#39;(a)&#39;, &#39;(b)&#39;, &#39;(c)&#39;, ... ]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_str</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1">#lett = &quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
            <span class="n">lett</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;j&quot;</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="s2">&quot;q&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
            <span class="n">lett</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;a2&quot;</span><span class="p">,</span><span class="s2">&quot;b2&quot;</span><span class="p">,</span><span class="s2">&quot;c2&quot;</span><span class="p">,</span><span class="s2">&quot;d2&quot;</span><span class="p">,</span><span class="s2">&quot;e2&quot;</span><span class="p">,</span><span class="s2">&quot;f2&quot;</span><span class="p">,</span><span class="s2">&quot;g2&quot;</span><span class="p">,</span><span class="s2">&quot;h2&quot;</span><span class="p">,</span><span class="s2">&quot;i2&quot;</span><span class="p">,</span><span class="s2">&quot;j2&quot;</span><span class="p">,</span><span class="s2">&quot;k2&quot;</span><span class="p">,</span><span class="s2">&quot;l2&quot;</span><span class="p">,</span><span class="s2">&quot;m2&quot;</span><span class="p">,</span><span class="s2">&quot;n2&quot;</span><span class="p">,</span><span class="s2">&quot;o2&quot;</span><span class="p">,</span><span class="s2">&quot;p2&quot;</span><span class="p">,</span><span class="s2">&quot;q2&quot;</span><span class="p">,</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span><span class="s2">&quot;s2&quot;</span><span class="p">,</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span><span class="s2">&quot;u2&quot;</span><span class="p">,</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span><span class="s2">&quot;w2&quot;</span><span class="p">,</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span><span class="s2">&quot;z2&quot;</span><span class="p">]</span>
            <span class="n">lett</span> <span class="o">=</span> <span class="n">lett</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">hax</span><span class="p">)]</span>
            <span class="n">enum_str</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hax</span><span class="p">)</span>
            
            <span class="c1"># direction of numbering: left--&gt;right</span>
            <span class="k">if</span>   <span class="n">enum_dir</span><span class="o">==</span><span class="s1">&#39;lr&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hax</span><span class="p">):</span> 
                    <span class="n">enum_str</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lett</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>
            <span class="c1"># direction of numbering: up--&gt;down</span>
            <span class="k">elif</span> <span class="n">enum_dir</span><span class="o">==</span><span class="s1">&#39;ud&#39;</span><span class="p">:</span> 
                <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hax</span><span class="p">):</span> 
                    <span class="n">aux_nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">nn</span><span class="o">/</span><span class="n">ncol</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span><span class="n">ncol</span><span class="p">)</span><span class="o">*</span><span class="n">nrow</span>
                    <span class="n">enum_str</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lett</span><span class="p">[</span><span class="n">aux_nn</span><span class="p">])</span>
    
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_x</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">enum_x</span> <span class="o">=</span> <span class="n">enum_x</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hax</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">enum_y</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">enum_y</span> <span class="o">=</span> <span class="n">enum_y</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">hax</span><span class="p">)</span>
    
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># draw text</span>
        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hax</span><span class="p">):</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">enum_x</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">enum_y</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">enum_str</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> 
                            <span class="o">**</span><span class="n">enumn_optdefault</span><span class="p">)</span>
            <span class="c1"># add text handle to axes to give possibility of changing text properties later</span>
            <span class="c1"># e.g. by hca[nn].axlab.set_fontsize(8)</span>
            <span class="n">hax</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">henum</span> <span class="o">=</span> <span class="n">ht</span></div>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1">#return(hax)</span>


    
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_data_prepare_unstruct">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_data_prepare_unstruct">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">do_ie2n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; prepare data for plotting, augment periodic boundaries, interpolate from elements</span>
<span class="sd">        to nodes, kick out nan values from plotting </span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :mesh:      fesom2 mesh object,  with all mesh information </span>
<span class="sd">        </span>
<span class="sd">        :data_plot: np.array of unstructured data </span>
<span class="sd">        </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">                    - tri.mask_e_box ... bool np.array with element masking from regional box definition</span>
<span class="sd">                    - tri.mask_n_box ... bool np.array with vertices masking from regional box selection</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :data_plot: np.array of unstructured data, augmented with periodic boundary,</span>
<span class="sd">                    limited to regional box</span>
<span class="sd">                    </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="n">is_onvert</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># data are on vertices</span>
    <span class="k">if</span>   <span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">mesh</span><span class="o">.</span><span class="n">n2dn</span><span class="p">:</span>
        <span class="n">is_onvert</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_plot</span><span class="p">,</span><span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
        
        <span class="c1"># reindex vertices array to box limits</span>
        <span class="k">if</span> <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span><span class="p">]</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># data are on elements</span>
    <span class="k">elif</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">mesh</span><span class="o">.</span><span class="n">n2de</span><span class="p">:</span>
            
        <span class="c1"># interpolate from elements to vertices --&gt; cartopy plotting is faster</span>
        <span class="k">if</span> <span class="n">do_ie2n</span><span class="p">:</span>
            <span class="n">is_onvert</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">grid_interp_e2n</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="n">data_plot</span><span class="p">)</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_plot</span><span class="p">,</span><span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
           
            <span class="c1"># reindex vertices array to box limits</span>
            <span class="k">if</span> <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span><span class="p">]</span>
            
        <span class="c1"># plot the data on elements    </span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">is_onvert</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_0</span><span class="p">],</span><span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_a</span><span class="p">]))</span>
            
            <span class="c1"># reindex element array to box limits</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="p">]</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># kick out triangles with Nan cut elements to box size        </span>
    <span class="n">isnan</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_onvert</span><span class="p">:</span>
        <span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span> <span class="o">=</span> <span class="n">isnan</span><span class="o">==</span><span class="kc">False</span>
        <span class="n">data_plot</span>     <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">isnan</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span>
    <span class="k">del</span><span class="p">(</span><span class="n">isnan</span><span class="p">)</span> 
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">tri</span><span class="p">)</span>    </div>



<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_data_prepare_vslice">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_data_prepare_vslice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_data_prepare_vslice</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">data_ii</span><span class="p">,</span> <span class="n">box_idx</span><span class="p">,</span> <span class="n">do_smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smooth_opt</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; prepare data for plotting, augment periodic boundaries, interpolate from elements</span>
<span class="sd">        to nodes, kick out nan values from plotting </span>

<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax:       handle of current axes</span>
<span class="sd">    </span>
<span class="sd">        :data_ii:   xarray dataset object of axes ii, can contains the info </span>
<span class="sd">                    data_ii[box_idx] of several defined boxes which can be selected</span>
<span class="sd">                    via box_idx index </span>

<span class="sd">        :box_idx:   index of box selection in data_ii[box_idx]</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :data_x:    np.array, data for x-axis  </span>

<span class="sd">        :data_y:    np.array, data fox y-axes</span>

<span class="sd">        :data_plot: np.array, data to plot on regular vertical grid </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># prepare vertical regular gridded data for plotting --&gt; here data are index </span>
    <span class="c1"># list --&gt; defined by box index box_idx</span>
    <span class="k">if</span> <span class="n">box_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_y</span><span class="p">,</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;Depth / m&#39;</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># data must be a transect </span>
        <span class="k">if</span> <span class="s1">&#39;dst&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">auxlat</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">auxlon</span><span class="p">))</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">auxlat</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">auxlat</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">auxlon</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">auxlon</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">auxlat</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">auxlon</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">if</span>   <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="p">,</span> <span class="s1">&#39;Latitude / deg&#39;</span>
            <span class="k">elif</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="p">,</span> <span class="s1">&#39;Longitude / deg&#39;</span>
            <span class="k">else</span>           <span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;dst&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Distance / km&#39;</span>   
            <span class="k">del</span><span class="p">(</span><span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># data can be any other vertical index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span>   <span class="s1">&#39;lat&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Latitude / deg&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;lon&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Longitude / deg&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;time&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>     
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;Time / year&#39;</span>
                <span class="c1"># recompute xarray time vector into units of year</span>
                <span class="n">totdayperyear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span><span class="p">,</span> <span class="mi">366</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
                <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span><span class="o">-</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">totdayperyear</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="k">del</span><span class="p">(</span><span class="n">totdayperyear</span><span class="p">)</span>
                
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">do_smooth</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">convolve</span>
            <span class="n">filt</span> <span class="o">=</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">smooth_opt</span><span class="p">)</span>
            <span class="n">filt</span> <span class="o">=</span> <span class="n">filt</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">filt</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            <span class="n">nan_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span>
            <span class="n">data_plot</span><span class="p">[</span><span class="n">nan_mask</span><span class="p">]</span><span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Perform convolution on normal array</span>
            <span class="n">data_smth</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Convolve the NaN mask to count valid elements in each window</span>
            <span class="n">valid_counts</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="o">~</span><span class="n">nan_mask</span><span class="p">),</span> <span class="n">filt</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># Avoid division warnings</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valid_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data_smth</span> <span class="o">/</span> <span class="n">valid_counts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  
            <span class="k">del</span><span class="p">(</span><span class="n">data_smth</span><span class="p">,</span> <span class="n">valid_counts</span><span class="p">)</span>    
            
        
    <span class="c1"># data is a direct vertical profile and not a list of index profiles e,g MOC         </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1">#___Y-axis variables____________________________________________________</span>
        <span class="c1"># </span>
        <span class="k">if</span>   <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">data_y</span><span class="p">,</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="p">,</span> <span class="s1">&#39;Depth / m&#39;</span>
        
        <span class="c1"># dmoc y-varaible for zcoord remapping </span>
        <span class="k">elif</span> <span class="s1">&#39;ndens_zfh&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
            <span class="n">data_y</span><span class="p">,</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;ndens_zfh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Depth / m&#39;</span>
             
        <span class="k">elif</span> <span class="s1">&#39;nz_rho&#39;</span>    <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
            <span class="c1">#data_x, data_y, data_v, dum = do_ztransform_martin(mesh, data[ii])</span>
            <span class="c1">#data_x, data_y, data_v = do_ztransform_mom6(mesh, data[ii])</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">do_ztransform_hydrography</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">data_ii</span><span class="p">)</span>
            <span class="n">data_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">data_y</span>
            
        <span class="k">elif</span> <span class="s1">&#39;ndens_z&#39;</span>    <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">do_ztransform</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        
        <span class="c1"># dmoc in density coordinates         </span>
        <span class="k">elif</span> <span class="s1">&#39;dens&#39;</span>    <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
            <span class="n">data_y</span><span class="p">,</span> <span class="n">str_ylabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;dens&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;${</span><span class="se">\\</span><span class="s1">sigma}_</span><span class="si">{2}</span><span class="s1">$ pot. Density / kg${</span><span class="se">\\</span><span class="s1">cdot}$m$^{-3}$&#39;</span>
            <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        
        <span class="c1">#___X-axis variables____________________________________________________</span>
        <span class="c1"># data must be a transect </span>
        <span class="k">if</span> <span class="s1">&#39;dst&#39;</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">auxlat</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">auxlon</span><span class="p">))</span>
            <span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span> <span class="o">=</span> <span class="n">auxlat</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">auxlat</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">auxlon</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">auxlon</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">auxlat</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">auxlon</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">if</span>   <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="p">,</span> <span class="s1">&#39;Latitude / deg&#39;</span>
            <span class="k">elif</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="p">,</span> <span class="s1">&#39;Longitude / deg&#39;</span>
            <span class="k">else</span>           <span class="p">:</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;dst&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Distance / km&#39;</span>   
            <span class="k">del</span><span class="p">(</span><span class="n">auxlat</span><span class="p">,</span> <span class="n">auxlon</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            
        <span class="c1"># data can be any other vertical index    </span>
        <span class="k">else</span><span class="p">:</span>     
            <span class="k">if</span>   <span class="s1">&#39;lat&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Latitude / deg&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;lon&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="p">,</span> <span class="s1">&#39;Longitude / deg&#39;</span>
            <span class="k">elif</span> <span class="s1">&#39;time&#39;</span>  <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>     
                <span class="n">data_x</span><span class="p">,</span> <span class="n">str_xlabel</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;Time / year&#39;</span>
                <span class="c1"># recompute xarray time vector into units of year</span>
                <span class="n">totdayperyear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">is_leap_year</span><span class="p">,</span> <span class="mi">366</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
                <span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="p">(</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span><span class="o">-</span><span class="n">data_x</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">totdayperyear</span>  
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="s1">&#39;ndens_zfh&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span> 
                <span class="n">data_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">data_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">data_x</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">str_xlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">str_ylabel</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_data_norm">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_data_norm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_data_norm</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; prepare renormation object, for log10 or slog10  </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>
<span class="sd">    </span>
<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling (mcolors.LogNorm)</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling (mcolors.SymLogNorm)</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps (mcolors.BoundaryNorm)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        :which_norm:  None or renormation object</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">which_norm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span>   <span class="n">do_rescale</span> <span class="o">==</span><span class="s1">&#39;log10&#39;</span><span class="p">:</span>
                <span class="n">which_norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                
        <span class="k">elif</span> <span class="n">do_rescale</span> <span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span>    
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">])))</span>
                <span class="n">which_norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">SymLogNorm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">])),</span>
                                                <span class="n">linscale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                                                <span class="n">vmin</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                                                <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">which_norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#else:  </span>
        <span class="c1">#which_norm = mcolors.NoNorm(vmin=cinfo[&#39;clevel&#39;][0], vmax=cinfo[&#39;clevel&#39;][ -1], clip=False)</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">which_norm</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_data">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_data</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">which_norm_plot</span><span class="p">,</span>
                <span class="n">plt_opt</span>  <span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                <span class="n">plt_contb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                <span class="n">plt_contf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                <span class="n">plt_contr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                <span class="n">plt_contl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot triangular data based on tripcolor or tricontourf</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>

<span class="sd">        :do_plt:        str, (default: tpc)</span>
<span class="sd">                        - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                        - tcf ... make contourf coor plot (tricontourf)  , # tpc:tripcolor, tcf:tricontourf    </span>

<span class="sd">        :tri:           matplotlib.tri triangulation object</span>
<span class="sd">                        - tri.mask_e_ok...provide mask with nan values, that describe the bottom limited to regional box</span>

<span class="sd">        :data_plot:     np.array of unstructured data, augmented with periodic boundary,</span>

<span class="sd">        :cinfo_plot:    None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                        Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                        entries can be,</span>
<span class="sd">                        </span>
<span class="sd">                        - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                        - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                        - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                        - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                        - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                        - cinfo[&#39;clevel&#39;] ... color level array</span>
<span class="sd">    </span>
<span class="sd">        :which_norm_plot:     None or renormation object</span>

<span class="sd">        :plt_opt:       dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                        or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb:     bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt:     dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contf:     bool, (default: False) overlay thicker contour lines of the main colorbar steps (foreground)</span>

<span class="sd">        :pltcf_opt:     dict, (default: dict()) foreground contour line option</span>

<span class="sd">        :plt_contr:     bool, (default: False) overlay thick contour lines of reference color steps (reference)</span>

<span class="sd">        :pltcr_opt:     dict, (default: dict()) reference contour line option</span>

<span class="sd">        :plt_contl:     bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt:     dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:            return matplotlib handle of plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># plot tripcolor</span>
    <span class="k">if</span>   <span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tpc&#39;</span><span class="p">,</span><span class="s1">&#39;pc&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tcf&#39;</span><span class="p">,</span><span class="s1">&#39;cf&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="n">plt_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;shading&#39;</span><span class="p">:</span><span class="s1">&#39;gouraud&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
        
        <span class="c1">## pcolor plot in combination with shading :gouraud and orthographic projection</span>
        <span class="c1">## leads to an blow up of the plotting therefor change to flat shading </span>
        <span class="c1">#if tri.x.size!=data_plot.size or isinstance(hax_ii.projection, (ccrs.Orthographic, ccrs.NearsidePerspective)): </span>
            <span class="c1">#plt_optdefault.update({&#39;shading&#39;:&#39;flat&#39;})</span>
        
        <span class="c1"># if which_normplot is specified like in case of log10 and slog10 scaling</span>
        <span class="c1"># vmin and vmax argumetns are not allows</span>
        <span class="n">cminmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">which_norm_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cminmax</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]})</span>
        
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:],</span> <span class="n">data_plot</span><span class="p">,</span>
                              <span class="n">cmap</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">norm</span> <span class="o">=</span> <span class="n">which_norm_plot</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">cminmax</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_optdefault</span><span class="p">)</span>

    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># plot tricontour </span>
    <span class="k">elif</span> <span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tcf&#39;</span><span class="p">,</span><span class="s1">&#39;cf&#39;</span><span class="p">]:</span> 
        <span class="n">plt_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
    
        <span class="c1"># supress warning message when compared with nan</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">data_plot</span><span class="p">[</span><span class="n">data_plot</span><span class="o">&lt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data_plot</span><span class="p">[</span><span class="n">data_plot</span><span class="o">&gt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:],</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="n">which_norm_plot</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_optdefault</span><span class="p">)</span> 
        
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; --&gt; this do_plt=</span><span class="si">{:s}</span><span class="s1"> value is not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">do_plt</span><span class="p">))</span>            
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay background contour lines, very thin lines </span>
    <span class="k">if</span> <span class="n">plt_contb</span> <span class="ow">and</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">pltcb_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcb_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcb_opt</span><span class="p">)</span>
        <span class="n">h0cb</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:],</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">pltcb_optdefault</span><span class="p">)</span> 
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay foreground contour lines, of colorbar steps thicker line </span>
    <span class="k">if</span> <span class="n">plt_contf</span> <span class="ow">and</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">pltcf_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcf_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcf_opt</span><span class="p">)</span>
        <span class="n">h0cf</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:],</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">pltcf_optdefault</span><span class="p">)</span> 
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">plt_contl</span><span class="p">:</span>
            <span class="n">pltcl_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;inline&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;inline_spacing&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;fmt&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%1.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
            <span class="n">pltcl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcl_opt</span><span class="p">)</span>
            <span class="n">h0cft</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">h0cf</span><span class="p">,</span> <span class="n">h0cf</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcl_optdefault</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay reference contour lines, of colorbar reference center value</span>
    <span class="k">if</span> <span class="n">plt_contr</span> <span class="ow">and</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="n">data_plot</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">pltcr_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcr_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcr_opt</span><span class="p">)</span>
        <span class="n">h0cr</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:],</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]],</span> <span class="o">**</span><span class="n">pltcr_optdefault</span><span class="p">)</span> 
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">plt_contl</span><span class="p">:</span>
            <span class="n">pltcl_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;inline&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;inline_spacing&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;fmt&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%1.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
            <span class="n">pltcl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcl_opt</span><span class="p">)</span>
            <span class="n">h0crt</span><span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">h0cr</span><span class="p">,</span> <span class="n">h0cr</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcl_optdefault</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_datareg">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_datareg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_datareg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_plt</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">which_norm_plot</span><span class="p">,</span> 
                <span class="n">plt_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">which_transf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">plt_contb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                <span class="n">plt_contf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                <span class="n">plt_contr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                <span class="n">plt_contl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot regular gridded data (binned, coarse grained data) via pcolormesh and contourf</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>

<span class="sd">        :do_plt:        str, (default: tpc)</span>
<span class="sd">                        - tpc ... make pseudocolor plot (tripcolor)</span>
<span class="sd">                        - tcf ... make contourf coor plot (tricontourf)</span>

<span class="sd">        :data_x:        regular longitude array</span>
<span class="sd">        </span>
<span class="sd">        :data_y:        regular latitude array</span>
<span class="sd">        </span>
<span class="sd">        :data_plot:     np.array of regular gridded data</span>

<span class="sd">        :cinfo_plot:    None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                        Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                        entries can be,</span>
<span class="sd">                        </span>
<span class="sd">                        - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                        - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                        - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                        - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                        - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                        - cinfo[&#39;clevel&#39;] ... color level array</span>
<span class="sd">    </span>
<span class="sd">        :which_norm:    None or renormation object</span>

<span class="sd">        :plt_opt:       dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                        or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb:     bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt:     dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contf:     bool, (default: False) overlay thicker contour lines of the main colorbar steps (foreground)</span>

<span class="sd">        :pltcf_opt:     dict, (default: dict()) foreground contour line option</span>

<span class="sd">        :plt_contr:     bool, (default: False) overlay thick contour lines of reference color steps (reference)</span>

<span class="sd">        :pltcr_opt:     dict, (default: dict()) reference contour line option</span>

<span class="sd">        :plt_contl:     bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt:     dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        h0:             return matplotlib handle of plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># plot pcolor</span>
    <span class="k">if</span>   <span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tpc&#39;</span><span class="p">,</span><span class="s1">&#39;pc&#39;</span><span class="p">]:</span>
        <span class="c1">#plt_optdefault = dict({&#39;shading&#39;:&#39;gouraud&#39;})</span>
        <span class="n">plt_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;shading&#39;</span><span class="p">:</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s1">&#39;shading&#39;</span> <span class="ow">in</span> <span class="n">plt_optdefault</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plt_optdefault</span><span class="p">[</span><span class="s1">&#39;shading&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">data_plot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
        
        <span class="c1"># if which_normplot is specified like in case of log10 and slog10 scaling</span>
        <span class="c1"># vmin and vmax argumetns are not allows</span>
        <span class="n">cminmax</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">which_norm_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cminmax</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]})</span>
        
        <span class="c1"># the transform=which_transf options in combination with pcolormesh seems </span>
        <span class="c1"># only to work in case of horizontal cartopy plot not in vertical slice </span>
        <span class="c1"># plot even when which_transf=None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span><span class="n">which_transf</span><span class="p">})</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span> 
                               <span class="n">cmap</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">which_norm_plot</span><span class="p">,</span> <span class="o">**</span><span class="n">cminmax</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_optdefault</span><span class="p">)</span>
        
        <span class="c1">#0 = hax_ii.pcolormesh(data_x, data_y, data_plot,</span>
                              <span class="c1">#cmap=cinfo_plot[&#39;cmap&#39;],</span>
                              <span class="c1">#norm=which_norm_plot, transform=which_transf, **cminmax, **plt_optdefault)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># plot contourf </span>
    <span class="k">elif</span> <span class="n">do_plt</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tcf&#39;</span><span class="p">,</span><span class="s1">&#39;cf&#39;</span><span class="p">]:</span> 
        <span class="n">plt_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">plt_opt</span><span class="p">)</span>
    
        <span class="c1"># supress warning message when compared with nan</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">data_plot</span><span class="p">[</span><span class="n">data_plot</span><span class="o">&lt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">data_plot</span><span class="p">[</span><span class="n">data_plot</span><span class="o">&gt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                <span class="n">norm</span><span class="o">=</span><span class="n">which_norm_plot</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">which_transf</span><span class="p">,</span> <span class="o">**</span><span class="n">plt_optdefault</span><span class="p">)</span> 
        
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; --&gt; this do_plt=</span><span class="si">{:s}</span><span class="s1"> value is not valid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">do_plt</span><span class="p">))</span>            
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># solve problem between  using lat_bnd &amp; lon_bnd and lat &amp; lon</span>
    <span class="k">if</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span>   <span class="n">data_plot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">:</span> <span class="n">data_x0</span><span class="o">=</span><span class="n">data_x</span>
        <span class="k">elif</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">data_x0</span><span class="o">=</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">data_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="k">if</span>   <span class="n">data_plot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">:</span> <span class="n">data_y0</span><span class="o">=</span><span class="n">data_y</span>
        <span class="k">elif</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">data_y0</span><span class="o">=</span><span class="p">(</span><span class="n">data_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">data_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">data_x0</span><span class="p">,</span> <span class="n">data_y0</span><span class="o">=</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay background contour lines, very thin lines </span>
    <span class="k">if</span> <span class="n">plt_contb</span><span class="p">:</span>
        <span class="n">pltcb_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcb_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcb_opt</span><span class="p">)</span>
        <span class="n">h0cb</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">data_x0</span><span class="p">,</span> <span class="n">data_y0</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">which_transf</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcb_optdefault</span><span class="p">)</span> 
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay foreground contour lines, of colorbar steps thicker line </span>
    <span class="k">if</span> <span class="n">plt_contf</span><span class="p">:</span>    
        <span class="n">pltcf_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcf_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcf_opt</span><span class="p">)</span>
        <span class="n">h0cf</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">data_x0</span><span class="p">,</span> <span class="n">data_y0</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">which_transf</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcf_optdefault</span><span class="p">)</span> 
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">plt_contl</span><span class="p">:</span>
            <span class="n">pltcl_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;inline&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;inline_spacing&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;fmt&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%1.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
            <span class="n">pltcl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcl_opt</span><span class="p">)</span>
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">h0cf</span><span class="p">,</span> <span class="n">h0cf</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcl_optdefault</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># overlay reference contour lines, of colorbar reference center value</span>
    <span class="k">if</span> <span class="n">plt_contr</span><span class="p">:</span>    
        <span class="n">pltcr_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyles&#39;</span><span class="p">:</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
        <span class="n">pltcr_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcr_opt</span><span class="p">)</span>
        <span class="n">h0cr</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">data_x0</span><span class="p">,</span> <span class="n">data_y0</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">,</span>
                                <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]],</span> <span class="n">transform</span><span class="o">=</span><span class="n">which_transf</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcr_optdefault</span><span class="p">)</span> 
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">plt_contl</span><span class="p">:</span>
            <span class="n">pltcl_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;inline&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;inline_spacing&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;fmt&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%1.2f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
            <span class="n">pltcl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pltcl_opt</span><span class="p">)</span>
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">h0cr</span><span class="p">,</span> <span class="n">h0cr</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">pltcl_optdefault</span><span class="p">)</span>
            
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_quiver">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_quiver">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_quiver</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_quiv</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">,</span> 
                  <span class="n">cinfo_plot</span><span class="p">,</span> <span class="n">norm_plot</span><span class="p">,</span> <span class="n">quiv_scalfac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quiv_arrwidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">quiv_dens</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> 
                  <span class="n">quiv_smax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">quiv_shiftL</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">quiv_smooth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">quiv_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot triangular data as quiver plot </span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>

<span class="sd">        :do_quiv:       bool, do cartopy quiver plot</span>
<span class="sd">        </span>
<span class="sd">        :tri:           matplotlib.tri triangulation object</span>
<span class="sd">                        - tri.mask_e_ok...provide mask with nan values, that describe the bottom limited to regional box</span>

<span class="sd">        :data_plot_u:   np.array of unstructured zonal vector component</span>

<span class="sd">        :data_plot_v:   np.array of unstructured meridional vector component</span>

<span class="sd">        :cinfo_plot:    None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                        Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                        entries can be,</span>
<span class="sd">                        </span>
<span class="sd">                        - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                        - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                        - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                        - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                        - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                        - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :norm_plot:     None or renormation object</span>
<span class="sd">        </span>
<span class="sd">        :quiv_scalfac:  float, (default: 1.0)  bigger means larger arrows</span>

<span class="sd">        :quiv_arrwidth: float, (default: 0.25) scale arrow width</span>

<span class="sd">        :quiv_dens:     float, (default: 0.5)  larger mean more excluded arrows</span>

<span class="sd">        :quiv_smax:     float, (default: 10) small arrow are scaled strong with factor smax, its off when smax=1</span>

<span class="sd">        :quiv_shiftL:   float, (default: 2) shift smothing function to the left</span>

<span class="sd">        :quiv_smooth:   float, (default: 2) slope of transitions zone, smaller value steeper transition</span>

<span class="sd">        :quiv_opt:      dict, (default: dict()) additional options that are given to quiver plot routine</span>

<span class="sd">    Returns:</span>

<span class="sd">        :h0:   return handle of quiver plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">do_quiv</span><span class="p">:</span> 
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># prepare quiver data</span>
        <span class="n">data_plot_n</span>              <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data_plot_u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_plot_v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="o">/</span><span class="n">data_plot_n</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="o">/</span><span class="n">data_plot_n</span>
        <span class="n">data_plot_n</span><span class="p">[</span><span class="n">data_plot_n</span><span class="o">&lt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>  <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#+np.finfo(np.float32).eps</span>
        <span class="n">data_plot_n</span><span class="p">[</span><span class="n">data_plot_n</span><span class="o">&gt;</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1">#-np.finfo(np.float32).eps</span>
        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="o">*</span><span class="n">data_plot_n</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="o">*</span><span class="n">data_plot_n</span>
        
        <span class="n">nmax</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_plot_n</span><span class="p">)</span>
        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="o">/</span><span class="n">nmax</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="o">/</span><span class="n">nmax</span>

        <span class="c1"># scale up weaker flow vectors stronger so that also weaker flows become more visible</span>
        <span class="c1"># if quiv_scal=1 this scaling is switched off </span>
        <span class="n">fac</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(((</span><span class="n">data_plot_n</span><span class="o">/</span><span class="n">nmax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">quiv_shiftL</span> <span class="p">)</span><span class="o">/</span><span class="n">quiv_smooth</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">fac</span>   <span class="o">=</span> <span class="n">fac</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">fac</span><span class="p">)</span>
        <span class="n">fac</span>   <span class="o">=</span> <span class="n">fac</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">fac</span><span class="p">)</span>
        <span class="n">fac</span>   <span class="o">=</span> <span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="n">quiv_smax</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="o">*</span><span class="n">fac</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="o">*</span><span class="n">fac</span>
        
                
        <span class="c1"># convert into cartopy projection frame </span>
        <span class="k">if</span> <span class="n">data_plot_u</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">tri</span><span class="o">.</span><span class="n">xorig</span><span class="o">.</span><span class="n">size</span><span class="p">:</span> 
            <span class="n">isonvert</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">tri0x</span><span class="p">,</span> <span class="n">tri0y</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span>
            <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_vectors</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> 
                                                                <span class="n">tri</span><span class="o">.</span><span class="n">xorig</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">yorig</span><span class="p">,</span> 
                                                                <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isonvert</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">,:]</span>
            <span class="n">tri0x</span>    <span class="p">,</span> <span class="n">tri0y</span>     <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">[</span>    <span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">[</span>    <span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span>
            <span class="n">tri0xorig</span><span class="p">,</span> <span class="n">tri0yorig</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">xorig</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">yorig</span><span class="p">[</span><span class="n">triangles</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span>
            <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_vectors</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> 
                                                                <span class="n">tri0xorig</span><span class="p">,</span> <span class="n">tri0yorig</span><span class="p">,</span> 
                                                                <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">)</span>
            <span class="k">del</span><span class="p">(</span><span class="n">triangles</span><span class="p">,</span> <span class="n">tri0xorig</span><span class="p">,</span> <span class="n">tri0yorig</span><span class="p">)</span>
            
            
        <span class="c1"># kick out nan values from quiver coordinates </span>
        <span class="n">mask_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_plot_u</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="n">tri0x</span><span class="p">,</span> <span class="n">tri0y</span> <span class="o">=</span> <span class="n">tri0x</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">tri0y</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]</span>
        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">,</span> <span class="n">data_plot_n</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">data_plot_v</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">data_plot_n</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]</span>
        
        <span class="c1">## kick out to small arrows</span>
        <span class="c1">#mean, std   = np.nanmean(data_plot_n), np.nanstd(data_plot_n)</span>
        <span class="c1">#mask_quiv   = data_plot_n&gt;mean-std*quiv_excl</span>
        <span class="c1">#tri0x       = tri0x[mask_quiv], </span>
        <span class="c1">#tri0y       = tri0y[mask_quiv],                         </span>
        <span class="c1">#data_plot_u = data_plot_u[mask_quiv], </span>
        <span class="c1">#data_plot_v = data_plot_v[mask_quiv], </span>
        <span class="c1">#data_plot_n = data_plot_n[mask_quiv]</span>
        
        <span class="c1"># kick out arrows based on density </span>
        <span class="k">if</span> <span class="n">quiv_dens</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tri</span><span class="o">.</span><span class="n">narea</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isonvert</span><span class="p">:</span>
                <span class="n">r0</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">narea</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aux_earea</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">earea</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="p">]</span>
                <span class="n">r0</span>      <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">aux_earea</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]))</span>
                <span class="k">del</span><span class="p">(</span><span class="n">aux_earea</span><span class="p">)</span>
                
            <span class="n">mask_quiv</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">tri0x</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">&gt;</span><span class="n">r0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r0</span><span class="p">)</span><span class="o">*</span><span class="n">quiv_dens</span> <span class="c1">#1.5</span>
            <span class="c1">#mask_quiv = np.logical_and(isok,mask_quiv)</span>
            <span class="n">tri0x</span>       <span class="o">=</span> <span class="n">tri0x</span><span class="p">[</span><span class="n">mask_quiv</span><span class="p">],</span> 
            <span class="n">tri0y</span>       <span class="o">=</span> <span class="n">tri0y</span><span class="p">[</span><span class="n">mask_quiv</span><span class="p">],</span>                         
            <span class="n">data_plot_u</span> <span class="o">=</span> <span class="n">data_plot_u</span><span class="p">[</span><span class="n">mask_quiv</span><span class="p">],</span> 
            <span class="n">data_plot_v</span> <span class="o">=</span> <span class="n">data_plot_v</span><span class="p">[</span><span class="n">mask_quiv</span><span class="p">],</span> 
            <span class="n">data_plot_n</span> <span class="o">=</span> <span class="n">data_plot_n</span><span class="p">[</span><span class="n">mask_quiv</span><span class="p">]</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># try to do scaling projection space dependent</span>
        <span class="c1"># Define the geographic coordinates bounding the area of interest</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ddx</span>  <span class="p">,</span> <span class="n">ddy</span>   <span class="o">=</span> <span class="n">max_x</span><span class="o">-</span><span class="n">min_x</span> <span class="p">,</span> <span class="n">max_y</span><span class="o">-</span><span class="n">min_y</span>
          
        <span class="n">min_x</span> <span class="o">+=</span> <span class="n">ddx</span><span class="o">*</span><span class="mf">0.025</span>  
        <span class="n">min_y</span> <span class="o">+=</span> <span class="n">ddy</span><span class="o">*</span><span class="mf">0.025</span>
        <span class="n">max_x</span> <span class="o">-=</span> <span class="n">ddx</span><span class="o">*</span><span class="mf">0.025</span>  
        <span class="n">max_y</span> <span class="o">-=</span> <span class="n">ddy</span><span class="o">*</span><span class="mf">0.025</span>
        
        <span class="c1"># Transform the minimum and maximum points</span>
        <span class="n">min_lon</span><span class="p">,</span> <span class="n">dum</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="p">(</span><span class="n">min_y</span><span class="o">+</span><span class="n">max_y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
        <span class="n">max_lon</span><span class="p">,</span> <span class="n">dum</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="p">(</span><span class="n">min_y</span><span class="o">+</span><span class="n">max_y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
        <span class="n">dum</span><span class="p">,</span> <span class="n">min_lat</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">min_x</span><span class="o">+</span><span class="n">max_x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
        <span class="n">dum</span><span class="p">,</span> <span class="n">max_lat</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_point</span><span class="p">((</span><span class="n">min_x</span><span class="o">+</span><span class="n">max_x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">)</span>
        
        <span class="c1"># Calculate the distance in kilometers using the scale factor</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_lon</span> <span class="o">-</span> <span class="n">min_lon</span><span class="p">)</span>  <span class="c1"># Convert meters to kilometers</span>
        <span class="n">dlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_lat</span> <span class="o">-</span> <span class="n">min_lat</span><span class="p">)</span>  <span class="c1"># Convert meters to kilometers</span>
        
        <span class="n">dy</span>   <span class="o">=</span> <span class="n">dlat</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">6371</span><span class="o">/</span><span class="mi">180</span>
        <span class="n">dx</span>   <span class="o">=</span> <span class="n">dlon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">6371</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span> <span class="p">(</span><span class="n">min_lat</span><span class="o">+</span><span class="n">max_lat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">))</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># add quiver plot </span>
        <span class="n">max_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">])</span><span class="o">*</span><span class="mi">10</span>
        <span class="k">if</span> <span class="n">quiv_scalfac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">quiv_scalfac</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">max_dim</span><span class="o">/</span><span class="n">quiv_scalfac</span>
        <span class="k">if</span> <span class="n">quiv_arrwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">quiv_arrwidth</span> <span class="o">=</span> <span class="n">max_dim</span><span class="o">*</span><span class="n">quiv_arrwidth</span>
        
        <span class="n">quiv_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">quiv_arrwidth</span> <span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> \
                              <span class="s1">&#39;scale_units&#39;</span><span class="p">:</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;angles&#39;</span><span class="p">:</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">quiv_scalfac</span><span class="p">})</span> 
        <span class="n">quiv_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">quiv_opt</span><span class="p">)</span>
        
        <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">tri0x</span><span class="p">,</span> <span class="n">tri0y</span><span class="p">,</span> 
                        <span class="n">data_plot_u</span><span class="p">,</span> <span class="n">data_plot_v</span><span class="p">,</span> 
                        <span class="n">data_plot_n</span><span class="p">,</span>
                        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span>                    
                        <span class="n">norm</span> <span class="o">=</span> <span class="n">norm_plot</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">quiv_optdefault</span><span class="p">,</span> 
                        <span class="p">)</span>
        
        <span class="n">h0</span><span class="o">.</span><span class="n">set_clim</span><span class="p">([</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">cinfo_plot</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">del</span><span class="p">(</span><span class="n">tri0x</span><span class="p">,</span> <span class="n">tri0y</span><span class="p">)</span>    
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>



<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_streaml_reg">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_streaml_reg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_streaml_reg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">do_streaml</span><span class="p">,</span> <span class="n">streaml_dat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">streaml_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                   <span class="n">do_streaml_leg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">streaml_leg_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                   <span class="n">box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which_transf</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot streamlines over scalar data, based on regular gridded lon,lat vector </span>
<span class="sd">        data. Data can originate either from corase graining or interpolation</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>
<span class="sd">    </span>
<span class="sd">        :ii:            int, index of handle ii</span>
<span class="sd">    </span>
<span class="sd">        :do_streaml:    bool, do cartopy streaml plot</span>
<span class="sd">    </span>
<span class="sd">        :streaml_dat:   list of xr.Datasets with u,v data in it (default=None)</span>
<span class="sd">    </span>
<span class="sd">            ::</span>
<span class="sd">    </span>
<span class="sd">                Dimensions:  (lat: 85, lon: 180, n2: 2)</span>
<span class="sd">                Coordinates:</span>
<span class="sd">                * lat      (lat) float32 340B -79.0 -77.0 -75.0 -73.0 ... 83.0 85.0 87.0 89.0</span>
<span class="sd">                * lon      (lon) float32 720B -179.0 -177.0 -175.0 ... 175.0 177.0 179.0</span>
<span class="sd">                    nzi      float64 8B 15.89</span>
<span class="sd">                    nz1      int64 8B 250</span>
<span class="sd">                    lat_bnd  (lat, n2) float32 680B -80.0 -78.0 -78.0 -76.0 ... 88.0 nan nan</span>
<span class="sd">                    lon_bnd  (lon, n2) float32 1kB -180.0 -178.0 -178.0 ... 178.0 178.0 180.0</span>
<span class="sd">                    w_A      (lat, lon) float32 61kB 9.437e+09 9.437e+09 9.437e+09 ... nan nan</span>
<span class="sd">                Dimensions without coordinates: n2</span>
<span class="sd">                Data variables:</span>
<span class="sd">                    u        (lat, lon) float32 61kB -0.003229 -0.003186 -0.002711 ... nan nan</span>
<span class="sd">                    v        (lat, lon) float32 61kB 0.0007711 0.000357 0.001531 ... nan nan</span>
<span class="sd">                Attributes: (12/19)</span>
<span class="sd">                    FESOM_model:                         FESOM2</span>
<span class="sd">                    FESOM_website:                       fesom.de</span>
<span class="sd">                    FESOM_git_SHA:                       02f7d080</span>
<span class="sd">                    FESOM_MeshPath:                      /albedo/work/user/pscholz/mesh_fesom...</span>
<span class="sd">                    FESOM_mesh_representative_checksum:  297ddf9c482ca68c86a979e1bd5d3c97</span>
<span class="sd">                    FESOM_ClimateDataPath:               /albedo/work/projects/p_fesom/FROM-O...</span>
<span class="sd">                    ...                                  ...</span>
<span class="sd">                </span>
<span class="sd">        :streaml_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                        streamline plot routine</span>
<span class="sd">                        </span>
<span class="sd">        :do_streaml_leg: bool, (default: False) overlay legend for streamline plot, keep in mind that the position for </span>
<span class="sd">                               legend is somewhat pre setted by hand </span>

<span class="sd">        :streaml_leg_opt: dict, (default=dict()) additional option for the position of the streamline legend</span>
<span class="sd">        </span>
<span class="sd">        :box:           None, list (default: None) regional limitation of plot. For ortho...</span>
<span class="sd">                        box=[lonc, latc], nears...box=[lonc, latc, zoom], for all others box = </span>
<span class="sd">                        [lonmin, lonmax, latmin, latmax]</span>
<span class="sd">        </span>
<span class="sd">        :which_transf:  ccrs.CRS (default=None) data starting projection usually ccrs.PlateCaree()</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:            return matplotlib handle of streamline</span>
<span class="sd">        </span>
<span class="sd">    #___________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">do_streaml</span> <span class="ow">and</span> <span class="n">streaml_dat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">streaml_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span>    <span class="p">],</span> <span class="n">streaml_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span>    <span class="p">]</span>
        <span class="n">vnm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">streaml_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
        <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">streaml_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vnm</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">streaml_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vnm</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
        <span class="c1"># limit data to regional box</span>
        <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx_x</span> <span class="p">,</span> <span class="n">idx_y</span>  <span class="o">=</span> <span class="p">(</span><span class="n">data_x</span><span class="o">&gt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_x</span><span class="o">&lt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">data_y</span><span class="o">&gt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_y</span><span class="o">&lt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">idx_x</span>  <span class="p">],</span> <span class="n">data_y</span><span class="p">[</span><span class="n">idx_y</span>  <span class="p">]</span>
            <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">data_u</span><span class="p">[</span><span class="n">idx_y</span><span class="p">,:],</span> <span class="n">data_v</span><span class="p">[</span><span class="n">idx_y</span><span class="p">,:]</span>
            <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">data_u</span><span class="p">[:,</span><span class="n">idx_x</span><span class="p">],</span> <span class="n">data_v</span><span class="p">[:,</span><span class="n">idx_x</span><span class="p">]</span>
            <span class="k">del</span><span class="p">(</span><span class="n">idx_x</span><span class="p">,</span> <span class="n">idx_y</span><span class="p">)</span>
        
        <span class="c1"># vector norm --&gt; speed</span>
        <span class="n">data_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data_u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">speed_min</span><span class="p">,</span> <span class="n">speed_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_s</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_s</span><span class="p">)</span>
                
        <span class="c1"># compute scaled line width based on speed</span>
        <span class="n">lw_min</span><span class="p">,</span> <span class="n">lw_max</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">5.0</span>
        <span class="k">if</span> <span class="s1">&#39;lw_min&#39;</span> <span class="ow">in</span> <span class="n">streaml_opt</span><span class="p">:</span> 
            <span class="n">lw_min</span> <span class="o">=</span> <span class="n">streaml_opt</span><span class="p">[</span><span class="s1">&#39;lw_min&#39;</span><span class="p">]</span>
            <span class="k">del</span><span class="p">(</span><span class="n">streaml_opt</span><span class="p">[</span><span class="s1">&#39;lw_min&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;lw_max&#39;</span> <span class="ow">in</span> <span class="n">streaml_opt</span><span class="p">:</span> 
            <span class="n">lw_max</span> <span class="o">=</span> <span class="n">streaml_opt</span><span class="p">[</span><span class="s1">&#39;lw_max&#39;</span><span class="p">]</span>
            <span class="k">del</span><span class="p">(</span><span class="n">streaml_opt</span><span class="p">[</span><span class="s1">&#39;lw_max&#39;</span><span class="p">])</span>    

        <span class="k">def</span><span class="w"> </span><span class="nf">speed2lw</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">speed_min</span><span class="p">,</span> <span class="n">speed_max</span><span class="p">,</span> <span class="n">lw_min</span><span class="p">,</span> <span class="n">lw_max</span><span class="p">):</span>
            <span class="c1">#lw = speed</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="p">(</span><span class="n">speed</span><span class="o">-</span><span class="n">speed_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">speed_max</span><span class="o">-</span><span class="n">speed_min</span><span class="p">)</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="n">lw</span><span class="o">*</span><span class="p">(</span><span class="n">lw_max</span><span class="o">-</span><span class="n">lw_min</span><span class="p">)</span><span class="o">+</span><span class="n">lw_min</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">speed</span><span class="p">)):</span> 
                <span class="n">lw</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">speed</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>
        
        <span class="c1"># kick out nan values</span>
        <span class="n">data_u</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_s</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">data_v</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_s</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">data_s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_s</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
                
        <span class="n">plt_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;density&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">})</span>
        <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">streaml_opt</span><span class="p">)</span>
        
        <span class="c1"># here do cartopy projection inside streamplot routine </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span> <span class="n">plt_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span><span class="n">which_transf</span><span class="p">})</span>
                
        <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">,</span> 
                            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">speed2lw</span><span class="p">(</span><span class="n">data_s</span><span class="p">,</span> <span class="n">speed_min</span><span class="p">,</span> <span class="n">speed_max</span><span class="p">,</span> <span class="n">lw_min</span><span class="p">,</span> <span class="n">lw_max</span><span class="p">),</span> 
                            <span class="o">**</span><span class="n">plt_optdefault</span><span class="p">)</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># make a streamline legend</span>
        <span class="k">if</span> <span class="n">do_streaml_leg</span><span class="p">:</span>
            <span class="n">leg_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mi">75</span><span class="p">,</span> <span class="c1"># lon position of legend in deg</span>
                                   <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="c1"># lat position of legend in deg </span>
                                   <span class="s1">&#39;dy&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># vertical distance of legend labels in deg</span>
                                   <span class="s1">&#39;dw&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># width of lines in deg</span>
                                   <span class="s1">&#39;arr_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>  <span class="p">})</span>
            <span class="n">leg_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">streaml_leg_opt</span><span class="p">)</span>
            
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dw</span>   <span class="o">=</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;dw&#39;</span><span class="p">]</span>
            <span class="n">x01</span><span class="p">,</span> <span class="n">y01</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">dw</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">x02</span><span class="p">,</span> <span class="n">y02</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span>  <span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">x03</span><span class="p">,</span> <span class="n">y03</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;arr_s&#39;</span><span class="p">]):</span>
                <span class="c1"># This linewidth</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">speed2lw</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">speed_min</span><span class="p">,</span> <span class="n">speed_max</span><span class="p">,</span> <span class="n">lw_min</span><span class="p">,</span> <span class="n">lw_max</span><span class="p">)</span>

                <span class="c1"># Plot a line in the legend, of the correct length</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>   <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x01</span> <span class="p">,</span><span class="n">x02</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                
                <span class="c1"># Add a text label, after converting the lw back to a speed</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x03</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:2.2f}</span><span class="s1"> $m{{</span><span class="se">\\</span><span class="s1">cdot}}s^{{-1}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span> 
                            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="n">dy</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">del</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">,</span> <span class="n">data_s</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">elif</span> <span class="n">do_streaml</span> <span class="ow">and</span> <span class="n">streaml_dat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; --&gt; you need to provide regular gridded u,v data to plot streamlines&#39;</span><span class="p">)</span>
    
    
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>



<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_quiver_reg">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_quiver_reg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_quiver_reg</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">do_quiver</span><span class="p">,</span> <span class="n">quiver_dat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiver_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                   <span class="n">do_quiver_leg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiver_leg_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                   <span class="n">box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">which_transf</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> 
                   <span class="n">quiv_scalfac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quiv_arrwidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot streamlines over scalar data, based on regular gridded lon,lat vector </span>
<span class="sd">        data. Data can originate either from corase graining or interpolation</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>
<span class="sd">    </span>
<span class="sd">        :ii:            int, index of handle ii</span>
<span class="sd">    </span>
<span class="sd">        :do_quiver:    bool, do cartopy quiver plot</span>
<span class="sd">    </span>
<span class="sd">        :quiver_dat:   list of xr.Datasets with u,v data in it (default=None)</span>
<span class="sd">    </span>
<span class="sd">            ::</span>
<span class="sd">    </span>
<span class="sd">                Dimensions:  (lat: 85, lon: 180, n2: 2)</span>
<span class="sd">                Coordinates:</span>
<span class="sd">                * lat      (lat) float32 340B -79.0 -77.0 -75.0 -73.0 ... 83.0 85.0 87.0 89.0</span>
<span class="sd">                * lon      (lon) float32 720B -179.0 -177.0 -175.0 ... 175.0 177.0 179.0</span>
<span class="sd">                    nzi      float64 8B 15.89</span>
<span class="sd">                    nz1      int64 8B 250</span>
<span class="sd">                    lat_bnd  (lat, n2) float32 680B -80.0 -78.0 -78.0 -76.0 ... 88.0 nan nan</span>
<span class="sd">                    lon_bnd  (lon, n2) float32 1kB -180.0 -178.0 -178.0 ... 178.0 178.0 180.0</span>
<span class="sd">                    w_A      (lat, lon) float32 61kB 9.437e+09 9.437e+09 9.437e+09 ... nan nan</span>
<span class="sd">                Dimensions without coordinates: n2</span>
<span class="sd">                Data variables:</span>
<span class="sd">                    u        (lat, lon) float32 61kB -0.003229 -0.003186 -0.002711 ... nan nan</span>
<span class="sd">                    v        (lat, lon) float32 61kB 0.0007711 0.000357 0.001531 ... nan nan</span>
<span class="sd">                Attributes: (12/19)</span>
<span class="sd">                    FESOM_model:                         FESOM2</span>
<span class="sd">                    FESOM_website:                       fesom.de</span>
<span class="sd">                    FESOM_git_SHA:                       02f7d080</span>
<span class="sd">                    FESOM_MeshPath:                      /albedo/work/user/pscholz/mesh_fesom...</span>
<span class="sd">                    FESOM_mesh_representative_checksum:  297ddf9c482ca68c86a979e1bd5d3c97</span>
<span class="sd">                    FESOM_ClimateDataPath:               /albedo/work/projects/p_fesom/FROM-O...</span>
<span class="sd">                    ...                                  ...</span>
<span class="sd">                </span>
<span class="sd">        :quiver_opt:   dict, (default: dict()) additional options that are given to </span>
<span class="sd">                        quiver plot routine</span>
<span class="sd">                        </span>
<span class="sd">        :do_quiver_leg: bool, (default: False) overlay legend for quiver plot, keep in mind that the position for </span>
<span class="sd">                               legend is somewhat pre setted by hand </span>

<span class="sd">        :quiver_leg_opt: dict, (default=dict()) additional option for the position of the streamline legend</span>
<span class="sd">        </span>
<span class="sd">        :box:           None, list (default: None) regional limitation of plot. For ortho...</span>
<span class="sd">                        box=[lonc, latc], nears...box=[lonc, latc, zoom], for all others box = </span>
<span class="sd">                        [lonmin, lonmax, latmin, latmax]</span>
<span class="sd">        </span>
<span class="sd">        :which_transf:  ccrs.CRS (default=None) data starting projection usually ccrs.PlateCaree()</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:            return matplotlib handle of streamline</span>
<span class="sd">        </span>
<span class="sd">    #___________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">do_quiver</span> <span class="ow">and</span> <span class="n">quiver_dat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">quiver_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span>    <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">quiver_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span>    <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">vnm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">quiver_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
        <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">quiver_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vnm</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">quiver_dat</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">vnm</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
        <span class="c1"># limit data to regional box</span>
        <span class="k">if</span> <span class="n">box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx_x</span> <span class="p">,</span> <span class="n">idx_y</span>  <span class="o">=</span> <span class="p">(</span><span class="n">data_x</span><span class="o">&gt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_x</span><span class="o">&lt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">data_y</span><span class="o">&gt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_y</span><span class="o">&lt;=</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">idx_x</span>  <span class="p">],</span> <span class="n">data_y</span><span class="p">[</span><span class="n">idx_y</span>  <span class="p">]</span>
            <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">data_u</span><span class="p">[</span><span class="n">idx_y</span><span class="p">,:],</span> <span class="n">data_v</span><span class="p">[</span><span class="n">idx_y</span><span class="p">,:]</span>
            <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">data_u</span><span class="p">[:,</span><span class="n">idx_x</span><span class="p">],</span> <span class="n">data_v</span><span class="p">[:,</span><span class="n">idx_x</span><span class="p">]</span>
            <span class="k">del</span><span class="p">(</span><span class="n">idx_x</span><span class="p">,</span> <span class="n">idx_y</span><span class="p">)</span>
        
        <span class="c1"># vector norm --&gt; speed</span>
        <span class="n">data_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data_u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># kick out nan values</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">)</span>
        <span class="n">mask_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_s</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">data_y</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]</span>
        <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">,</span> <span class="n">data_s</span> <span class="o">=</span> <span class="n">data_u</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">data_v</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">],</span> <span class="n">data_s</span><span class="p">[</span><span class="n">mask_nan</span><span class="p">]</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="n">quiv_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span>
                            <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                            <span class="s1">&#39;minshaft&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                            <span class="s1">&#39;minlength&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">})</span>
        
        <span class="n">quiv_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">quiver_opt</span><span class="p">)</span>
        
        <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_vectors</span><span class="p">(</span><span class="n">which_transf</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">)</span>
        <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span> <span class="n">which_transf</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">,</span> 
                         <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="o">**</span><span class="n">quiv_optdefault</span><span class="p">,</span> <span class="p">)</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># make a streamline legend</span>
        <span class="k">if</span> <span class="n">do_quiver_leg</span><span class="p">:</span>
            <span class="n">leg_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="mi">75</span><span class="p">,</span> <span class="c1"># lon position of legend in deg</span>
                                   <span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span> <span class="c1"># lat position of legend in deg </span>
                                   <span class="s1">&#39;dy&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># vertical distance of legend labels in deg</span>
                                   <span class="s1">&#39;dw&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="c1"># width of lines in deg</span>
                                   <span class="s1">&#39;arr_s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>  <span class="p">})</span>
            <span class="n">leg_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">quiver_leg_opt</span><span class="p">)</span>
            
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dw</span>   <span class="o">=</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;dw&#39;</span><span class="p">]</span>
            <span class="n">x01</span><span class="p">,</span> <span class="n">y01</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">dw</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">x02</span><span class="p">,</span> <span class="n">y02</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span>  <span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">x03</span><span class="p">,</span> <span class="n">y03</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">speed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leg_optdefault</span><span class="p">[</span><span class="s1">&#39;arr_s&#39;</span><span class="p">]):</span>
                <span class="c1"># This linewidth</span>
                
                <span class="c1"># Plot a line in the legend, of the correct length</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>   <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span>   <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">transform_vectors</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">speed</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x02</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                         <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tip&#39;</span><span class="p">,</span> 
                         <span class="o">**</span><span class="n">quiv_optdefault</span><span class="p">,</span> 
                        <span class="p">)</span>
                <span class="c1"># Add a text label, after converting the lw back to a speed</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x03</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:2.2f}</span><span class="s1"> $m{{</span><span class="se">\\</span><span class="s1">cdot}}s^{{-1}}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">speed</span><span class="p">),</span> 
                            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">-</span><span class="n">dy</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">del</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span><span class="p">,</span> <span class="n">data_s</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">elif</span> <span class="n">do_quiver</span> <span class="ow">and</span> <span class="n">quiver_dat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; --&gt; you need to provide regular gridded u,v data to plot streamlines&#39;</span><span class="p">)</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>





<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_bot">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_bot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_bot</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_bot</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bot_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot bottom mask</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>

<span class="sd">        :do_bot:        bool, (default: True), overlay topographic bottom mask</span>
<span class="sd">    </span>
<span class="sd">        :tri:           matplotlib.tri triangulation object (default=None)</span>
<span class="sd">                        - tri.mask_e_ok...provide mask with nan values, that describe the bottom limited to regional box</span>

<span class="sd">        :data_x:        regular longitude array (default=None)</span>

<span class="sd">        :data_y:        regular latitude array (default=None)</span>

<span class="sd">        :data_plot:     np.array of regular gridded data (default=None)</span>

<span class="sd">        :ylim:          list, (default=None), overwrite limit of yaxis</span>

<span class="sd">        :bot_opt:       dict, (default: dict()) additional options that are given to </span>
<span class="sd">                        the bottom mask plotting via kwarg</span>
<span class="sd">    </span>
<span class="sd">    Returns: </span>
<span class="sd">    </span>
<span class="sd">        :h0:            return handle of bottom plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">ListedColormap</span>
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="c1"># plot bottom mask for cartopy plot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">do_bot</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            
            <span class="n">bot_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;facecolors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
            <span class="n">bot_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bot_opt</span><span class="p">)</span>
            
            <span class="c1"># create single color colormap when options like &#39;facecolor&#39;, &#39;facecolors&#39;, </span>
            <span class="c1"># &#39;color&#39;, &#39;colors&#39; are present</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">rmv</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">bot_optdefault</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;facecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;facecolors&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;colors&#39;</span><span class="p">]:</span>
                    <span class="n">cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">bot_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">bot_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">cmap</span><span class="p">})</span>
            
            <span class="c1"># remove facecolor string from dictionary since its doesnt exist for tripcolor</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmv</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">rmv</span><span class="p">:</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">bot_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            
            <span class="c1">#h0 = hax_ii.triplot(tri.x, tri.y, tri.triangles[e_ok_mask==False,:], **bot_optdefault)</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="o">==</span><span class="kc">False</span><span class="p">,:],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_ok</span><span class="o">==</span><span class="kc">False</span><span class="p">)),</span> <span class="o">**</span><span class="n">bot_optdefault</span><span class="p">)</span>
    
    <span class="c1"># plot bottom mask for index+depth+xy</span>
    <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="o">==</span><span class="s1">&#39;index+depth+xy&#39;</span><span class="p">:</span>
        
        <span class="n">bot_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
        <span class="n">bot_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bot_opt</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">data_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39; cant plot bottom mask for index+depth+xy without data_x and data_plot!&#39;</span><span class="p">)</span>
        
        <span class="c1"># compute bottom line based on NaN values</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">aux</span><span class="p">[</span><span class="n">aux</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">aux</span><span class="p">[</span><span class="n">aux</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[</span><span class="n">aux</span><span class="p">]</span>
        <span class="k">del</span><span class="p">(</span><span class="n">aux</span><span class="p">)</span>
        
        <span class="c1"># smooth bottom patch</span>
        <span class="c1">#filt=np.array([1,2,3,2,1]) #np.array([1,2,1])</span>
        <span class="c1">#filt=filt/np.sum(filt)</span>
        <span class="c1">#aux = np.concatenate( (np.ones((filt.size,))*bottom[0],bottom,np.ones((filt.size,))*bottom[-1] ) )</span>
        <span class="c1">#aux = np.convolve(aux,filt,mode=&#39;same&#39;)</span>
        <span class="c1">#bottom = aux[filt.size:-filt.size]</span>
        <span class="c1">#del(filt, aux)</span>
        
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">data_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">bot_optdefault</span><span class="p">)</span><span class="c1">#,alpha=0.95)</span>
    
    <span class="c1"># plot bottom mask for zmoc</span>
    <span class="k">elif</span> <span class="s1">&#39;zmoc&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">or</span> <span class="s1">&#39;dmoc+depth&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">:</span>
        <span class="n">bot_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
        <span class="n">bot_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bot_opt</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">ylim</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="n">maxbot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>
        <span class="k">else</span>        <span class="p">:</span> <span class="n">maxbot</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">data_plot</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">maxbot</span><span class="p">,</span> <span class="o">**</span><span class="n">bot_optdefault</span><span class="p">)</span><span class="c1">#,alpha=0.95)</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>

    
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_topo">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_topo">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_topo</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_topo</span><span class="p">,</span> <span class="n">data_topo</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> 
                <span class="n">plt_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                <span class="n">plt_contb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">pltcb_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                <span class="n">plt_contl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot topography contour or pcolor</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:    handle of axes ii</span>

<span class="sd">        :do_topo:   bool, (default: True), overlay model topography in quiver plots</span>

<span class="sd">        :data_topo: np.array with unstructured data of model topogrpahy </span>

<span class="sd">        :mesh:      fesom2 mesh object,  with all mesh information </span>

<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">                    - tri.mask_e_box ... bool np.array with element masking from regional box definition</span>
<span class="sd">                    - tri.mask_n_box ... bool np.array with vertices masking from regional box selection</span>
<span class="sd">    </span>
<span class="sd">        :plt_opt:   dict, (default: dict()) additional options that are given to tripcolor </span>
<span class="sd">                    or tricontourf via the kwarg argument</span>

<span class="sd">        :plt_contb: bool, (default: False) overlay thin contour lines of all colorbar steps (background)</span>

<span class="sd">        :pltcb_opt: dict, (default: dict()) background contour line option</span>

<span class="sd">        :plt_contl: bool, (default: False) label overlayed  contour linec plot</span>

<span class="sd">        :pltcl_opt: dict, (default: dict()) additional options that are given to clabel via the kwarg argument</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:        return handle of plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">do_topo</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;tpc&#39;</span><span class="p">,</span> <span class="s1">&#39;tcf&#39;</span><span class="p">]:</span>
        <span class="n">data_topo</span><span class="p">,</span> <span class="n">tri0</span>   <span class="o">=</span> <span class="n">do_data_prepare_unstruct</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">data_topo</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">6000</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">500</span><span class="p">)))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">vals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">vals</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">topocmp</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">cinfo_topo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;clevel&#39;</span><span class="p">:</span><span class="n">levels</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">topocmp</span><span class="p">})</span>
                
        <span class="n">h0</span> <span class="o">=</span> <span class="n">do_plt_data</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_topo</span><span class="p">,</span> <span class="n">tri0</span><span class="p">,</span> <span class="n">data_topo</span><span class="p">,</span> 
                         <span class="n">cinfo_topo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>    <span class="n">plt_opt</span>  <span class="o">=</span><span class="n">plt_opt</span><span class="p">,</span> 
                         <span class="n">plt_contb</span><span class="o">=</span><span class="n">plt_contb</span><span class="p">,</span> <span class="n">pltcb_opt</span><span class="o">=</span><span class="n">pltcb_opt</span><span class="p">,</span> 
                         <span class="n">plt_contf</span><span class="o">=</span><span class="kc">False</span>    <span class="p">,</span> <span class="n">pltcf_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                         <span class="n">plt_contr</span><span class="o">=</span><span class="kc">False</span>    <span class="p">,</span> <span class="n">pltcr_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                         <span class="n">plt_contl</span><span class="o">=</span><span class="n">plt_contl</span><span class="p">,</span> <span class="n">pltcl_opt</span><span class="o">=</span><span class="n">pltcl_opt</span><span class="p">)</span>
        <span class="k">del</span><span class="p">(</span><span class="n">tri0</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_mesh">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_mesh">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_mesh</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_mesh</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">mesh_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot overlaying triangular mesh</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:    handle of axes ii</span>

<span class="sd">        :do_mesh:   bool, (default: True), overlay FESOM grid over dataplot</span>
<span class="sd">    </span>
<span class="sd">        :tri:       matplotlib.tri triangulation object</span>
<span class="sd">                    - tri.mask_e_ok...provide mask with nan values, that describe the bottom limited to regional box</span>
<span class="sd">  </span>
<span class="sd">        :mesh_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the mesh plotting via kwarg</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:        return handle of plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">do_mesh</span><span class="p">:</span> 
        <span class="n">mesh_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.75</span><span class="p">})</span>
        <span class="n">mesh_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mesh_opt</span><span class="p">)</span>
        <span class="c1">#h0 = hax_ii.triplot(tri.x, tri.y, tri.triangles[e_ok_mask,:], zorder=5, **mesh_optdefault)</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">triplot</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tri</span><span class="o">.</span><span class="n">triangles</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">mesh_optdefault</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_lsmask">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_lsmask">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_lsmask</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_lsm</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">lsm_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot fesom mesh inverted land sea mask</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:        handle of axes ii</span>
<span class="sd">        </span>
<span class="sd">        :do_lsm:        str, (default: &#39;fesom&#39;), overlay FESOM grid inverted land sea mask</span>
<span class="sd">                        option are here:</span>
<span class="sd">                    </span>
<span class="sd">                        - fesom      ... grey fesom landsea mask</span>
<span class="sd">                        - stock      ... uses cartopy stock image</span>
<span class="sd">                        - bluemarble ... uses bluemarble image in folder tripyview/background/</span>
<span class="sd">                        - etopo      ... uses etopo image in folder tripyview/background/</span>

<span class="sd">        :mesh:          fesom2 mesh object,  with all mesh information </span>
<span class="sd">        </span>
<span class="sd">        :lsm_opt:       dict, (default: dict()) additional options that are given to </span>
<span class="sd">                        the landsea mask plotting via kwarg</span>
<span class="sd">                    </span>
<span class="sd">        :resolution:    str, (default: &#39;low&#39;) switch resolution of background image </span>
<span class="sd">                        for bluemarble and etopo between &#39;high&#39; and &#39;low&#39;</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:            return handle of plot</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s2">&quot;cartopy&quot;</span><span class="p">)</span>
    
    <span class="n">lsm_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    <span class="n">lsm_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lsm_opt</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">if</span> <span class="n">do_lsm</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bluemarble&#39;</span><span class="p">,</span> <span class="s1">&#39;etopo&#39;</span><span class="p">]:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">tripyview</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tpv</span>
        <span class="n">bckgrndir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tpv</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;backgrounds/&#39;</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># add mesh land-sea mask</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span>   <span class="n">do_lsm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">do_lsm</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> 
        <span class="k">return</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">do_lsm</span><span class="o">==</span><span class="s1">&#39;fesom&#39;</span><span class="p">:</span>
        <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lsmask_p</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">lsm_optdefault</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">do_lsm</span><span class="o">==</span><span class="s1">&#39;stock&#39;</span><span class="p">:</span>  
        <span class="n">h01</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
        <span class="n">lsm_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">})</span>
        <span class="n">h02</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lsmask_p</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">lsm_optdefault</span><span class="p">)</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="p">[</span><span class="n">h01</span><span class="p">,</span><span class="n">h02</span><span class="p">]</span>    
        
    <span class="k">elif</span> <span class="n">do_lsm</span><span class="o">==</span><span class="s1">&#39;bluemarble&#39;</span><span class="p">:</span> 
        <span class="c1"># --&gt; see original idea at http://earthpy.org/cartopy_backgroung.html#disqus_thread and </span>
        <span class="c1"># https://stackoverflow.com/questions/67508054/improve-resolution-of-cartopy-map</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CARTOPY_USER_BACKGROUNDS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bckgrndir</span>
        <span class="n">h01</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">background_img</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">do_lsm</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
        <span class="n">lsm_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">})</span>
        <span class="n">h02</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lsmask_p</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">lsm_optdefault</span><span class="p">)</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="p">[</span><span class="n">h01</span><span class="p">,</span><span class="n">h02</span><span class="p">]</span>  
        
    <span class="k">elif</span> <span class="n">do_lsm</span><span class="o">==</span><span class="s1">&#39;etopo&#39;</span><span class="p">:</span>   
        <span class="c1"># --&gt; see original idea at http://earthpy.org/cartopy_backgroung.html#disqus_thread and </span>
        <span class="c1"># https://stackoverflow.com/questions/67508054/improve-resolution-of-cartopy-map</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CARTOPY_USER_BACKGROUNDS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bckgrndir</span>
        <span class="n">h01</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">background_img</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">do_lsm</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>    
        <span class="n">lsm_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">})</span>
        <span class="n">h02</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lsmask_p</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">lsm_optdefault</span><span class="p">)</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="p">[</span><span class="n">h01</span><span class="p">,</span><span class="n">h02</span><span class="p">]</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot; &gt; the do_lsm=</span><span class="si">{}</span><span class="s2"> is not supported, must be either &#39;fesom&#39;, &#39;stock&#39;, &#39;bluemarble&#39; or &#39;etopo&#39;! &quot;</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_plt_gridlines">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_plt_gridlines">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_plt_gridlines</span><span class="p">(</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">do_grid</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">ndat</span><span class="p">,</span> 
                     <span class="n">data_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> 
                     <span class="n">proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_rescale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do plot cartopy gridline and general gridlines together with the limit</span>
<span class="sd">        scaling of the axis (see non-linear option of x and y axis)</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hax_ii:    handle of one axes</span>
<span class="sd">        </span>
<span class="sd">        :do_grid:   bool, (default: True) plot cartopy grid lines</span>
<span class="sd">        </span>
<span class="sd">        :box:       None, or list with box definitions </span>
<span class="sd">    </span>
<span class="sd">        :ndat:      int, total length of data list</span>
<span class="sd">        </span>
<span class="sd">        :data_x:    regular longitude array</span>
<span class="sd">        </span>
<span class="sd">        :data_y:    regular latitude array</span>
<span class="sd">    </span>
<span class="sd">        :xlim:      list, (default=None), overwrite limit of xaxis</span>

<span class="sd">        :ylim:      list, (default=None), overwrite limit of yaxis</span>

<span class="sd">        :grid_opt:  dict, (default: dict()) additional options that are given to </span>
<span class="sd">                    the cartopy gridline plotting via kwarg</span>
<span class="sd">                    </span>
<span class="sd">        :proj:      None, cartopy projection object or string (e.g. index+depth+time...)</span>
<span class="sd">        </span>
<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :h0:        None or handle</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">h0</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">do_grid</span><span class="p">:</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="n">proj</span><span class="o">==</span><span class="s1">&#39;channel&#39;</span><span class="p">:</span>
            <span class="n">grid_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;draw_labels&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
            <span class="n">grid_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid_opt</span><span class="p">)</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="o">**</span><span class="n">grid_optdefault</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> <span class="n">h0</span><span class="o">.</span><span class="n">left_labels</span>   <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> <span class="n">h0</span><span class="o">.</span><span class="n">bottom_labels</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">CRS</span><span class="p">):</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">grid_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;draw_labels&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
            <span class="n">grid_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid_opt</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">h0</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="o">**</span><span class="n">grid_optdefault</span> <span class="p">)</span>
            
            <span class="c1"># ensure circular boundary for stereographic projection</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">)</span> <span class="p">):</span>
                <span class="c1"># give stereographic plot a circular boundary</span>
                <span class="n">theta</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                <span class="n">center</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="mf">0.5</span>
                <span class="n">verts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
                <span class="n">circle</span> <span class="o">=</span> <span class="n">mpath</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">verts</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">center</span><span class="p">)</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_boundary</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
                <span class="k">del</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">verts</span><span class="p">,</span> <span class="n">circle</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">)):</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
            
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EqualEarth</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">359</span> <span class="ow">and</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">179</span> <span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">)</span> <span class="p">):</span>
                <span class="c1">#if hax_ii.do_ylabel: h0.ylabels_left   = True</span>
                <span class="c1">#if hax_ii.do_xlabel: h0.xlabels_bottom = True</span>
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> <span class="n">h0</span><span class="o">.</span><span class="n">left_labels</span>   <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_xlabel</span><span class="p">:</span> <span class="n">h0</span><span class="o">.</span><span class="n">bottom_labels</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># rotate xlabel for PlateCarree so that they dont overlay with </span>
            <span class="c1"># neighboring plots</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">)</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">ndat</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">ncol</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">h0</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}</span>    
                
            <span class="n">h0</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_ticks</span><span class="p">}</span>       
            <span class="n">h0</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">fs_ticks</span><span class="p">}</span> 
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># grid options for index vs. depth vs. xy plot</span>
        <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;index+depth+xy&#39;</span><span class="p">,</span> <span class="s1">&#39;index+depth+time&#39;</span><span class="p">,</span> 
                                   <span class="s1">&#39;index+depth&#39;</span><span class="p">,</span> <span class="s1">&#39;index+time&#39;</span><span class="p">,</span> <span class="s1">&#39;index+xy&#39;</span><span class="p">,</span> 
                                   <span class="s1">&#39;zmoc&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+dens&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+depth&#39;</span><span class="p">]:</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">grid_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span>
            <span class="n">grid_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grid_opt</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># default do_yexp, do_ysig settings</span>
            <span class="n">do_yexp</span>         <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># do nonlinear/ exponential depth sscaling for vertical plots</span>
            <span class="n">yexp_majorticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">6000</span><span class="p">])</span>
            <span class="n">yexp_fac</span>        <span class="o">=</span> <span class="mf">2.0</span>
            
            <span class="n">do_ysig</span>         <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># do nonlinear sigma sscaling for dmoc plot</span>
            <span class="n">ysig_majorticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">30.00</span><span class="p">,</span> <span class="mf">36.00</span><span class="p">,</span> <span class="mf">36.65</span><span class="p">,</span> <span class="mf">36.92</span><span class="p">,</span> <span class="mf">37.05</span><span class="p">])</span>
            <span class="n">ysig_minorticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> 
                                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">30.00</span><span class="p">,</span> <span class="mf">35.99</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">36.00</span><span class="p">,</span> <span class="mf">36.64</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span><span class="c1"># 0.15</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">36.65</span><span class="p">,</span> <span class="mf">36.91</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">36.92</span><span class="p">,</span> <span class="mf">37.04</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">37.05</span><span class="p">,</span> <span class="mf">38.50</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="mf">40.00</span><span class="p">])))</span>
            
            <span class="n">do_yinv</span>         <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># invert y-axis</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># check if do_yscaling (do_yexp, do_ysig) related string exists in </span>
            <span class="c1"># grid_opt dictionary</span>
            <span class="n">rmv</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">grid_optdefault</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;do_yexp&#39;</span><span class="p">,</span> <span class="s1">&#39;yexp&#39;</span><span class="p">,</span> <span class="s1">&#39;do_yexponential&#39;</span><span class="p">,</span> <span class="s1">&#39;yexponential&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="c1"># for MOC keep depth axes linear</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;zmoc&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;dmoc&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="p">:</span> <span class="n">do_yexp</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yexp_majorticks&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">yexp_majorticks</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yexp_fac&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">yexp_fac</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>       
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;do_yinv&#39;</span><span class="p">,</span> <span class="s1">&#39;yinv&#39;</span><span class="p">,</span> <span class="s1">&#39;do_yinvert&#39;</span><span class="p">,</span> <span class="s1">&#39;yinvert&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="c1"># for MOC keep depth axes linear</span>
                    <span class="n">do_yinv</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>    
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;do_ysig&#39;</span><span class="p">,</span> <span class="s1">&#39;ysig&#39;</span><span class="p">,</span> <span class="s1">&#39;ysigma&#39;</span><span class="p">,</span> <span class="s1">&#39;do_ysigma&#39;</span><span class="p">]</span> <span class="p">:</span>    
                    <span class="k">if</span> <span class="s1">&#39;dmoc+dens&#39;</span> <span class="ow">in</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="p">:</span> <span class="n">do_ysig</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> 
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ysig_majorticks&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">yexp_majorticks</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> 
                <span class="k">elif</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ysig_minorticks&#39;</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">ysig_minorticks</span> <span class="o">=</span> <span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rmv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>     
            
            <span class="c1"># remove do_ylog, do_yinv, do_ysig string from dictionary since its </span>
            <span class="c1"># doesnt exist for tripcolor</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmv</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">rmv</span><span class="p">:</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">grid_optdefault</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># do exponential depth axis scaling</span>
            <span class="k">if</span> <span class="n">do_yexp</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dmoc+dens&#39;</span><span class="p">]:</span> 
                <span class="c1"># Define your custom transformation function</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">forward_yexp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="k">def</span><span class="w"> </span><span class="nf">inverse_yexp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">forward_yexp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yexp_fac</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_yexp</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yexp_fac</span><span class="p">))</span> <span class="p">)</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yexp_majorticks</span><span class="p">)</span>
                         
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># do nonlinear sigma2 scaling for dmoc in density space</span>
            <span class="k">elif</span> <span class="n">do_ysig</span> <span class="ow">and</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dmoc+dens&#39;</span><span class="p">]:</span>
                <span class="c1"># Define your custom transformation function</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">forward_ysig</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dens2reg</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reg</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                    <span class="n">y1</span>       <span class="o">=</span> <span class="n">dens2reg</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                    <span class="n">y1</span><span class="p">[</span><span class="n">y1</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">y1</span><span class="p">[</span><span class="n">y1</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">reg</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">y1</span>
                
                <span class="k">def</span><span class="w"> </span><span class="nf">inverse_ysig</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">reg2dens</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                    <span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">y</span><span class="p">[</span><span class="n">y</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">reg</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
                    <span class="n">y1</span>       <span class="o">=</span> <span class="n">reg2dens</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">y1</span> 
                
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">forward_ysig</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ysig_minorticks</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">inverse_ysig</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ysig_minorticks</span><span class="p">))</span> <span class="p">)</span>
                
                <span class="c1"># do custom sigma y-labels</span>
                <span class="c1"># do major ticklabels in larger font</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span> <span class="n">ysig_majorticks</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span> 
                <span class="n">ylabelmayjor_list_fmt</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">ysig_majorticks</span><span class="p">:</span> <span class="n">ylabelmayjor_list_fmt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylabelmayjor_list_fmt</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    
                <span class="c1"># do minor ticklabels in small font</span>
                <span class="n">yminorticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">ysig_minorticks</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ysig_majorticks</span><span class="p">)</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yminorticks</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span>  <span class="p">)</span>
                <span class="n">ylabelminor_list_fmt</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">yminorticks</span><span class="p">:</span> <span class="n">ylabelminor_list_fmt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:2.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ylabelminor_list_fmt</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">do_ylabel</span><span class="p">:</span> <span class="c1"># bugfix in case of shared yaxes</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># rescale x-axhes in case of vline index+depth plot</span>
            <span class="k">if</span>   <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;index+depth&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> 
                <span class="k">if</span>   <span class="n">do_rescale</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log10&#39;</span> <span class="p">,</span> <span class="s1">&#39;slog10&#39;</span><span class="p">]:</span> 
                    <span class="k">if</span>   <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;log10&#39;</span> <span class="p">:</span> 
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="p">),</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
                        <span class="n">xtlabels</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_tick_space</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
                                    <span class="n">xtlabels</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span> 
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">SymmetricalLogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">))</span>
                        <span class="n">xtlabels</span> <span class="o">=</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_tick_space</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
                                    <span class="n">xtlabels</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xtlabels</span><span class="p">)</span>
                        <span class="n">hax_ii</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">SymmetricalLogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
                
            <span class="k">else</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
               
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># set x/y limits</span>
            <span class="k">if</span> <span class="n">data_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">data_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">data_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_y</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_y</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">do_yexp</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
                <span class="c1"># bug fix for invert y-axis when doing moc </span>
                <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zmoc&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+depth&#39;</span><span class="p">]:</span> 
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.025</span>  <span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.025</span><span class="p">)</span>
            
            <span class="k">if</span>   <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">,</span><span class="n">xlim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">xlim</span> <span class="ow">is</span>     <span class="kc">None</span> <span class="ow">and</span> <span class="n">data_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">if</span>   <span class="n">data_x</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">data_x</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># invert y-axis</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span>   <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;index+depth+xy&#39;</span><span class="p">,</span> <span class="s1">&#39;index+depth+time&#39;</span><span class="p">,</span> <span class="s1">&#39;index+depth&#39;</span><span class="p">]:</span> 
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
                
                <span class="k">elif</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">projection</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zmoc&#39;</span><span class="p">,</span> <span class="s1">&#39;dmoc+depth&#39;</span><span class="p">]:</span>    
                    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="p">,</span><span class="n">ylim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">hax_ii</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">do_yinv</span><span class="p">:</span> <span class="n">hax_ii</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># set grid options </span>
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ScalarFormatter</span><span class="p">())</span>
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>
            <span class="n">hax_ii</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">grid_optdefault</span><span class="p">)</span>
            
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">h0</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_cbar">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_cbar">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_cbar</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">hax_ii</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">cb_label</span><span class="p">,</span> <span class="n">cb_lunit</span><span class="p">,</span> <span class="n">cb_ltime</span><span class="p">,</span> <span class="n">cb_ldep</span><span class="p">,</span>
            <span class="n">box_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cb_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">cbl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; plot colorbars (tripyview allows also to have more than one colorbar within the </span>
<span class="sd">        multipanel plot)</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    </span>
<span class="sd">        :hcb_ii:    actual colorbar handle </span>

<span class="sd">        :hax_ii:    actual axes handle </span>

<span class="sd">        :hp:        actual plot handle </span>

<span class="sd">        :data:      xarray dataset object with all attributes (needed for the default colorbar labels)</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>


<span class="sd">        :cb_label:  str, (default: None) if string its used as colorbar label, otherwise </span>
<span class="sd">                    information from data (&#39;long_name, short_name) are used</span>

<span class="sd">        :cb_lunit:  str, (default: None) if string its used as colorbar unit label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ltime:  str, (default: None) if string its used as colorbar time label, </span>
<span class="sd">                    otherwise info from data are used</span>

<span class="sd">        :cb_ldep:   str, (default: None) if string its used as colorbar depth label, </span>
<span class="sd">                    otherwise info from data are used                </span>

<span class="sd">        :box_idx:   None or index of box selection in data_ii[box_idx]</span>
<span class="sd">        </span>
<span class="sd">        :norm:      None or renormation object</span>
<span class="sd">        </span>
<span class="sd">        :cb_opt:    dict, (default: dict()) direct option for colorbar via kwarg</span>

<span class="sd">        :cbl_opt:   dict, (default: dict()) direct option for colorbar labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :hcb_ii:    actual colorbar handle </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="n">which_orient</span> <span class="o">=</span> <span class="n">hcb_ii</span><span class="o">.</span><span class="n">do_orient</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">cb_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;extendrect&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;extendfrac&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;drawedges&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
    <span class="n">cb_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cb_opt</span><span class="p">)</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="o">=</span><span class="n">hp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">hax_ii</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">which_orient</span><span class="p">,</span>
                          <span class="n">ticks</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="n">boundaries</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="c1">#norm=norm, </span>
                          <span class="o">**</span><span class="n">cb_optdefault</span><span class="p">)</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># do formating of colorbar tick labels</span>
    <span class="n">hcb_ii</span> <span class="o">=</span> <span class="n">do_cbar_formatting</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">,</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="n">cbtl_opt</span><span class="p">)</span>
            
    <span class="c1">#___________________________________________________________________________</span>
    <span class="n">loc_attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">box_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vname</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>        
        <span class="n">loc_attrs</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">vname</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>        
        <span class="n">loc_attrs</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>
            
    <span class="k">if</span> <span class="n">cb_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cb_label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span>  <span class="s1">&#39;long_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span>
            <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;short_name&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span>
            <span class="n">c_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;short_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">cb_lunit</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>                <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">cb_lunit</span>
            
        <span class="k">if</span> <span class="s1">&#39;str_ltim&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;str_ltim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;str_ldep&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;str_ldep&#39;</span><span class="p">]</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cb_lunit</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>                 <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="n">cb_lunit</span>
        <span class="k">if</span> <span class="n">cb_ltime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;str_ltim&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;str_ltim&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">cb_ltime</span>
        <span class="k">if</span> <span class="n">cb_ldep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    
            <span class="k">if</span> <span class="s1">&#39;str_ldep&#39;</span> <span class="ow">in</span> <span class="n">loc_attrs</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="n">loc_attrs</span><span class="p">[</span><span class="s1">&#39;str_ldep&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">cb_label</span> <span class="o">=</span> <span class="n">cb_label</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">cb_ldep</span>
        
    <span class="k">if</span>   <span class="n">which_orient</span><span class="o">==</span><span class="s1">&#39;vertical&#39;</span>  <span class="p">:</span> <span class="n">fsize</span> <span class="o">=</span>  <span class="n">hcb_ii</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fontsize</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">which_orient</span><span class="o">==</span><span class="s1">&#39;horizontal&#39;</span><span class="p">:</span> <span class="n">fsize</span> <span class="o">=</span>  <span class="n">hcb_ii</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_fontsize</span><span class="p">()</span>
    
    <span class="n">cbl_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="n">fsize</span><span class="p">})</span>
    <span class="n">cbl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbl_opt</span><span class="p">)</span>
    
    <span class="c1">## wrap xlabel string when they are to long</span>
    <span class="c1">## Estimate the width of the axes dynamically</span>
    <span class="c1">#axes_width_px = hcb_ii.ax.get_position().height * hax_ii.fig_height * hax_ii.fig_dpi</span>
    
    <span class="c1">## Estimate the width of the axes in terms of characters</span>
    <span class="c1">## font_size = plt.rcParams[&#39;font.size&#39;]</span>
    <span class="c1">#font_size = hcb_ii.ax.yaxis.get_label().get_size()</span>
    <span class="c1">#max_chars_per_line = int(axes_width_px / (font_size))  # Empirical factor for font size to character width ratio</span>
    <span class="c1">#cb_label = &#39;\n&#39;.join(textwrap.wrap(cb_label, width=max_chars_per_line))</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># change fontsize of colorbar label</span>
    <span class="n">hcb_ii</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cb_label</span><span class="p">,</span> <span class="o">**</span><span class="n">cbl_optdefault</span><span class="p">)</span>
    
    <span class="c1"># change fontsize of scientific noation string x10^7 at the top of the colorbar</span>
    <span class="n">offset_text</span> <span class="o">=</span> <span class="n">hcb_ii</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_offset_text</span><span class="p">()</span>
    <span class="n">offset_text</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">cbl_optdefault</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">hcb_ii</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1"># </span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_cbar_formatting">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_cbar_formatting">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_cbar_formatting</span><span class="p">(</span><span class="n">cbar</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">,</span> <span class="n">pw_lim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">cbtl_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; do formating of colorbar for logarithmic data and exponential data</span>

<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :cbar:      actual colorbar handle  </span>
<span class="sd">    </span>
<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>

<span class="sd">        :cinfo:     dict(), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :pw_lim:    list, in which decimal limits matplot will rescale the colorbar with 10^x</span>

<span class="sd">        :cbtl_opt:  dict, (default: dict()) direct option for colorbar tick labels (fontsize, fontweight, ...) via kwarg</span>

<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :cbar:      actual colorbar handle  </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">48</span><span class="p">:</span> <span class="n">cbar</span><span class="o">.</span><span class="n">dividers</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
    
    <span class="n">cbtl_optdefault</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">cbtl_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cbtl_opt</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">cbtl_optdefault</span><span class="p">)</span>
    
    <span class="c1"># formating for log and symlog colorbar axis   </span>
    <span class="c1"># do_rescale == &#39;log10&#39;, do_rescale == &#39;slog10&#39;:</span>
    <span class="k">if</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1">#cbar.set_ticks(cinfo[&#39;clevel&#39;][np.mod(np.log10(np.abs(cinfo[&#39;clevel&#39;])),1)==0.0])</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        
        <span class="c1">#cbar.ax.yaxis.set_major_locator(cinfo[&#39;clevel&#39;][np.mod(np.log10(np.abs(cinfo[&#39;clevel&#39;])),1)==0.0])</span>
        <span class="c1">#cbar.ax.yaxis.set_major_locator(mticker.SymmetricalLogLocator(cinfo[&#39;clevel&#39;][np.mod(np.log10(np.abs(cinfo[&#39;clevel&#39;])),1)==0.0])), </span>
                                                                      <span class="c1">#base=10))</span>
        <span class="k">if</span> <span class="n">cbar</span><span class="o">.</span><span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">LogFormatterSciNotation</span><span class="p">())</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_offset_text</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cbar</span><span class="o">.</span><span class="n">orientation</span><span class="o">==</span><span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">LogFormatterSciNotation</span><span class="p">())</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_offset_text</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="c1">#cbar.update_ticks()</span>
    
    <span class="c1"># do_rescale = np.array(...), do_rescale = None, do_rescale = False:</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="c1"># set new cticks based on clab</span>
        <span class="k">if</span> <span class="s1">&#39;clab&#39;</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>    
            <span class="n">carr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">])</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">locator</span>  <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span> <span class="n">nbins</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnlab&#39;</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>    
            <span class="n">carr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">])</span>
        
        <span class="c1"># when do_rescale=np.ndarray(...), nonlinear colorbar </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Subclass ScalarFormatter:</span>
            <span class="c1"># Overriding _set_format ensures that the main tick labels use scientific </span>
            <span class="c1"># notation with your specified precision. The self.format string </span>
            <span class="c1"># controls the label precision.</span>
            <span class="k">class</span><span class="w"> </span><span class="nc">PreciseScalarFormatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">):</span>
                <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>  <span class="c1"># Desired precision</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">_set_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="c1"># Override internal method to control label precision</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;%2.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="si">}</span><span class="s2">f&quot;</span>  <span class="c1"># Scientific notation with specified decimals</span>
            
            <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">carr</span><span class="p">[</span><span class="n">carr</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">carr</span><span class="p">[</span><span class="n">carr</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">]</span>
            <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cmax</span><span class="p">)</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cmax</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cmin</span><span class="p">)</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">precision</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
            
            <span class="n">formatter</span>     <span class="o">=</span> <span class="n">PreciseScalarFormatter</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">useOffset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useMathText</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useLocale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatter</span>     <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">(</span><span class="n">useOffset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useMathText</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">useLocale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># do scientific notation: 10^6</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">set_scientific</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># set powerlimits at which point scientifc notation should kick in </span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="n">pw_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pw_lim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
       
        <span class="n">cbar</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>
        
        <span class="c1">#cbar.ax.yaxis.get_offset_text().set(size=fontsize, horizontalalignment=&#39;center&#39;)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_offset_text</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        
        <span class="n">cbar</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cbar</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># ___DO COLORMAP INFO__________________________________________________________</span>
<div class="viewcode-block" id="do_setupcinfo">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_setupcinfo">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_setupcinfo</span><span class="p">(</span><span class="n">cinfo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">do_rescale</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_vec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                  <span class="n">do_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_moc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_dmoc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_hbstf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">box_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; build up colormap dictionary  </span>

<span class="sd">    Parameters:</span>
<span class="sd">        </span>
<span class="sd">        :cinfo:     dict(), dictionary with colorbar information. </span>
<span class="sd">                    Information that are given are used, others are computed. cinfo dictionary </span>
<span class="sd">                    entries can be,</span>
<span class="sd">                    </span>
<span class="sd">                    - cinfo[&#39;cmin&#39;], cinfo[&#39;cmax&#39;], cinfo[&#39;cref&#39;] ... scalar min, max, reference value</span>
<span class="sd">                    - cinfo[&#39;crange&#39;] ... list with [cmin, cmax, cref] overrides scalar values </span>
<span class="sd">                    - cinfo[&#39;cnum&#39;]   ... minimum number of colors</span>
<span class="sd">                    - cinfo[&#39;cstr&#39;]   ... name of colormap see in sub_colormap_c2c.py</span>
<span class="sd">                    - cinfo[&#39;cmap&#39;]   ... colormap object (&#39;wbgyr&#39;, &#39;blue2red, &#39;jet&#39; ...)</span>
<span class="sd">                    - cinfo[&#39;clevel&#39;] ... color level array</span>

<span class="sd">        :data:      xarray dataset object                                      </span>

<span class="sd">        :do_rescale: bool, str, np.array (defaul: False) do scaling of colorbar</span>
<span class="sd">                    - False      ... scale data automatically scientifically by 10^x, for data data larger 10^3 and smaller 10^-3</span>
<span class="sd">                    - log10      ... do logaritmic scaling</span>
<span class="sd">                    - slog10     ... do symetric logarithmic scaling</span>
<span class="sd">                    - np.array() ... scale colorbar stepwise according to values in np.array allows also for non-linear colortick steps</span>


<span class="sd">        :mesh:      None or fesom2 mesh object,                                        </span>

<span class="sd">        :tri:       None or matplotlib.tri triangulation object</span>

<span class="sd">        :do_vec:    bool (default: False) flag,input data are vector data</span>

<span class="sd">        :do_index:  bool (default: False) flag,input data are index data</span>

<span class="sd">        :do_moc:    bool (default: False) flag,input data are zmoc data</span>

<span class="sd">        :do_dmoc:   str  (default: None ) str, input data are dmoc data </span>
<span class="sd">                    (&#39;inner&#39;, &#39;dmoc&#39;, &#39;srf&#39;)</span>
<span class="sd">                    </span>
<span class="sd">        :do_hbstf:  bool (default: False)</span>

<span class="sd">        :box_idx:   in case input data are list of regional shapefile boxes, </span>
<span class="sd">                    this is the index of a specific box</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar info</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># set up color info </span>
    <span class="k">if</span> <span class="n">cinfo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
    <span class="k">else</span>            <span class="p">:</span> <span class="n">cinfo</span><span class="o">=</span><span class="n">cinfo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">do_cweights</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># check if dictionary keys exist, if they do not exist fill them up </span>
    <span class="n">cfac</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="s1">&#39;cfac&#39;</span>       <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cfac</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cfac&#39;</span> <span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;chist&#39;</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s1">&#39;ctresh&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;ctresh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.995</span>
    <span class="k">if</span> <span class="s1">&#39;cnlab&#39;</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnlab&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">if</span> <span class="s1">&#39;cnum&#39;</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">if</span> <span class="s1">&#39;cstr&#39;</span>   <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;wbgyr&#39;</span>
    
    <span class="c1">#___________________________________________________________________________    </span>
    <span class="c1">#  estimate cmin, cmax, cref and crange value if not already predefined </span>
    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;cmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;cmax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;crange&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># loop over all the input data --&gt; find out total cmin/cmax value</span>
        <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">for</span> <span class="n">data_ii</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_ii</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">if</span> <span class="n">do_index</span><span class="p">:</span> <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">else</span>       <span class="p">:</span> <span class="n">vname</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># --&gt; consider scalar data</span>
                <span class="k">if</span> <span class="n">do_vec</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span>   <span class="n">do_index</span><span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="n">box_idx</span><span class="p">][</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">do_moc</span>  <span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;zmoc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">nz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="n">do_dmoc</span> <span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="c1">#elif do_dmoc is not None  : </span>
                        <span class="c1">#if   do_dmoc==&#39;dmoc&#39;  : data_plot = data_ii[&#39;dmoc&#39;].data.copy()</span>
                        <span class="c1">#elif do_dmoc==&#39;srf&#39;   : data_plot = -(data_ii[&#39;dmoc_fh&#39;].data.copy()+data_ii[&#39;dmoc_fw&#39;].data.copy()+data_ii[&#39;dmoc_fr&#39;].data.copy())</span>
                        <span class="c1">#elif do_dmoc==&#39;inner&#39; : data_plot = data_ii[&#39;dmoc&#39;].data.copy() + \</span>
                                                            <span class="c1">#(data_ii[&#39;dmoc_fh&#39;].data.copy()+data_ii[&#39;dmoc_fw&#39;].data.copy()+data_ii[&#39;dmoc_fr&#39;].data.copy())</span>
                    <span class="k">elif</span> <span class="n">do_hbstf</span><span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
                    <span class="k">else</span>         <span class="p">:</span> 
                        <span class="n">data_plot</span>   <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;w_A&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_ii</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
                            <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;w_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
                <span class="c1">#_______________________________________________________________</span>
                <span class="c1"># --&gt; consider vector norm data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># compute norm when vector data</span>
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data_ii</span><span class="p">[</span> <span class="n">vname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">data_ii</span><span class="p">[</span> <span class="n">vname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span><span class="p">]:</span> <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">data_ii</span><span class="p">[</span><span class="s1">&#39;w_A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            
            <span class="c1">#___________________________________________________________________    </span>
            <span class="c1"># for logarythmic rescaling cmin or cmax can not be zero</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;log10&#39;</span> <span class="ow">or</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span> 
                    <span class="n">data_plot</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">data_plot</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">1e-15</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># Consider regular griddet data or index data</span>
            <span class="k">if</span> <span class="n">tri</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">do_index</span><span class="p">:</span>
                <span class="c1">#cmin = np.min([cmin,np.nanmin(data_plot) ])</span>
                <span class="c1">#cmax = np.max([cmax,np.nanmax(data_plot) ])</span>
                <span class="c1">#print(&#39;cmin, cmax = &#39;, cmin, cmax)</span>
                <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span><span class="p">]:</span>
                    <span class="n">auxcmin</span><span class="p">,</span><span class="n">auxcmax</span> <span class="o">=</span> <span class="n">do_climit_hist</span><span class="p">(</span><span class="n">data_plot</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">ctresh</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;ctresh&#39;</span><span class="p">],</span> <span class="n">cweights</span><span class="o">=</span><span class="n">do_cweights</span><span class="p">)</span>
                    <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">cmin</span><span class="p">,</span><span class="n">auxcmin</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">cmax</span><span class="p">,</span><span class="n">auxcmax</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; histo: cmin, cmax = &#39;</span><span class="p">,</span> <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">cmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">cmin</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span> <span class="p">])</span>
                    <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">cmax</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span> <span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cmin, cmax = &#39;</span><span class="p">,</span> <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># Consider unstructured griddet data --&gt; tri is not None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># data_plot is on vertices --&gt; add augmentation arrays --&gt; now </span>
                <span class="c1"># size mesh.n2dna</span>
                <span class="k">if</span>   <span class="n">data_plot</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2dn</span><span class="p">:</span> 
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span><span class="p">]</span>
                    
                <span class="c1"># data_plot is on elements --&gt; add augmentation arrays --&gt; now </span>
                <span class="c1"># size mesh.n2dea</span>
                <span class="k">elif</span> <span class="n">data_plot</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2de</span><span class="p">:</span> 
                    <span class="n">data_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_0</span><span class="p">],</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_a</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span> <span class="n">data_plot</span> <span class="o">=</span> <span class="n">data_plot</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="p">]</span>
                    
                <span class="c1"># compute min/max value range by histogram, computation of cumulativ </span>
                <span class="c1"># distribution function at certain cutoff treshold allow to kick out </span>
                <span class="c1"># outlier values from the cmin/cmax value range</span>
                <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">do_cweights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                        <span class="k">if</span>   <span class="n">do_cweights</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2dn</span><span class="p">:</span> 
                            <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">do_cweights</span><span class="p">,</span> <span class="n">do_cweights</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">n_pbnd_a</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">do_cweights</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_n_box</span><span class="p">]</span>
                            
                        <span class="k">elif</span> <span class="n">do_cweights</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">mesh</span><span class="o">.</span><span class="n">n2de</span><span class="p">:</span> 
                            <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">do_cweights</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_0</span><span class="p">],</span> <span class="n">do_cweights</span><span class="p">[</span><span class="n">mesh</span><span class="o">.</span><span class="n">e_pbnd_a</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span> <span class="n">do_cweights</span> <span class="o">=</span> <span class="n">do_cweights</span><span class="p">[</span><span class="n">tri</span><span class="o">.</span><span class="n">mask_e_box</span><span class="p">]</span>
                    
                    <span class="n">histcmin</span><span class="p">,</span><span class="n">histcmax</span> <span class="o">=</span> <span class="n">do_climit_hist</span><span class="p">(</span><span class="n">data_plot</span><span class="p">,</span> <span class="n">ctresh</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;ctresh&#39;</span><span class="p">],</span> <span class="n">cweights</span><span class="o">=</span><span class="n">do_cweights</span><span class="p">)</span>                    
                    <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">cmin</span><span class="p">,</span><span class="n">histcmin</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">cmax</span><span class="p">,</span><span class="n">histcmax</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; cmin/cmax: norm: </span><span class="si">{:f}</span><span class="s1">/</span><span class="si">{:f}</span><span class="s1">, hist: </span><span class="si">{:f}</span><span class="s1">/</span><span class="si">{:f}</span><span class="s1">, fin: </span><span class="si">{:f}</span><span class="s1">/</span><span class="si">{:f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_plot</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_plot</span><span class="p">),</span> <span class="n">histcmin</span><span class="p">,</span> <span class="n">histcmax</span><span class="p">,</span> <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">))</span>
                
                <span class="c1"># just take global or box reduced local cmin and cmax</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span> <span class="n">cmin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span> <span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span> <span class="n">cmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data_plot</span><span class="p">)</span> <span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--&gt; cmin/cmax: fin: </span><span class="si">{:f}</span><span class="s1">/</span><span class="si">{:f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmin</span><span class="p">,</span><span class="n">cmax</span><span class="p">))</span>
                    
            <span class="c1"># increase/decrease cmin/cmax limit by pre-defined factor </span>
            <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span> <span class="o">=</span> <span class="n">cmin</span><span class="o">*</span><span class="n">cfac</span><span class="p">,</span> <span class="n">cmax</span><span class="o">*</span><span class="n">cfac</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="k">if</span> <span class="s1">&#39;climit&#39;</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
           <span class="n">cmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">cmin</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;climit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
           <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">cmax</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;climit&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># dezimal rounding of cmin and cmax</span>
        <span class="c1"># if not do_rescale==&#39;log10&#39; and not do_rescale==&#39;slog10&#39;:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">cdmin</span><span class="p">,</span> <span class="n">cdmax</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmin</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">cdmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmin</span><span class="p">),</span><span class="mi">1</span><span class="p">))))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmax</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">cdmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cmax</span><span class="p">),</span><span class="mi">1</span><span class="p">))))</span>
            <span class="n">cdez</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">cdmin</span><span class="p">,</span><span class="n">cdmax</span><span class="p">])</span>
            <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">cmin</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">cdez</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">cmax</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">cdez</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># write cmin/cmax too cinfo dictionary</span>
        <span class="k">if</span> <span class="s1">&#39;cmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmin</span>
        <span class="k">if</span> <span class="s1">&#39;cmax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmax</span>  
        
    <span class="c1">#___________________________________________________________________________  </span>
    <span class="c1"># crange (cmin,cmax,cref) is predefined through cinfo dictionary </span>
    <span class="k">if</span> <span class="s1">&#39;crange&#39;</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">],</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">],</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;crange&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;crange&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;crange&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])</span> 
    
    <span class="c1"># crange (cmin,cmax,cref) is undefined and needs to be now setted up </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span> <span class="p">):</span> <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s1">&#39; --&gt; can</span><span class="se">\&#39;</span><span class="s1">t plot! data are everywhere: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])))</span>
        
        <span class="c1">#_______________________________________________________________________</span>
        <span class="c1"># cref is NOT predefined in cinfo dictionary</span>
        <span class="k">if</span> <span class="s1">&#39;cref&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># do_rescale is either &#39;log&#39; or &#39;slog&#39;, so data and colorbar will be </span>
            <span class="c1"># logarithmically scaled</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                
                <span class="c1"># colorrange center reference value for logarithmic scaling </span>
                <span class="k">if</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;log10&#39;</span><span class="p">:</span>
                    <span class="c1"># compute cref in decimal units and tranfer back to normal units </span>
                    <span class="c1"># afterwards</span>
                    <span class="n">cdmin</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])))</span>
                    <span class="n">cdmax</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">])))</span>
                    <span class="n">cref</span>          <span class="o">=</span> <span class="n">cdmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">cdmax</span><span class="o">-</span><span class="n">cdmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">cref</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cref</span><span class="p">)))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])</span>
                
                <span class="c1"># colorrange center reference value for symetric logarithmic scaling </span>
                <span class="k">elif</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span>    
                    <span class="c1"># cref becomes cutoff value for logarithmic to liner transition in </span>
                    <span class="c1"># case of symetric log10</span>
                    <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># do_rescale is None or False, means normal linear color value range</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># compute a cref value based on arithmetic mean between cmin and cmax</span>
                <span class="n">cref</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>        
                
                <span class="c1"># colorrange is centered around zero </span>
                <span class="k">if</span> <span class="n">cref</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span> 
                    <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cref</span>
                    
                <span class="c1"># colorrange center is not zero, means that the cref value rounded </span>
                <span class="c1"># to a clean dezimal so  cref = 7.516 --&gt; becomes cref = 7.5 ensures </span>
                <span class="c1"># clean colorstep levels </span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dez</span>     <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ini_dez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cref</span><span class="o">-</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">ini_dez</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">ini_dez</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ini_dez</span><span class="p">)</span>
                    <span class="k">else</span>        <span class="p">:</span> <span class="n">ini_dez</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ini_dez</span><span class="p">)</span> 
                    <span class="n">ini_dez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ini_dez</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="n">new_cref</span><span class="o">=</span> <span class="n">prev_cref</span> <span class="o">=</span> <span class="n">cref</span>
                    <span class="n">dc</span>      <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span>
                    <span class="c1">#print(ini_dez, cref, new_cref, cmin, dc)</span>
                    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">prev_cref</span> <span class="o">=</span> <span class="n">new_cref</span>
                        <span class="n">new_cref</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">cref</span><span class="p">,</span> <span class="n">ini_dez</span><span class="o">-</span><span class="n">dez</span><span class="p">)</span>
                        <span class="c1">#print(prev_cref, new_cref, dez, ini_dez-dez)</span>
                        <span class="c1">#if (new_cref&lt;cref-dc/10 or new_cref&gt;cref+dc/10 or prev_cref==new_cref) and dez!=0:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">new_cref</span><span class="o">&lt;</span><span class="n">cref</span><span class="o">-</span><span class="n">dc</span><span class="o">/</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">new_cref</span><span class="o">&gt;</span><span class="n">cref</span><span class="o">+</span><span class="n">dc</span><span class="o">/</span><span class="mi">10</span> <span class="ow">or</span> <span class="n">dez</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dez</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>    
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span> 
                            <span class="n">dez</span><span class="o">=</span><span class="n">dez</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_cref</span>
    
    <span class="c1">#___________________________________________________________________________    </span>
    <span class="c1"># compute clevels and cmap</span>
    <span class="c1"># --&gt; for logarithmic and symmetric logarithmic scaling </span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;log10&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]))</span> <span class="ow">or</span>  \
               <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">])</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]))</span> <span class="ow">or</span>  \
               <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s1">&#39; --&gt; For log10 scaled colormaps it must be cmin&lt;cref&lt;cmax, check your definition of cmin, cmax or crange</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
                                  <span class="s1">&#39;     It is recommented to ensure that crange is setted by hand when use log10, e.g crange=[1e-7,1e-1,1e-3]&#39;</span><span class="p">)</span>
            
            <span class="c1"># transfer cmin, cmax, cref into decimal units</span>
            <span class="n">cdmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])))</span>
            <span class="n">cdmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">])))</span>
            <span class="n">cdref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cdmin</span><span class="p">,</span><span class="n">cdmax</span><span class="p">,</span><span class="n">cdref</span><span class="p">)</span>
            
            <span class="c1">#compute levels in decimal units</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_c2c</span><span class="p">(</span><span class="n">cdmin</span><span class="p">,</span><span class="n">cdmax</span><span class="p">,</span><span class="n">cdref</span><span class="p">,</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnum&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span><span class="p">])</span>
            
            <span class="c1"># transfer levels back to normal units</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">])</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])</span>
            
        <span class="k">elif</span> <span class="n">do_rescale</span><span class="o">==</span><span class="s1">&#39;slog10&#39;</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">])</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]))</span> <span class="ow">or</span>  \
               <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s1">&#39; --&gt; For slog10 scaled colormaps it must be cmin&lt;cref&lt;cmax, e.g crange=[cmin,cmax,cref]=[-1e-1,1e-1,1e-7] </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
                                  <span class="s1">&#39;     where cref defines the center cutoff of the slog scaling </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
                                  <span class="s1">&#39;     It is recommented to ensure that crange is setted by hand when use slog10, e.g crange=[-1e-1,1e-1,1e-7]&#39;</span><span class="p">)</span>
            
            <span class="c1"># transfer cmin, cmax, cref into decimal units</span>
            <span class="n">cdmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">])))</span>
            <span class="n">cdmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">])))</span>
            <span class="n">cdref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])))</span>
            
            <span class="n">ddcmin</span><span class="p">,</span> <span class="n">ddcmax</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">cdmin</span><span class="o">-</span><span class="n">cdref</span><span class="p">),</span> <span class="p">(</span><span class="n">cdmax</span><span class="o">-</span><span class="n">cdref</span><span class="p">)</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_c2c</span><span class="p">(</span><span class="n">ddcmin</span><span class="p">,</span><span class="n">ddcmax</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnum&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span><span class="p">],</span> <span class="n">do_slog</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="c1"># rescale clevels towards symetric logarithm</span>
            <span class="n">isneg</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span>
            <span class="n">ispos</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">isneg</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">isneg</span><span class="p">])</span> <span class="o">+</span> <span class="n">cdref</span><span class="p">)</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">ispos</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">ispos</span><span class="p">])</span> <span class="o">+</span> <span class="n">cdref</span><span class="p">)</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">isneg</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">isneg</span><span class="p">])</span>
            <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">ispos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">ispos</span><span class="p">])</span>
    
    <span class="c1"># --&gt; for custom non-linear colorsteps defined by numpy array</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">rescal_ref</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">do_rescale</span><span class="o">==</span><span class="mf">0.0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">do_rescale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span> <span class="ow">and</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">rescal_ref</span><span class="o">=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span>
        <span class="n">nrscal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">rescal_ref</span><span class="p">)</span>
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_c2c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrscal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">(</span><span class="n">nrscal</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">nrscal</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span><span class="p">],</span> 
                                                                   <span class="n">cstep</span><span class="o">=</span><span class="mi">1</span> <span class="p">,</span><span class="n">do_slog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_rescal</span><span class="o">=</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">rescal_ref</span><span class="o">=</span><span class="n">rescal_ref</span><span class="p">)</span>
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_rescale</span>
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">do_rescale</span><span class="p">[</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]]</span>
    
    <span class="c1"># --&gt; for standard linear scaled colormap steps</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            
        <span class="k">if</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s1">&#39; --&gt; For standard linear scaled colormaps it must be cmin&lt;cref&lt;cmax, check your definition of cmin, cmax or crange&#39;</span><span class="p">)</span>
        
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap_c2c</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnum&#39;</span><span class="p">],</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span><span class="p">])</span>
    
    <span class="c1">#___________________________________________________________________________</span>
    
    <span class="k">if</span> <span class="s1">&#39;cmap0&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">cinfo</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmap0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="c1">#___________________________________________________________________________</span>
    <span class="c1"># colorbar tick labels</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_rescale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">nclev</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">])</span>
        <span class="n">idx_cref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idx_cref</span> <span class="o">=</span> <span class="n">idx_cref</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        
        <span class="n">nstep</span>    <span class="o">=</span> <span class="n">nclev</span><span class="o">/</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnlab&#39;</span><span class="p">]</span>
        <span class="n">nstep</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nstep</span><span class="p">)),</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">idx</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nclev</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">idxb</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nclev</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>                
        <span class="n">idxb</span><span class="p">[</span><span class="n">idx_cref</span><span class="p">::</span><span class="n">nstep</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">False</span>
        <span class="n">idxb</span><span class="p">[</span><span class="n">idx_cref</span><span class="p">::</span><span class="o">-</span><span class="n">nstep</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">do_rescale</span> <span class="o">==</span> <span class="s1">&#39;log10&#39;</span> <span class="ow">or</span> <span class="n">do_rescale</span> <span class="o">==</span> <span class="s1">&#39;slog10&#39;</span><span class="p">:</span>
            <span class="n">idxb</span><span class="p">[</span><span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
        
        <span class="n">idx_not</span>  <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">idxb</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
        <span class="n">idx_yes</span>  <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">idxb</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        
        
        <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;clevel&#39;</span><span class="p">][</span><span class="n">idx_yes</span><span class="p">]</span>
        <span class="k">del</span><span class="p">(</span><span class="n">idx_not</span><span class="p">,</span> <span class="n">idx_yes</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">idxb</span><span class="p">,</span> <span class="n">idx_cref</span><span class="p">)</span>
    <span class="c1">#___________________________________________________________________________</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cinfo</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cinfo</span><span class="p">)</span>    </div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_climit_hist">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_climit_hist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_climit_hist</span><span class="p">(</span><span class="n">data_in</span><span class="p">,</span> <span class="n">ctresh</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">cbin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cweights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; compute min/max value range by histogram, computation of cumulativ distribution</span>
<span class="sd">    function at certain cutoff treshold</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>

<span class="sd">        :data_in:   np.array with data to plot </span>

<span class="sd">        :ctresh:    cover 99% of value range, means that extreme outliers are cutted of</span>

<span class="sd">        :cbin:      number of bin that are used for the value range histogram</span>

<span class="sd">        :cweight:   provide are weights for the histogramm</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">        :cmin:      return minimum value of value range</span>

<span class="sd">        :cmax:      return minimum value of value range</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="k">if</span> <span class="n">cweights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_in</span><span class="p">)],</span> <span class="n">bins</span><span class="o">=</span><span class="n">cbin</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,)</span> <span class="c1">#weights=mesh.n_area[isnotnan]/np.sum(mesh.n_area[isnotnan]), )</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_in</span><span class="p">)],</span> <span class="n">bins</span><span class="o">=</span><span class="n">cbin</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">cweights</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data_in</span><span class="p">)],</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span> <span class="c1">#weights=mesh.n_area[isnotnan]/np.sum(mesh.n_area[isnotnan]), )</span>
    
    <span class="n">hist</span>        <span class="o">=</span> <span class="n">hist</span><span class="o">/</span><span class="n">hist</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">bin_m</span>       <span class="o">=</span> <span class="n">bin_e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">bin_e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">bin_e</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">cmin</span>        <span class="o">=</span> <span class="n">bin_m</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">ctresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">cmax</span>        <span class="o">=</span> <span class="n">bin_m</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>            <span class="o">&gt;=</span><span class="n">ctresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">cmin</span><span class="o">==</span><span class="n">cmax</span><span class="p">:</span> 
        <span class="n">cmax</span>        <span class="o">=</span> <span class="n">bin_m</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>        <span class="o">&gt;=</span><span class="n">ctresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">)</span></div>




<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="set_cinfo">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.set_cinfo">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_cinfo</span><span class="p">(</span><span class="n">cstr</span><span class="p">,</span> <span class="n">cnum</span><span class="p">,</span> <span class="n">crange</span><span class="p">,</span> <span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">,</span> <span class="n">cref</span><span class="p">,</span> <span class="n">cfac</span><span class="p">,</span> <span class="n">climit</span><span class="p">,</span> <span class="n">chist</span><span class="p">,</span> <span class="n">ctresh</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; initialise cinfo dictionary</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :cstr:      provide colormap string, can be either own defined colormap </span>
<span class="sd">                    see sub_colormap.py (&#39;blue2red&#39;, &#39;wbgyr&#39;,...), it can be also </span>
<span class="sd">                    a matplotlib colormap (&#39;matplotlib.viridis&#39;, &#39;matplotlib.coolwarm&#39;, </span>
<span class="sd">                    ...), or a cmocean colormap (&#39;cmocean.dens&#39;, &#39;cmocean.thermal&#39;....)</span>

<span class="sd">        :cnum:      minimum number of colors to use </span>

<span class="sd">        :crange:    list of min/max/ref colorrange [cmin, cmax, cref]</span>

<span class="sd">        :cmin:      set min value of colorrange</span>

<span class="sd">        :cmax:      set max value of colorrange</span>

<span class="sd">        :cref:      set reference value (center value of colorrange)</span>

<span class="sd">        :cfac:      factor to multiply cmin and cmax</span>

<span class="sd">        :climit:    provide list with cmin cmax value [cmin, cmax], reference value </span>
<span class="sd">                    is determined autonom    </span>

<span class="sd">        :chist:     True/Fals if colorrange should be limited by histogram to exclude</span>
<span class="sd">                    extreme outliers</span>

<span class="sd">        :ctresh:    how much percent of the colorrange should be covered, default is 99%</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>

<span class="sd">        :cinfo:     None, dict() (default: None), dictionary with colorbar info</span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="n">cinfo</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cstr</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cstr&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cstr</span>
    <span class="k">if</span> <span class="n">cnum</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cnum&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cnum</span>
    <span class="k">if</span> <span class="n">crange</span>    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;crange&#39;</span>   <span class="p">]</span><span class="o">=</span><span class="n">crange</span>
    <span class="k">if</span> <span class="n">cmin</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmin&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cmin</span>
    <span class="k">if</span> <span class="n">cmax</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cmax&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cmax</span>
    <span class="k">if</span> <span class="n">cref</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cref&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cref</span>
    <span class="k">if</span> <span class="n">cfac</span>      <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;cfac&#39;</span>     <span class="p">]</span><span class="o">=</span><span class="n">cfac</span>
    <span class="k">if</span> <span class="n">climit</span>    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;climit&#39;</span>   <span class="p">]</span><span class="o">=</span><span class="n">climit</span>    
    <span class="k">if</span> <span class="n">chist</span>     <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;chist&#39;</span>    <span class="p">]</span><span class="o">=</span><span class="n">chist</span>
    <span class="k">if</span> <span class="n">ctresh</span>    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">cinfo</span><span class="p">[</span><span class="s1">&#39;ctresh&#39;</span>   <span class="p">]</span><span class="o">=</span><span class="n">ctresh</span>
    <span class="k">return</span><span class="p">(</span><span class="n">cinfo</span><span class="p">)</span></div>

  
  
  
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#_______________________________________________________________________________</span>
<div class="viewcode-block" id="do_savefigure">
<a class="viewcode-back" href="../../index.html#tripyview.sub_plot.do_savefigure">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">do_savefigure</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="n">hfig</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">do_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_opt</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --&gt; save figure to file</span>
<span class="sd">    </span>
<span class="sd">    Parameters: </span>
<span class="sd">    </span>
<span class="sd">        :do_save:   None, str (default:None) if None figure will by not saved,</span>
<span class="sd">                    if string figure will be saved, strings must give         </span>
<span class="sd">                    directory and filename  where to save.                    </span>
<span class="sd">        </span>
<span class="sd">        :hfig:      figure handle                     </span>
<span class="sd">        </span>
<span class="sd">        :dpi:       int, (default:600), resolution of image    </span>
<span class="sd">        </span>
<span class="sd">        :save_opt:  dict, (default: dict()) direct option for saving via kwarg</span>
<span class="sd">    </span>
<span class="sd">    Returns: </span>
<span class="sd">    </span>
<span class="sd">    ____________________________________________________________________________</span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="k">if</span> <span class="n">do_save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">save_optdefault</span><span class="o">=</span><span class="nb">dict</span><span class="p">({</span><span class="s1">&#39;bbox_inches&#39;</span><span class="p">:</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="s1">&#39;pad_inches&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;transparent&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
        <span class="n">save_optdefault</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">save_opt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># extract filename from do_save</span>
            <span class="n">sfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">do_save</span><span class="p">)</span>
            
            <span class="c1"># extract file extensions</span>
            <span class="n">sfformat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sfname</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            
            <span class="c1"># extract dirname from do_save --&gt; create directory if not exist</span>
            <span class="n">sdname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">do_save</span><span class="p">)</span>
            <span class="n">sdname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">sdname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_info</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &gt; save figure: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdname</span><span class="p">,</span><span class="n">sfname</span><span class="p">)))</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sdname</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sdname</span><span class="p">)</span>
            
            <span class="c1">#___________________________________________________________________</span>
            <span class="n">hfig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdname</span><span class="p">,</span><span class="n">sfname</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="n">sfformat</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> 
                        <span class="o">**</span><span class="n">save_optdefault</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">do_save</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1">#___________________________________________________________________</span>
            <span class="c1"># extract filename from do_save</span>
            <span class="k">for</span> <span class="n">do_save0</span> <span class="ow">in</span> <span class="n">do_save</span><span class="p">:</span>
                <span class="n">sfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">do_save0</span><span class="p">)</span>
                
                <span class="c1"># extract file extensions</span>
                <span class="n">sfformat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">sfname</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                
                <span class="c1"># extract dirname from do_save --&gt; create directory if not exist</span>
                <span class="n">sdname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">do_save0</span><span class="p">)</span>
                <span class="n">sdname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">sdname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">do_info</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &gt; save figure: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdname</span><span class="p">,</span><span class="n">sfname</span><span class="p">)))</span>
                
                <span class="c1">#___________________________________________________________________</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sdname</span><span class="p">):</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sdname</span><span class="p">)</span>
                
                <span class="c1">#___________________________________________________________________</span>
                <span class="n">hfig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sdname</span><span class="p">,</span><span class="n">sfname</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="n">sfformat</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> 
                            <span class="o">**</span><span class="n">save_optdefault</span><span class="p">)</span></div>




<span class="c1">##</span>
<span class="c1">##</span>
<span class="c1">##_______________________________________________________________________________</span>
<span class="c1">## --&gt; this based on work of Nils Bruegemann see </span>
<span class="c1">## https://gitlab.dkrz.de/m300602/pyicon/-/blob/master/pyicon/pyicon_plotting.py</span>
<span class="c1">## i needed this to unify the ploting between icon and fesom for model comparison</span>
<span class="c1">## paper</span>
<span class="c1">#def arrange_axes(nx, ny,</span>
                 <span class="c1">#sharex = True, sharey = False,</span>
                 <span class="c1">#xlabel = &#39;&#39;, ylabel = &#39;&#39;,</span>
                 <span class="c1">## labeling axes with e.g. (a), (b), (c)</span>
                 <span class="c1">#do_axes_labels = True,</span>
                 <span class="c1">#axlab_kw = dict(),</span>
                 <span class="c1">## colorbar</span>
                 <span class="c1">#plot_cb = True,</span>
                 <span class="c1">## projection (e.g. for cartopy)</span>
                 <span class="c1">#projection = None,</span>
                 <span class="c1">## aspect ratio of axes</span>
                 <span class="c1">#asp = 1.,</span>
                 <span class="c1">#sasp = 0.,  # for compability with older version of arrange_axes</span>
                 <span class="c1">## width and height of axes</span>
                 <span class="c1">#wax = &#39;auto&#39;, hax = 4.,</span>
                 <span class="c1">## extra figure spaces (left, right, top, bottom)</span>
                 <span class="c1">#dfigl= 0.0, dfigr=0.0, dfigt=0.0, dfigb=0.0,</span>
                 <span class="c1">## space aroung axes (left, right, top, bottom) </span>
                 <span class="c1">#daxl = 1.8, daxr =0.8, daxt =0.8, daxb =1.2, </span>
                 <span class="c1">## space around colorbars (left, right, top, bottom) </span>
                 <span class="c1">#dcbl =-0.5, dcbr =1.4, dcbt =0.0, dcbb =0.5,</span>
                 <span class="c1">## width and height of colorbars</span>
                 <span class="c1">#wcb = 0.5, hcb = &#39;auto&#39;,</span>
                 <span class="c1">## factors to increase widths and heights of axes and colorbars</span>
                 <span class="c1">#fig_size_fac = 1.,</span>
                 <span class="c1">#f_wax  =1., f_hax  =1., f_wcb  =1., f_hcb  =1.,</span>
                 <span class="c1">## factors to increase spaces (figure)</span>
                 <span class="c1">#f_dfigl=1., f_dfigr=1., f_dfigt=1., f_dfigb=1.,</span>
                 <span class="c1">## factors to increase spaces (axes)</span>
                 <span class="c1">#f_daxl =1., f_daxr =1., f_daxt =1., f_daxb =1.,</span>
                 <span class="c1">## factors to increase spaces (colorbars)</span>
                 <span class="c1">#f_dcbl =1., f_dcbr =1., f_dcbt =1., f_dcbb =1.,</span>
                 <span class="c1">## font sizes of labels, titles, ticks</span>
                 <span class="c1">#fs_label = 10., fs_title = 12., fs_ticks = 10.,</span>
                 <span class="c1">## font size increasing factor</span>
                 <span class="c1">#f_fs = 1,</span>
                 <span class="c1">#reverse_order = False,</span>
                 <span class="c1">#nargout=[&#39;fig&#39;, &#39;hca&#39;, &#39;hcb&#39;],</span>
                <span class="c1">#):</span>

    <span class="c1">## factor to convert cm into inch</span>
    <span class="c1">#cm2inch = 0.3937</span>

    <span class="c1">#if sasp!=0:</span>
        <span class="c1">#print(&#39;::: Warning: You are using keyword ``sasp`` for setting the aspect ratio but you should switch to use ``asp`` instead.:::&#39;)</span>
        <span class="c1">#asp = 1.*sasp</span>

    <span class="c1">## --- set hcb in case it is auto</span>
    <span class="c1">#if isinstance(wax, str) and wax==&#39;auto&#39;: wax = hax/asp</span>

    <span class="c1">## --- set hcb in case it is auto</span>
    <span class="c1">#if isinstance(hcb, str) and hcb==&#39;auto&#39;: hcb = hax</span>

    <span class="c1">## --- rename horizontal-&gt;bottom and vertical-&gt;right</span>
    <span class="c1">#if isinstance(plot_cb, str) and plot_cb==&#39;horizontal&#39;: plot_cb = &#39;bottom&#39;</span>
    <span class="c1">#if isinstance(plot_cb, str) and plot_cb==&#39;vertical&#39;  : plot_cb = &#39;right&#39;</span>
  
    <span class="c1">## --- apply fig_size_fac</span>
    <span class="c1">## font sizes</span>
    <span class="c1">##f_fs *= fig_size_fac</span>
    <span class="c1">## factors to increase widths and heights of axes and colorbars</span>
    <span class="c1">#f_wax *= fig_size_fac</span>
    <span class="c1">#f_hax *= fig_size_fac</span>
    <span class="c1">##f_wcb *= fig_size_fac</span>
    <span class="c1">#f_hcb *= fig_size_fac</span>
    <span class="c1">### factors to increase spaces (figure)</span>
    <span class="c1">##f_dfigl *= fig_size_fac</span>
    <span class="c1">##f_dfigr *= fig_size_fac</span>
    <span class="c1">##f_dfigt *= fig_size_fac</span>
    <span class="c1">##f_dfigb *= fig_size_fac</span>
    <span class="c1">### factors to increase spaces (axes)</span>
    <span class="c1">##f_daxl *= fig_size_fac</span>
    <span class="c1">##f_daxr *= fig_size_fac</span>
    <span class="c1">##f_daxt *= fig_size_fac</span>
    <span class="c1">##f_daxb *= fig_size_fac</span>
    <span class="c1">### factors to increase spaces (colorbars)</span>
    <span class="c1">##f_dcbl *= fig_size_fac</span>
    <span class="c1">##f_dcbr *= fig_size_fac</span>
    <span class="c1">##f_dcbt *= fig_size_fac</span>
    <span class="c1">##f_dcbb *= fig_size_fac</span>
  
    <span class="c1">## --- apply font size factor</span>
    <span class="c1">#fs_label *= f_fs</span>
    <span class="c1">#fs_title *= f_fs</span>
    <span class="c1">#fs_ticks *= f_fs</span>

    <span class="c1">## make vector of plot_cb if it has been true or false before</span>
    <span class="c1">## plot_cb can have values [{1}, 0] </span>
    <span class="c1">## with meanings:</span>
    <span class="c1">##   1: plot cb; </span>
    <span class="c1">##   0: do not plot cb</span>
    <span class="c1">#plot_cb_right  = False</span>
    <span class="c1">#plot_cb_bottom = False</span>
    <span class="c1">#if isinstance(plot_cb, bool) and (plot_cb==True):</span>
        <span class="c1">#plot_cb = np.ones((nx,ny))  </span>
    <span class="c1">#elif isinstance(plot_cb, bool) and (plot_cb==False):</span>
        <span class="c1">#plot_cb = np.zeros((nx,ny))</span>
    <span class="c1">#elif isinstance(plot_cb, str) and plot_cb==&#39;right&#39;:</span>
        <span class="c1">#plot_cb = np.zeros((nx,ny))</span>
        <span class="c1">#plot_cb_right = True</span>
    <span class="c1">#elif isinstance(plot_cb, str) and plot_cb==&#39;bottom&#39;:</span>
        <span class="c1">#plot_cb = np.zeros((nx,ny))</span>
        <span class="c1">#plot_cb_bottom = True</span>
    <span class="c1">#else:</span>
        <span class="c1">#plot_cb = np.array(plot_cb)</span>
        <span class="c1">#if plot_cb.size!=nx*ny    : raise ValueError(&#39;Vector plot_cb has wrong length!&#39;)</span>
        <span class="c1">#if plot_cb.shape[0]==nx*ny: plot_cb = plot_cb.reshape(ny,nx).transpose()</span>
        <span class="c1">#elif plot_cb.shape[0]==ny : plot_cb = plot_cb.transpose()</span>
  
    <span class="c1">## --- make list of projections if it is not a list</span>
    <span class="c1">#if not isinstance(projection, list): projection = [projection]*nx*ny</span>
    
    <span class="c1">## --- make arrays and multiply by f_*</span>
    <span class="c1">#daxl = np.array([daxl]*nx)*f_daxl</span>
    <span class="c1">#daxr = np.array([daxr]*nx)*f_daxr</span>
    <span class="c1">#dcbl = np.array([dcbl]*nx)*f_dcbl</span>
    <span class="c1">#dcbr = np.array([dcbr]*nx)*f_dcbr</span>
    
    <span class="c1">#wax  = np.array([wax]*nx)*f_wax</span>
    <span class="c1">#wcb  = np.array([wcb]*nx)*f_wcb</span>
    
    <span class="c1">#daxt = np.array([daxt]*ny)*f_daxt</span>
    <span class="c1">#daxb = np.array([daxb]*ny)*f_daxb</span>
    <span class="c1">#dcbt = np.array([dcbt]*ny)*f_dcbt</span>
    <span class="c1">#dcbb = np.array([dcbb]*ny)*f_dcbb</span>
    
    <span class="c1">#hax  = np.array([hax]*ny)*f_hax</span>
    <span class="c1">#hcb  = np.array([hcb]*ny)*f_hcb</span>
  
    <span class="c1">## --- adjust for shared axes</span>
    <span class="c1">#if sharex: daxb[:-1] = 0.</span>
    
    <span class="c1">#if sharey: daxl[1:] = 0.</span>

    <span class="c1">## --- adjust for one colorbar at the right or bottom</span>
    <span class="c1">#if plot_cb_right:</span>
        <span class="c1">#daxr_s = daxr[0]</span>
        <span class="c1">#dcbl_s = dcbl[0]</span>
        <span class="c1">#dcbr_s = dcbr[0]</span>
        <span class="c1">#wcb_s  = wcb[0]</span>
        <span class="c1">#hcb_s  = hcb[0]</span>
        <span class="c1">#dfigr += dcbl_s+wcb_s+0.*dcbr_s+daxl[0]</span>
    <span class="c1">#if plot_cb_bottom:</span>
        <span class="c1">#hcb_s  = wcb[0]</span>
        <span class="c1">#wcb_s  = wax[0]</span>
        <span class="c1">#dcbb_s = dcbb[0]+daxb[-1]</span>
        <span class="c1">#dcbt_s = dcbt[0]</span>
        <span class="c1">##hcb_s  = hcb[0]</span>
        <span class="c1">#dfigb += dcbb_s+hcb_s+dcbt_s</span>
  
    <span class="c1">## --- adjust for columns without colorbar</span>
    <span class="c1">#delete_cb_space = plot_cb.sum(axis=1)==0</span>
    <span class="c1">#dcbl[delete_cb_space] = 0.0</span>
    <span class="c1">#dcbr[delete_cb_space] = 0.0</span>
    <span class="c1">#wcb[delete_cb_space]  = 0.0</span>
    
    <span class="c1">## --- determine ax position and fig dimensions</span>
    <span class="c1">#x0 =   dfigl</span>
    <span class="c1">#y0 = -(dfigt)</span>
    
    <span class="c1">#pos_axcm = np.zeros((nx*ny,4))</span>
    <span class="c1">#pos_cbcm = np.zeros((nx*ny,4))</span>
    <span class="c1">#nn = -1</span>
    <span class="c1">#y00 = y0</span>
    <span class="c1">#x00 = x0</span>
    <span class="c1">#for jj in range(ny):</span>
        <span class="c1">#y0 += -(daxt[jj]+hax[jj])</span>
        <span class="c1">#x0 = x00</span>
        <span class="c1">#for ii in range(nx):</span>
            <span class="c1">#nn += 1</span>
            <span class="c1">#x0   += daxl[ii]</span>
            <span class="c1">#pos_axcm[nn,:] = [x0, y0, wax[ii], hax[jj]]</span>
            <span class="c1">#pos_cbcm[nn,:] = [x0+wax[ii]+daxr[ii]+dcbl[ii], y0, wcb[ii], hcb[jj]]</span>
            <span class="c1">#x0   += wax[ii]+daxr[ii]+dcbl[ii]+wcb[ii]+dcbr[ii]</span>
        <span class="c1">#y0   += -(daxb[jj])</span>
    <span class="c1">#wfig = x0+dfigr</span>
    <span class="c1">#hfig = y0-dfigb</span>
  
    <span class="c1">## --- transform from negative y axis to positive y axis</span>
    <span class="c1">#hfig = -hfig</span>
    <span class="c1">#pos_axcm[:,1] += hfig</span>
    <span class="c1">#pos_cbcm[:,1] += hfig</span>
    
    <span class="c1">## --- convert to fig coords</span>
    <span class="c1">#cm2fig_x = 1./wfig</span>
    <span class="c1">#cm2fig_y = 1./hfig</span>
    
    <span class="c1">#pos_ax = 1.*pos_axcm</span>
    <span class="c1">#pos_cb = 1.*pos_cbcm</span>
    
    <span class="c1">#pos_ax[:,0] = pos_axcm[:,0]*cm2fig_x</span>
    <span class="c1">#pos_ax[:,2] = pos_axcm[:,2]*cm2fig_x</span>
    <span class="c1">#pos_ax[:,1] = pos_axcm[:,1]*cm2fig_y</span>
    <span class="c1">#pos_ax[:,3] = pos_axcm[:,3]*cm2fig_y</span>
    
    <span class="c1">#pos_cb[:,0] = pos_cbcm[:,0]*cm2fig_x</span>
    <span class="c1">#pos_cb[:,2] = pos_cbcm[:,2]*cm2fig_x</span>
    <span class="c1">#pos_cb[:,1] = pos_cbcm[:,1]*cm2fig_y</span>
    <span class="c1">#pos_cb[:,3] = pos_cbcm[:,3]*cm2fig_y</span>

    <span class="c1">## --- find axes center (!= figure center)</span>
    <span class="c1">#x_ax_cent = pos_axcm[0,0] +0.5*(pos_axcm[-1,0]+pos_axcm[-1,2]-pos_axcm[0,0])</span>
    <span class="c1">#y_ax_cent = pos_axcm[-1,1]+0.5*(pos_axcm[0,1] +pos_axcm[0,3] -pos_axcm[-1,1])</span>
    
    <span class="c1">## --- make figure and axes</span>
    <span class="c1">#fig = plt.figure(figsize=(wfig*cm2inch, hfig*cm2inch), facecolor=&#39;white&#39;)</span>
  
    <span class="c1">#hca = [0]*(nx*ny)</span>
    <span class="c1">#hcb = [0]*(nx*ny)</span>
    <span class="c1">#nn = -1</span>
    <span class="c1">#for jj in range(ny):</span>
        <span class="c1">#for ii in range(nx):</span>
            <span class="c1">#nn+=1</span>
            
            <span class="c1">## --- axes</span>
            <span class="c1">#hca[nn] = fig.add_subplot(position=pos_ax[nn,:], projection=projection[nn])</span>
            <span class="c1">#hca[nn].set_position(pos_ax[nn,:])</span>
            
            <span class="c1">## --- colorbar</span>
            <span class="c1">#if plot_cb[ii,jj] == 1:</span>
                <span class="c1">#hcb[nn] = fig.add_subplot(position=pos_cb[nn,:])</span>
                <span class="c1">#hcb[nn].set_position(pos_cb[nn,:])</span>
            <span class="c1">#ax  = hca[nn]</span>
            <span class="c1">#cax = hcb[nn] </span>
            
            <span class="c1">## --- label</span>
            <span class="c1">#ax.set_xlabel(xlabel, fontsize=fs_label)</span>
            <span class="c1">#ax.set_ylabel(ylabel, fontsize=fs_label)</span>
            <span class="c1">##ax.set_title(&#39;&#39;, fontsize=fs_title)</span>
            <span class="c1">#matplotlib.rcParams[&#39;axes.titlesize&#39;] = fs_title</span>
            <span class="c1">#ax.tick_params(labelsize=fs_ticks)</span>
            <span class="c1">#if plot_cb[ii,jj] == 1:</span>
                <span class="c1">#hcb[nn].tick_params(labelsize=fs_ticks)</span>
            
            <span class="c1">##ax.tick_params(pad=-10.0)</span>
            <span class="c1">##ax.xaxis.labelpad = 0</span>
            <span class="c1">##ax._set_title_offset_trans(float(-20))</span>
            
            <span class="c1">## --- axes ticks</span>
            <span class="c1">## delete labels for shared axes</span>
            <span class="c1">#if sharex and jj!=ny-1:</span>
                <span class="c1">#hca[nn].ticklabel_format(axis=&#39;x&#39;,style=&#39;plain&#39;,useOffset=False)</span>
                <span class="c1">#hca[nn].tick_params(labelbottom=False)</span>
                <span class="c1">#hca[nn].set_xlabel(&#39;&#39;)</span>
            
            <span class="c1">#if sharey and ii!=0:</span>
                <span class="c1">#hca[nn].ticklabel_format(axis=&#39;y&#39;,style=&#39;plain&#39;,useOffset=False)</span>
                <span class="c1">#hca[nn].tick_params(labelleft=False)</span>
                <span class="c1">#hca[nn].set_ylabel(&#39;&#39;)</span>
            
            <span class="c1">## ticks for colorbar </span>
            <span class="c1">#if plot_cb[ii,jj] == 1:</span>
                <span class="c1">#hcb[nn].set_xticks([])</span>
                <span class="c1">#hcb[nn].yaxis.tick_right()</span>
                <span class="c1">#hcb[nn].yaxis.set_label_position(&quot;right&quot;)</span>

    <span class="c1">##--- needs to converted to fig coords (not cm)</span>
    <span class="c1">#if plot_cb_right:</span>
        <span class="c1">#nn = -1</span>
        <span class="c1">##pos_cb = np.array([(wfig-(dfigr+dcbr_s+wcb_s))*cm2fig_x, (y_ax_cent-0.5*hcb_s)*cm2fig_y, wcb_s*cm2fig_x, hcb_s*cm2fig_y])</span>
        <span class="c1">#pos_cb = np.array([ (pos_axcm[-1,0]+pos_axcm[-1,2]+daxr_s+dcbl_s)*cm2fig_x, </span>
                            <span class="c1">#(y_ax_cent-0.5*hcb_s)*cm2fig_y, </span>
                            <span class="c1">#(wcb_s)*cm2fig_x, </span>
                            <span class="c1">#(hcb_s)*cm2fig_y </span>
                        <span class="c1">#])</span>
        <span class="c1">#hcb[nn] = fig.add_subplot(position=pos_cb)</span>
        <span class="c1">#hcb[nn].tick_params(labelsize=fs_ticks)</span>
        <span class="c1">#hcb[nn].set_position(pos_cb)</span>
        <span class="c1">#hcb[nn].set_xticks([])</span>
        <span class="c1">#hcb[nn].yaxis.tick_right()</span>
        <span class="c1">#hcb[nn].yaxis.set_label_position(&quot;right&quot;)</span>

    <span class="c1">#if plot_cb_bottom:</span>
        <span class="c1">#nn = -1</span>
        <span class="c1">#pos_cb = np.array([ (x_ax_cent-0.5*wcb_s)*cm2fig_x, </span>
                            <span class="c1">#(dcbb_s)*cm2fig_y, </span>
                            <span class="c1">#(wcb_s)*cm2fig_x, </span>
                            <span class="c1">#(hcb_s)*cm2fig_y</span>
                        <span class="c1">#])</span>
        <span class="c1">#hcb[nn] = fig.add_subplot(position=pos_cb)</span>
        <span class="c1">#hcb[nn].set_position(pos_cb)</span>
        <span class="c1">#hcb[nn].tick_params(labelsize=fs_ticks)</span>
        <span class="c1">#hcb[nn].set_yticks([])</span>

    <span class="c1">#if reverse_order:</span>
        <span class="c1">#isort = np.arange(nx*ny, dtype=int).reshape((ny,nx)).transpose().flatten()</span>
        <span class="c1">#hca = list(np.array(hca)[isort]) </span>
        <span class="c1">#hcb = list(np.array(hcb)[isort])</span>

    <span class="c1">## add letters for subplots</span>
    <span class="c1">#if (do_axes_labels) and (axlab_kw is not None):</span>
        <span class="c1">#hca = axlab(hca, fontdict=axlab_kw)</span>

    <span class="c1">##___________________________________________________________________________</span>
    <span class="c1">#list_argout=[]</span>
    <span class="c1">#if len(nargout)&gt;0:</span>
        <span class="c1">#for stri in nargout:</span>
            <span class="c1">#try:</span>
                <span class="c1">#list_argout.append(eval(stri))</span>
            <span class="c1">#except:</span>
                <span class="c1">#print(f&quot; -warning-&gt; variable {stri} was not found, could not be added as output argument&quot;) </span>
            
        <span class="c1">#return(list_argout)</span>
    <span class="c1">#else:</span>
        <span class="c1">#return</span>
    <span class="c1">##return fig, hca, hcb</span>



<span class="c1">##</span>
<span class="c1">##</span>
<span class="c1">##_______________________________________________________________________________</span>
<span class="c1">## --&gt; this based on work of Nils Bruegemann see </span>
<span class="c1">## https://gitlab.dkrz.de/m300602/pyicon/-/blob/master/pyicon/pyicon_plotting.py</span>
<span class="c1">## i needed this to unify the ploting between icon and fesom for model comparison</span>
<span class="c1">## paper    </span>
<span class="c1">#def axlab(hca, figstr=[], posx=[-0.00], posy=[1.05], fontdict=None):</span>
  <span class="c1">#&quot;&quot;&quot;</span>
<span class="c1">#input:</span>
<span class="c1">#----------</span>
  <span class="c1">#hca:      list with axes handles</span>
  <span class="c1">#figstr:   list with strings that label the subplots</span>
  <span class="c1">#posx:     list with length 1 or len(hca) that gives the x-coordinate in ax-space</span>
  <span class="c1">#posy:     list with length 1 or len(hca) that gives the y-coordinate in ax-space</span>
<span class="c1">#last change:</span>
<span class="c1">#----------</span>
<span class="c1">#2015-07-21</span>
  <span class="c1">#&quot;&quot;&quot;</span>

  <span class="c1">## make list that looks like [ &#39;(a)&#39;, &#39;(b)&#39;, &#39;(c)&#39;, ... ]</span>
  <span class="c1">#if len(figstr)==0:</span>
    <span class="c1">##lett = &quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
    <span class="c1">#lett  = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;,&quot;f&quot;,&quot;g&quot;,&quot;h&quot;,&quot;i&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;o&quot;,&quot;p&quot;,&quot;q&quot;,&quot;r&quot;,&quot;s&quot;,&quot;t&quot;,&quot;u&quot;,&quot;v&quot;,&quot;w&quot;,&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]</span>
    <span class="c1">#lett += [&quot;a2&quot;,&quot;b2&quot;,&quot;c2&quot;,&quot;d2&quot;,&quot;e2&quot;,&quot;f2&quot;,&quot;g2&quot;,&quot;h2&quot;,&quot;i2&quot;,&quot;j2&quot;,&quot;k2&quot;,&quot;l2&quot;,&quot;m2&quot;,&quot;n2&quot;,&quot;o2&quot;,&quot;p2&quot;,&quot;q2&quot;,&quot;r2&quot;,&quot;s2&quot;,&quot;t2&quot;,&quot;u2&quot;,&quot;v2&quot;,&quot;w2&quot;,&quot;x2&quot;,&quot;y2&quot;,&quot;z2&quot;]</span>
    <span class="c1">#lett = lett[0:len(hca)]</span>
    <span class="c1">#figstr = [&quot;z&quot;]*len(hca)</span>
    <span class="c1">#for nn, ax in enumerate(hca):</span>
      <span class="c1">#figstr[nn] = &quot;(%s)&quot; % (lett[nn])</span>
  
  <span class="c1">#if len(posx)==1:</span>
    <span class="c1">#posx = posx*len(hca)</span>
  <span class="c1">#if len(posy)==1:</span>
    <span class="c1">#posy = posy*len(hca)</span>
  
  <span class="c1">## draw text</span>
  <span class="c1">#for nn, ax in enumerate(hca):</span>
    <span class="c1">#ht = hca[nn].text(posx[nn], posy[nn], figstr[nn], </span>
                      <span class="c1">#transform = hca[nn].transAxes, </span>
                      <span class="c1">#horizontalalignment = &#39;right&#39;,</span>
                      <span class="c1">#fontdict=fontdict)</span>
    <span class="c1">## add text handle to axes to give possibility of changing text properties later</span>
    <span class="c1">## e.g. by hca[nn].axlab.set_fontsize(8)</span>
    <span class="c1">#hca[nn].axlab = ht</span>
<span class="c1">##  for nn, ax in enumerate(hca):</span>
<span class="c1">##    #ax.set_title(figstr[nn]+&#39;\n&#39;, loc=&#39;left&#39;, fontsize=10)</span>
<span class="c1">##    ax.set_title(figstr[nn], loc=&#39;left&#39;, fontsize=10)</span>
  <span class="c1">#return hca</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          
          <search role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </search>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="Related">
            <a href="../../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Patrick Scholz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>